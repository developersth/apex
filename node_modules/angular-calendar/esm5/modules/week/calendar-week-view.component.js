import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter, ChangeDetectorRef, OnChanges, OnInit, OnDestroy, LOCALE_ID, Inject, TemplateRef } from '@angular/core';
import { Subject } from 'rxjs';
import { CalendarDragHelper } from '../common/calendar-drag-helper.provider';
import { CalendarResizeHelper } from '../common/calendar-resize-helper.provider';
import { CalendarEventTimesChangedEventType } from '../common/calendar-event-times-changed-event.interface';
import { CalendarUtils } from '../common/calendar-utils.provider';
import { validateEvents, roundToNearest, trackByWeekDayHeaderDate, trackByHourSegment, trackByHour, getMinutesMoved, getDefaultEventEnd, getMinimumEventHeightInMinutes, addDaysWithExclusions, isDraggedWithinPeriod, shouldFireDroppedEvent, getWeekViewPeriod, trackByWeekAllDayEvent, trackByWeekTimeEvent } from '../common/util';
import { DateAdapter } from '../../date-adapters/date-adapter';
/**
 * Shows all events on a given week. Example usage:
 *
 * ```typescript
 * <mwl-calendar-week-view
 *  [viewDate]="viewDate"
 *  [events]="events">
 * </mwl-calendar-week-view>
 * ```
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './calendar-week-view-header.component';
import * as ɵngcc2 from '@angular/common';
import * as ɵngcc3 from 'angular-draggable-droppable';
import * as ɵngcc4 from 'angular-resizable-element';
import * as ɵngcc5 from './calendar-week-view-event.component';
import * as ɵngcc6 from './calendar-week-view-hour-segment.component';
import * as ɵngcc7 from './calendar-week-view-current-time-marker.component';
import * as ɵngcc8 from '../common/click.directive';

function CalendarWeekViewComponent_div_2_div_4_Template(rf, ctx) { if (rf & 1) {
    var _r270 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 13);
    ɵngcc0.ɵɵlistener("drop", function CalendarWeekViewComponent_div_2_div_4_Template_div_drop_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r270); var day_r268 = ctx.$implicit; var ctx_r269 = ɵngcc0.ɵɵnextContext(2); return ctx_r269.eventDropped($event, day_r268.date, true); })("dragEnter", function CalendarWeekViewComponent_div_2_div_4_Template_div_dragEnter_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r270); var day_r268 = ctx.$implicit; var ctx_r271 = ɵngcc0.ɵɵnextContext(2); return ctx_r271.dateDragEnter(day_r268.date); });
    ɵngcc0.ɵɵelementEnd();
} }
var _c0 = function () { return { left: true }; };
function CalendarWeekViewComponent_div_2_div_5_div_2_div_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 22);
} if (rf & 2) {
    ɵngcc0.ɵɵproperty("resizeEdges", ɵngcc0.ɵɵpureFunction0(1, _c0));
} }
var _c1 = function () { return { right: true }; };
function CalendarWeekViewComponent_div_2_div_5_div_2_div_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 23);
} if (rf & 2) {
    ɵngcc0.ɵɵproperty("resizeEdges", ɵngcc0.ɵɵpureFunction0(1, _c1));
} }
var _c2 = function (a0, a1) { return { left: a0, right: a1 }; };
var _c3 = function (a0, a1) { return { event: a0, calendarId: a1 }; };
var _c4 = function (a0, a1) { return { x: a0, y: a1 }; };
var _c5 = function (a0) { return { x: a0 }; };
var _c6 = function () { return {}; };
function CalendarWeekViewComponent_div_2_div_5_div_2_Template(rf, ctx) { if (rf & 1) {
    var _r280 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 17, 18);
    ɵngcc0.ɵɵlistener("resizeStart", function CalendarWeekViewComponent_div_2_div_5_div_2_Template_div_resizeStart_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r280); var allDayEvent_r275 = ctx.$implicit; ɵngcc0.ɵɵnextContext(); var _r273 = ɵngcc0.ɵɵreference(1); var ctx_r279 = ɵngcc0.ɵɵnextContext(2); return ctx_r279.allDayEventResizeStarted(_r273, allDayEvent_r275, $event); })("resizing", function CalendarWeekViewComponent_div_2_div_5_div_2_Template_div_resizing_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r280); var allDayEvent_r275 = ctx.$implicit; var ctx_r281 = ɵngcc0.ɵɵnextContext(3); return ctx_r281.allDayEventResizing(allDayEvent_r275, $event, ctx_r281.dayColumnWidth); })("resizeEnd", function CalendarWeekViewComponent_div_2_div_5_div_2_Template_div_resizeEnd_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r280); var allDayEvent_r275 = ctx.$implicit; var ctx_r282 = ɵngcc0.ɵɵnextContext(3); return ctx_r282.allDayEventResizeEnded(allDayEvent_r275); })("dragStart", function CalendarWeekViewComponent_div_2_div_5_div_2_Template_div_dragStart_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r280); var _r276 = ɵngcc0.ɵɵreference(1); ɵngcc0.ɵɵnextContext(); var _r273 = ɵngcc0.ɵɵreference(1); var ctx_r283 = ɵngcc0.ɵɵnextContext(2); return ctx_r283.dragStarted(_r273, _r276); })("dragging", function CalendarWeekViewComponent_div_2_div_5_div_2_Template_div_dragging_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r280); var ctx_r284 = ɵngcc0.ɵɵnextContext(3); return ctx_r284.allDayEventDragMove(); })("dragEnd", function CalendarWeekViewComponent_div_2_div_5_div_2_Template_div_dragEnd_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r280); var allDayEvent_r275 = ctx.$implicit; var ctx_r285 = ɵngcc0.ɵɵnextContext(3); return ctx_r285.dragEnded(allDayEvent_r275, $event, ctx_r285.dayColumnWidth); });
    ɵngcc0.ɵɵtemplate(2, CalendarWeekViewComponent_div_2_div_5_div_2_div_2_Template, 1, 2, "div", 19);
    ɵngcc0.ɵɵelementStart(3, "mwl-calendar-week-view-event", 20);
    ɵngcc0.ɵɵlistener("eventClicked", function CalendarWeekViewComponent_div_2_div_5_div_2_Template_mwl_calendar_week_view_event_eventClicked_3_listener($event) { ɵngcc0.ɵɵrestoreView(_r280); var allDayEvent_r275 = ctx.$implicit; var ctx_r286 = ɵngcc0.ɵɵnextContext(3); return ctx_r286.eventClicked.emit({ event: allDayEvent_r275.event, sourceEvent: $event.sourceEvent }); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(4, CalendarWeekViewComponent_div_2_div_5_div_2_div_4_Template, 1, 2, "div", 21);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var allDayEvent_r275 = ctx.$implicit;
    var ctx_r274 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵstyleProp("width", 100 / ctx_r274.days.length * allDayEvent_r275.span, "%")("margin-left", 100 / ctx_r274.days.length * allDayEvent_r275.offset, "%");
    ɵngcc0.ɵɵclassProp("cal-draggable", allDayEvent_r275.event.draggable && ctx_r274.allDayEventResizes.size === 0)("cal-starts-within-week", !allDayEvent_r275.startsBeforeWeek)("cal-ends-within-week", !allDayEvent_r275.endsAfterWeek);
    ɵngcc0.ɵɵproperty("ngClass", allDayEvent_r275.event == null ? null : allDayEvent_r275.event.cssClass)("resizeSnapGrid", ɵngcc0.ɵɵpureFunction2(29, _c2, ctx_r274.dayColumnWidth, ctx_r274.dayColumnWidth))("validateResize", ctx_r274.validateResize)("dropData", ɵngcc0.ɵɵpureFunction2(32, _c3, allDayEvent_r275.event, ctx_r274.calendarId))("dragAxis", ɵngcc0.ɵɵpureFunction2(35, _c4, allDayEvent_r275.event.draggable && ctx_r274.allDayEventResizes.size === 0, !ctx_r274.snapDraggedEvents && allDayEvent_r275.event.draggable && ctx_r274.allDayEventResizes.size === 0))("dragSnapGrid", ctx_r274.snapDraggedEvents ? ɵngcc0.ɵɵpureFunction1(38, _c5, ctx_r274.dayColumnWidth) : ɵngcc0.ɵɵpureFunction0(40, _c6))("validateDrag", ctx_r274.validateDrag);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", (allDayEvent_r275.event == null ? null : allDayEvent_r275.event.resizable == null ? null : allDayEvent_r275.event.resizable.beforeStart) && !allDayEvent_r275.startsBeforeWeek);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("locale", ctx_r274.locale)("weekEvent", allDayEvent_r275)("tooltipPlacement", ctx_r274.tooltipPlacement)("tooltipTemplate", ctx_r274.tooltipTemplate)("tooltipAppendToBody", ctx_r274.tooltipAppendToBody)("tooltipDelay", ctx_r274.tooltipDelay)("customTemplate", ctx_r274.eventTemplate)("eventTitleTemplate", ctx_r274.eventTitleTemplate)("eventActionsTemplate", ctx_r274.eventActionsTemplate)("daysInWeek", ctx_r274.daysInWeek);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", (allDayEvent_r275.event == null ? null : allDayEvent_r275.event.resizable == null ? null : allDayEvent_r275.event.resizable.afterEnd) && !allDayEvent_r275.endsAfterWeek);
} }
function CalendarWeekViewComponent_div_2_div_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 14, 15);
    ɵngcc0.ɵɵtemplate(2, CalendarWeekViewComponent_div_2_div_5_div_2_Template, 5, 41, "div", 16);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var eventRow_r272 = ctx.$implicit;
    var ctx_r267 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngForOf", eventRow_r272.row)("ngForTrackBy", ctx_r267.trackByWeekAllDayEvent);
} }
function CalendarWeekViewComponent_div_2_Template(rf, ctx) { if (rf & 1) {
    var _r288 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 8, 9);
    ɵngcc0.ɵɵlistener("dragEnter", function CalendarWeekViewComponent_div_2_Template_div_dragEnter_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r288); var ctx_r287 = ɵngcc0.ɵɵnextContext(); return ctx_r287.dragEnter("allDay"); })("dragLeave", function CalendarWeekViewComponent_div_2_Template_div_dragLeave_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r288); var ctx_r289 = ɵngcc0.ɵɵnextContext(); return ctx_r289.dragLeave("allDay"); });
    ɵngcc0.ɵɵelementStart(2, "div", 5);
    ɵngcc0.ɵɵelement(3, "div", 10);
    ɵngcc0.ɵɵtemplate(4, CalendarWeekViewComponent_div_2_div_4_Template, 1, 0, "div", 11);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(5, CalendarWeekViewComponent_div_2_div_5_Template, 3, 2, "div", 12);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r261 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", ctx_r261.allDayEventsLabelTemplate);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r261.days)("ngForTrackBy", ctx_r261.trackByWeekDayHeaderDate);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r261.view.allDayEventRows)("ngForTrackBy", ctx_r261.trackById);
} }
function CalendarWeekViewComponent_div_4_div_1_mwl_calendar_week_view_hour_segment_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "mwl-calendar-week-view-hour-segment", 28);
} if (rf & 2) {
    var segment_r294 = ctx.$implicit;
    var ctx_r293 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵstyleProp("height", ctx_r293.hourSegmentHeight, "px");
    ɵngcc0.ɵɵproperty("segment", segment_r294)("segmentHeight", ctx_r293.hourSegmentHeight)("locale", ctx_r293.locale)("customTemplate", ctx_r293.hourSegmentTemplate)("isTimeLabel", true)("daysInWeek", ctx_r293.daysInWeek);
} }
function CalendarWeekViewComponent_div_4_div_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 26);
    ɵngcc0.ɵɵtemplate(1, CalendarWeekViewComponent_div_4_div_1_mwl_calendar_week_view_hour_segment_1_Template, 1, 8, "mwl-calendar-week-view-hour-segment", 27);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var hour_r291 = ctx.$implicit;
    var odd_r292 = ctx.odd;
    var ctx_r290 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵclassProp("cal-hour-odd", odd_r292);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", hour_r291.segments)("ngForTrackBy", ctx_r290.trackByHourSegment);
} }
function CalendarWeekViewComponent_div_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 24);
    ɵngcc0.ɵɵtemplate(1, CalendarWeekViewComponent_div_4_div_1_Template, 2, 4, "div", 25);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r262 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r262.view.hourColumns[0].hours)("ngForTrackBy", ctx_r262.trackByHour);
} }
var _c7 = function () { return { left: true, top: true }; };
function CalendarWeekViewComponent_div_7_div_3_div_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 22);
} if (rf & 2) {
    ɵngcc0.ɵɵproperty("resizeEdges", ɵngcc0.ɵɵpureFunction0(1, _c7));
} }
var _c8 = function () { return { right: true, bottom: true }; };
function CalendarWeekViewComponent_div_7_div_3_div_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "div", 23);
} if (rf & 2) {
    ɵngcc0.ɵɵproperty("resizeEdges", ɵngcc0.ɵɵpureFunction0(1, _c8));
} }
var _c9 = function (a0, a1, a2, a3) { return { left: a0, right: a1, top: a2, bottom: a3 }; };
function CalendarWeekViewComponent_div_7_div_3_Template(rf, ctx) { if (rf & 1) {
    var _r303 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 33, 18);
    ɵngcc0.ɵɵlistener("resizeStart", function CalendarWeekViewComponent_div_7_div_3_Template_div_resizeStart_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r303); var timeEvent_r298 = ctx.$implicit; var ctx_r302 = ɵngcc0.ɵɵnextContext(2); var _r263 = ɵngcc0.ɵɵreference(6); return ctx_r302.timeEventResizeStarted(_r263, timeEvent_r298, $event); })("resizing", function CalendarWeekViewComponent_div_7_div_3_Template_div_resizing_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r303); var timeEvent_r298 = ctx.$implicit; var ctx_r304 = ɵngcc0.ɵɵnextContext(2); return ctx_r304.timeEventResizing(timeEvent_r298, $event); })("resizeEnd", function CalendarWeekViewComponent_div_7_div_3_Template_div_resizeEnd_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r303); var timeEvent_r298 = ctx.$implicit; var ctx_r305 = ɵngcc0.ɵɵnextContext(2); return ctx_r305.timeEventResizeEnded(timeEvent_r298); })("dragStart", function CalendarWeekViewComponent_div_7_div_3_Template_div_dragStart_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r303); var timeEvent_r298 = ctx.$implicit; var _r299 = ɵngcc0.ɵɵreference(1); var ctx_r306 = ɵngcc0.ɵɵnextContext(2); var _r263 = ɵngcc0.ɵɵreference(6); return ctx_r306.dragStarted(_r263, _r299, timeEvent_r298); })("dragging", function CalendarWeekViewComponent_div_7_div_3_Template_div_dragging_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r303); var timeEvent_r298 = ctx.$implicit; var ctx_r307 = ɵngcc0.ɵɵnextContext(2); return ctx_r307.dragMove(timeEvent_r298, $event); })("dragEnd", function CalendarWeekViewComponent_div_7_div_3_Template_div_dragEnd_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r303); var timeEvent_r298 = ctx.$implicit; var ctx_r308 = ɵngcc0.ɵɵnextContext(2); return ctx_r308.dragEnded(timeEvent_r298, $event, ctx_r308.dayColumnWidth, true); });
    ɵngcc0.ɵɵtemplate(2, CalendarWeekViewComponent_div_7_div_3_div_2_Template, 1, 2, "div", 19);
    ɵngcc0.ɵɵelementStart(3, "mwl-calendar-week-view-event", 34);
    ɵngcc0.ɵɵlistener("eventClicked", function CalendarWeekViewComponent_div_7_div_3_Template_mwl_calendar_week_view_event_eventClicked_3_listener($event) { ɵngcc0.ɵɵrestoreView(_r303); var timeEvent_r298 = ctx.$implicit; var ctx_r309 = ɵngcc0.ɵɵnextContext(2); return ctx_r309.eventClicked.emit({ event: timeEvent_r298.event, sourceEvent: $event.sourceEvent }); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(4, CalendarWeekViewComponent_div_7_div_3_div_4_Template, 1, 2, "div", 21);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var timeEvent_r298 = ctx.$implicit;
    var column_r295 = ɵngcc0.ɵɵnextContext().$implicit;
    var ctx_r296 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵstyleProp("top", timeEvent_r298.top, "px")("height", timeEvent_r298.height, "px")("left", timeEvent_r298.left, "%")("width", timeEvent_r298.width, "%");
    ɵngcc0.ɵɵclassProp("cal-draggable", timeEvent_r298.event.draggable && ctx_r296.timeEventResizes.size === 0)("cal-starts-within-day", !timeEvent_r298.startsBeforeDay)("cal-ends-within-day", !timeEvent_r298.endsAfterDay);
    ɵngcc0.ɵɵproperty("ngClass", timeEvent_r298.event.cssClass)("hidden", timeEvent_r298.height === 0 && timeEvent_r298.width === 0)("resizeSnapGrid", ɵngcc0.ɵɵpureFunction4(38, _c9, ctx_r296.dayColumnWidth, ctx_r296.dayColumnWidth, ctx_r296.eventSnapSize || ctx_r296.hourSegmentHeight, ctx_r296.eventSnapSize || ctx_r296.hourSegmentHeight))("validateResize", ctx_r296.validateResize)("allowNegativeResizes", true)("dropData", ɵngcc0.ɵɵpureFunction2(43, _c3, timeEvent_r298.event, ctx_r296.calendarId))("dragAxis", ɵngcc0.ɵɵpureFunction2(46, _c4, timeEvent_r298.event.draggable && ctx_r296.timeEventResizes.size === 0, timeEvent_r298.event.draggable && ctx_r296.timeEventResizes.size === 0))("dragSnapGrid", ctx_r296.snapDraggedEvents ? ɵngcc0.ɵɵpureFunction2(49, _c4, ctx_r296.dayColumnWidth, ctx_r296.eventSnapSize || ctx_r296.hourSegmentHeight) : ɵngcc0.ɵɵpureFunction0(52, _c6))("ghostDragEnabled", !ctx_r296.snapDraggedEvents)("validateDrag", ctx_r296.validateDrag);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", (timeEvent_r298.event == null ? null : timeEvent_r298.event.resizable == null ? null : timeEvent_r298.event.resizable.beforeStart) && !timeEvent_r298.startsBeforeDay);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("locale", ctx_r296.locale)("weekEvent", timeEvent_r298)("tooltipPlacement", ctx_r296.tooltipPlacement)("tooltipTemplate", ctx_r296.tooltipTemplate)("tooltipAppendToBody", ctx_r296.tooltipAppendToBody)("tooltipDisabled", ctx_r296.dragActive || ctx_r296.timeEventResizes.size > 0)("tooltipDelay", ctx_r296.tooltipDelay)("customTemplate", ctx_r296.eventTemplate)("eventTitleTemplate", ctx_r296.eventTitleTemplate)("eventActionsTemplate", ctx_r296.eventActionsTemplate)("column", column_r295)("daysInWeek", ctx_r296.daysInWeek);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", (timeEvent_r298.event == null ? null : timeEvent_r298.event.resizable == null ? null : timeEvent_r298.event.resizable.afterEnd) && !timeEvent_r298.endsAfterDay);
} }
function CalendarWeekViewComponent_div_7_div_4_mwl_calendar_week_view_hour_segment_1_Template(rf, ctx) { if (rf & 1) {
    var _r316 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "mwl-calendar-week-view-hour-segment", 36);
    ɵngcc0.ɵɵlistener("mwlClick", function CalendarWeekViewComponent_div_7_div_4_mwl_calendar_week_view_hour_segment_1_Template_mwl_calendar_week_view_hour_segment_mwlClick_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r316); var segment_r314 = ctx.$implicit; var ctx_r315 = ɵngcc0.ɵɵnextContext(3); return ctx_r315.hourSegmentClicked.emit({ date: segment_r314.date, sourceEvent: $event }); })("drop", function CalendarWeekViewComponent_div_7_div_4_mwl_calendar_week_view_hour_segment_1_Template_mwl_calendar_week_view_hour_segment_drop_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r316); var segment_r314 = ctx.$implicit; var ctx_r317 = ɵngcc0.ɵɵnextContext(3); return ctx_r317.eventDropped($event, segment_r314.date, false); })("dragEnter", function CalendarWeekViewComponent_div_7_div_4_mwl_calendar_week_view_hour_segment_1_Template_mwl_calendar_week_view_hour_segment_dragEnter_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r316); var segment_r314 = ctx.$implicit; var ctx_r318 = ɵngcc0.ɵɵnextContext(3); return ctx_r318.dateDragEnter(segment_r314.date); });
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var segment_r314 = ctx.$implicit;
    var ctx_r313 = ɵngcc0.ɵɵnextContext(3);
    ɵngcc0.ɵɵstyleProp("height", ctx_r313.hourSegmentHeight, "px");
    ɵngcc0.ɵɵproperty("segment", segment_r314)("segmentHeight", ctx_r313.hourSegmentHeight)("locale", ctx_r313.locale)("customTemplate", ctx_r313.hourSegmentTemplate)("daysInWeek", ctx_r313.daysInWeek)("clickListenerDisabled", ctx_r313.hourSegmentClicked.observers.length === 0)("dragOverClass", !ctx_r313.dragActive || !ctx_r313.snapDraggedEvents ? "cal-drag-over" : null)("isTimeLabel", ctx_r313.daysInWeek === 1);
} }
function CalendarWeekViewComponent_div_7_div_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 26);
    ɵngcc0.ɵɵtemplate(1, CalendarWeekViewComponent_div_7_div_4_mwl_calendar_week_view_hour_segment_1_Template, 1, 10, "mwl-calendar-week-view-hour-segment", 35);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var hour_r311 = ctx.$implicit;
    var odd_r312 = ctx.odd;
    var ctx_r297 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵclassProp("cal-hour-odd", odd_r312);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", hour_r311.segments)("ngForTrackBy", ctx_r297.trackByHourSegment);
} }
function CalendarWeekViewComponent_div_7_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 29);
    ɵngcc0.ɵɵelement(1, "mwl-calendar-week-view-current-time-marker", 30);
    ɵngcc0.ɵɵelementStart(2, "div", 31);
    ɵngcc0.ɵɵtemplate(3, CalendarWeekViewComponent_div_7_div_3_Template, 5, 53, "div", 32);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(4, CalendarWeekViewComponent_div_7_div_4_Template, 2, 4, "div", 25);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var column_r295 = ctx.$implicit;
    var ctx_r264 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("columnDate", column_r295.date)("dayStartHour", ctx_r264.dayStartHour)("dayStartMinute", ctx_r264.dayStartMinute)("dayEndHour", ctx_r264.dayEndHour)("dayEndMinute", ctx_r264.dayEndMinute)("hourSegments", ctx_r264.hourSegments)("hourSegmentHeight", ctx_r264.hourSegmentHeight)("customTemplate", ctx_r264.currentTimeMarkerTemplate);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngForOf", column_r295.events)("ngForTrackBy", ctx_r264.trackByWeekTimeEvent);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", column_r295.hours)("ngForTrackBy", ctx_r264.trackByHour);
} }
var CalendarWeekViewComponent = /** @class */ (function () {
    /**
     * @hidden
     */
    function CalendarWeekViewComponent(cdr, utils, locale, dateAdapter) {
        this.cdr = cdr;
        this.utils = utils;
        this.dateAdapter = dateAdapter;
        /**
         * An array of events to display on view
         * The schema is available here: https://github.com/mattlewis92/calendar-utils/blob/c51689985f59a271940e30bc4e2c4e1fee3fcb5c/src/calendarUtils.ts#L49-L63
         */
        this.events = [];
        /**
         * An array of day indexes (0 = sunday, 1 = monday etc) that will be hidden on the view
         */
        this.excludeDays = [];
        /**
         * The placement of the event tooltip
         */
        this.tooltipPlacement = 'auto';
        /**
         * Whether to append tooltips to the body or next to the trigger element
         */
        this.tooltipAppendToBody = true;
        /**
         * The delay in milliseconds before the tooltip should be displayed. If not provided the tooltip
         * will be displayed immediately.
         */
        this.tooltipDelay = null;
        /**
         * The precision to display events.
         * `days` will round event start and end dates to the nearest day and `minutes` will not do this rounding
         */
        this.precision = 'days';
        /**
         * Whether to snap events to a grid when dragging
         */
        this.snapDraggedEvents = true;
        /**
         * The number of segments in an hour. Must be <= 6
         */
        this.hourSegments = 2;
        /**
         * The height in pixels of each hour segment
         */
        this.hourSegmentHeight = 30;
        /**
         * The day start hours in 24 hour time. Must be 0-23
         */
        this.dayStartHour = 0;
        /**
         * The day start minutes. Must be 0-59
         */
        this.dayStartMinute = 0;
        /**
         * The day end hours in 24 hour time. Must be 0-23
         */
        this.dayEndHour = 23;
        /**
         * The day end minutes. Must be 0-59
         */
        this.dayEndMinute = 59;
        /**
         * Called when a header week day is clicked. Adding a `cssClass` property on `$event.day` will add that class to the header element
         */
        this.dayHeaderClicked = new EventEmitter();
        /**
         * Called when the event title is clicked
         */
        this.eventClicked = new EventEmitter();
        /**
         * Called when an event is resized or dragged and dropped
         */
        this.eventTimesChanged = new EventEmitter();
        /**
         * An output that will be called before the view is rendered for the current week.
         * If you add the `cssClass` property to a day in the header it will add that class to the cell element in the template
         */
        this.beforeViewRender = new EventEmitter();
        /**
         * Called when an hour segment is clicked
         */
        this.hourSegmentClicked = new EventEmitter();
        /**
         * @hidden
         */
        this.allDayEventResizes = new Map();
        /**
         * @hidden
         */
        this.timeEventResizes = new Map();
        /**
         * @hidden
         */
        this.eventDragEnterByType = {
            allDay: 0,
            time: 0
        };
        /**
         * @hidden
         */
        this.dragActive = false;
        /**
         * @hidden
         */
        this.dragAlreadyMoved = false;
        /**
         * @hidden
         */
        this.calendarId = Symbol('angular calendar week view id');
        /**
         * @hidden
         */
        this.trackByWeekDayHeaderDate = trackByWeekDayHeaderDate;
        /**
         * @hidden
         */
        this.trackByHourSegment = trackByHourSegment;
        /**
         * @hidden
         */
        this.trackByHour = trackByHour;
        /**
         * @hidden
         */
        this.trackByWeekAllDayEvent = trackByWeekAllDayEvent;
        /**
         * @hidden
         */
        this.trackByWeekTimeEvent = trackByWeekTimeEvent;
        /**
         * @hidden
         */
        this.trackByHourColumn = function (index, column) {
            return column.hours[0] ? column.hours[0].segments[0].date.toISOString() : column;
        };
        /**
         * @hidden
         */
        this.trackById = function (index, row) { return row.id; };
        this.locale = locale;
    }
    /**
     * @hidden
     */
    CalendarWeekViewComponent.prototype.ngOnInit = function () {
        var _this = this;
        if (this.refresh) {
            this.refreshSubscription = this.refresh.subscribe(function () {
                _this.refreshAll();
                _this.cdr.markForCheck();
            });
        }
    };
    /**
     * @hidden
     */
    CalendarWeekViewComponent.prototype.ngOnChanges = function (changes) {
        var refreshHeader = changes.viewDate ||
            changes.excludeDays ||
            changes.weekendDays ||
            changes.daysInWeek ||
            changes.weekStartsOn;
        var refreshBody = changes.viewDate ||
            changes.dayStartHour ||
            changes.dayStartMinute ||
            changes.dayEndHour ||
            changes.dayEndMinute ||
            changes.hourSegments ||
            changes.weekStartsOn ||
            changes.weekendDays ||
            changes.excludeDays ||
            changes.hourSegmentHeight ||
            changes.events ||
            changes.daysInWeek;
        if (refreshHeader) {
            this.refreshHeader();
        }
        if (changes.events) {
            validateEvents(this.events);
        }
        if (refreshBody) {
            this.refreshBody();
        }
        if (refreshHeader || refreshBody) {
            this.emitBeforeViewRender();
        }
    };
    /**
     * @hidden
     */
    CalendarWeekViewComponent.prototype.ngOnDestroy = function () {
        if (this.refreshSubscription) {
            this.refreshSubscription.unsubscribe();
        }
    };
    CalendarWeekViewComponent.prototype.resizeStarted = function (eventsContainer, minWidth) {
        this.dayColumnWidth = this.getDayColumnWidth(eventsContainer);
        var resizeHelper = new CalendarResizeHelper(eventsContainer, minWidth);
        this.validateResize = function (_a) {
            var rectangle = _a.rectangle;
            return resizeHelper.validateResize({ rectangle: rectangle });
        };
        this.cdr.markForCheck();
    };
    /**
     * @hidden
     */
    CalendarWeekViewComponent.prototype.timeEventResizeStarted = function (eventsContainer, timeEvent, resizeEvent) {
        this.timeEventResizes.set(timeEvent.event, resizeEvent);
        this.resizeStarted(eventsContainer);
    };
    /**
     * @hidden
     */
    CalendarWeekViewComponent.prototype.timeEventResizing = function (timeEvent, resizeEvent) {
        var _this = this;
        this.timeEventResizes.set(timeEvent.event, resizeEvent);
        var adjustedEvents = new Map();
        var tempEvents = tslib_1.__spread(this.events);
        this.timeEventResizes.forEach(function (lastResizeEvent, event) {
            var newEventDates = _this.getTimeEventResizedDates(event, lastResizeEvent);
            var adjustedEvent = tslib_1.__assign({}, event, newEventDates);
            adjustedEvents.set(adjustedEvent, event);
            var eventIndex = tempEvents.indexOf(event);
            tempEvents[eventIndex] = adjustedEvent;
        });
        this.restoreOriginalEvents(tempEvents, adjustedEvents);
    };
    /**
     * @hidden
     */
    CalendarWeekViewComponent.prototype.timeEventResizeEnded = function (timeEvent) {
        this.view = this.getWeekView(this.events);
        var lastResizeEvent = this.timeEventResizes.get(timeEvent.event);
        if (lastResizeEvent) {
            this.timeEventResizes.delete(timeEvent.event);
            var newEventDates = this.getTimeEventResizedDates(timeEvent.event, lastResizeEvent);
            this.eventTimesChanged.emit({
                newStart: newEventDates.start,
                newEnd: newEventDates.end,
                event: timeEvent.event,
                type: CalendarEventTimesChangedEventType.Resize
            });
        }
    };
    /**
     * @hidden
     */
    CalendarWeekViewComponent.prototype.allDayEventResizeStarted = function (allDayEventsContainer, allDayEvent, resizeEvent) {
        this.allDayEventResizes.set(allDayEvent, {
            originalOffset: allDayEvent.offset,
            originalSpan: allDayEvent.span,
            edge: typeof resizeEvent.edges.left !== 'undefined' ? 'left' : 'right'
        });
        this.resizeStarted(allDayEventsContainer, this.getDayColumnWidth(allDayEventsContainer));
    };
    /**
     * @hidden
     */
    CalendarWeekViewComponent.prototype.allDayEventResizing = function (allDayEvent, resizeEvent, dayWidth) {
        var currentResize = this.allDayEventResizes.get(allDayEvent);
        if (typeof resizeEvent.edges.left !== 'undefined') {
            var diff = Math.round(+resizeEvent.edges.left / dayWidth);
            allDayEvent.offset = currentResize.originalOffset + diff;
            allDayEvent.span = currentResize.originalSpan - diff;
        }
        else if (typeof resizeEvent.edges.right !== 'undefined') {
            var diff = Math.round(+resizeEvent.edges.right / dayWidth);
            allDayEvent.span = currentResize.originalSpan + diff;
        }
    };
    /**
     * @hidden
     */
    CalendarWeekViewComponent.prototype.allDayEventResizeEnded = function (allDayEvent) {
        var currentResize = this.allDayEventResizes.get(allDayEvent);
        if (currentResize) {
            var allDayEventResizingBeforeStart = currentResize.edge === 'left';
            var daysDiff = void 0;
            if (allDayEventResizingBeforeStart) {
                daysDiff = allDayEvent.offset - currentResize.originalOffset;
            }
            else {
                daysDiff = allDayEvent.span - currentResize.originalSpan;
            }
            allDayEvent.offset = currentResize.originalOffset;
            allDayEvent.span = currentResize.originalSpan;
            var newStart = allDayEvent.event.start;
            var newEnd = allDayEvent.event.end || allDayEvent.event.start;
            if (allDayEventResizingBeforeStart) {
                newStart = addDaysWithExclusions(this.dateAdapter, newStart, daysDiff, this.excludeDays);
            }
            else {
                newEnd = addDaysWithExclusions(this.dateAdapter, newEnd, daysDiff, this.excludeDays);
            }
            this.eventTimesChanged.emit({
                newStart: newStart,
                newEnd: newEnd,
                event: allDayEvent.event,
                type: CalendarEventTimesChangedEventType.Resize
            });
            this.allDayEventResizes.delete(allDayEvent);
        }
    };
    /**
     * @hidden
     */
    CalendarWeekViewComponent.prototype.getDayColumnWidth = function (eventRowContainer) {
        return Math.floor(eventRowContainer.offsetWidth / this.days.length);
    };
    /**
     * @hidden
     */
    CalendarWeekViewComponent.prototype.dateDragEnter = function (date) {
        this.lastDragEnterDate = date;
    };
    /**
     * @hidden
     */
    CalendarWeekViewComponent.prototype.eventDropped = function (dropEvent, date, allDay) {
        if (shouldFireDroppedEvent(dropEvent, date, allDay, this.calendarId) &&
            this.lastDragEnterDate.getTime() === date.getTime()) {
            this.eventTimesChanged.emit({
                type: CalendarEventTimesChangedEventType.Drop,
                event: dropEvent.dropData.event,
                newStart: date,
                allDay: allDay
            });
        }
    };
    /**
     * @hidden
     */
    CalendarWeekViewComponent.prototype.dragEnter = function (type) {
        this.eventDragEnterByType[type]++;
    };
    /**
     * @hidden
     */
    CalendarWeekViewComponent.prototype.dragLeave = function (type) {
        this.eventDragEnterByType[type]--;
    };
    /**
     * @hidden
     */
    CalendarWeekViewComponent.prototype.dragStarted = function (eventsContainer, event, dayEvent) {
        var _this = this;
        this.dayColumnWidth = this.getDayColumnWidth(eventsContainer);
        var dragHelper = new CalendarDragHelper(eventsContainer, event);
        this.validateDrag = function (_a) {
            var x = _a.x, y = _a.y, transform = _a.transform;
            return _this.allDayEventResizes.size === 0 &&
                _this.timeEventResizes.size === 0 &&
                dragHelper.validateDrag({
                    x: x,
                    y: y,
                    snapDraggedEvents: _this.snapDraggedEvents,
                    dragAlreadyMoved: _this.dragAlreadyMoved,
                    transform: transform
                });
        };
        this.dragActive = true;
        this.dragAlreadyMoved = false;
        this.eventDragEnterByType = {
            allDay: 0,
            time: 0
        };
        if (!this.snapDraggedEvents && dayEvent) {
            this.view.hourColumns.forEach(function (column) {
                var linkedEvent = column.events.find(function (columnEvent) {
                    return columnEvent.event === dayEvent.event && columnEvent !== dayEvent;
                });
                // hide any linked events while dragging
                if (linkedEvent) {
                    linkedEvent.width = 0;
                    linkedEvent.height = 0;
                }
            });
        }
        this.cdr.markForCheck();
    };
    /**
     * @hidden
     */
    CalendarWeekViewComponent.prototype.dragMove = function (dayEvent, dragEvent) {
        if (this.snapDraggedEvents) {
            var newEventTimes = this.getDragMovedEventTimes(dayEvent, dragEvent, this.dayColumnWidth, true);
            var originalEvent_1 = dayEvent.event;
            var adjustedEvent_1 = tslib_1.__assign({}, originalEvent_1, newEventTimes);
            var tempEvents = this.events.map(function (event) {
                if (event === originalEvent_1) {
                    return adjustedEvent_1;
                }
                return event;
            });
            this.restoreOriginalEvents(tempEvents, new Map([[adjustedEvent_1, originalEvent_1]]));
        }
        this.dragAlreadyMoved = true;
    };
    /**
     * @hidden
     */
    CalendarWeekViewComponent.prototype.allDayEventDragMove = function () {
        this.dragAlreadyMoved = true;
    };
    /**
     * @hidden
     */
    CalendarWeekViewComponent.prototype.dragEnded = function (weekEvent, dragEndEvent, dayWidth, useY) {
        if (useY === void 0) { useY = false; }
        this.view = this.getWeekView(this.events);
        this.dragActive = false;
        var _a = this.getDragMovedEventTimes(weekEvent, dragEndEvent, dayWidth, useY), start = _a.start, end = _a.end;
        if (this.eventDragEnterByType[useY ? 'time' : 'allDay'] > 0 &&
            isDraggedWithinPeriod(start, end, this.view.period)) {
            this.eventTimesChanged.emit({
                newStart: start,
                newEnd: end,
                event: weekEvent.event,
                type: CalendarEventTimesChangedEventType.Drag,
                allDay: !useY
            });
        }
    };
    CalendarWeekViewComponent.prototype.refreshHeader = function () {
        this.days = this.utils.getWeekViewHeader(tslib_1.__assign({ viewDate: this.viewDate, weekStartsOn: this.weekStartsOn, excluded: this.excludeDays, weekendDays: this.weekendDays }, getWeekViewPeriod(this.dateAdapter, this.viewDate, this.weekStartsOn, this.excludeDays, this.daysInWeek)));
    };
    CalendarWeekViewComponent.prototype.refreshBody = function () {
        this.view = this.getWeekView(this.events);
    };
    CalendarWeekViewComponent.prototype.refreshAll = function () {
        this.refreshHeader();
        this.refreshBody();
        this.emitBeforeViewRender();
    };
    CalendarWeekViewComponent.prototype.emitBeforeViewRender = function () {
        if (this.days && this.view) {
            this.beforeViewRender.emit(tslib_1.__assign({ header: this.days }, this.view));
        }
    };
    CalendarWeekViewComponent.prototype.getWeekView = function (events) {
        return this.utils.getWeekView(tslib_1.__assign({ events: events, viewDate: this.viewDate, weekStartsOn: this.weekStartsOn, excluded: this.excludeDays, precision: this.precision, absolutePositionedEvents: true, hourSegments: this.hourSegments, dayStart: {
                hour: this.dayStartHour,
                minute: this.dayStartMinute
            }, dayEnd: {
                hour: this.dayEndHour,
                minute: this.dayEndMinute
            }, segmentHeight: this.hourSegmentHeight, weekendDays: this.weekendDays }, getWeekViewPeriod(this.dateAdapter, this.viewDate, this.weekStartsOn, this.excludeDays, this.daysInWeek)));
    };
    CalendarWeekViewComponent.prototype.getDragMovedEventTimes = function (weekEvent, dragEndEvent, dayWidth, useY) {
        var daysDragged = roundToNearest(dragEndEvent.x, dayWidth) / dayWidth;
        var minutesMoved = useY
            ? getMinutesMoved(dragEndEvent.y, this.hourSegments, this.hourSegmentHeight, this.eventSnapSize)
            : 0;
        var start = this.dateAdapter.addMinutes(addDaysWithExclusions(this.dateAdapter, weekEvent.event.start, daysDragged, this.excludeDays), minutesMoved);
        var end;
        if (weekEvent.event.end) {
            end = this.dateAdapter.addMinutes(addDaysWithExclusions(this.dateAdapter, weekEvent.event.end, daysDragged, this.excludeDays), minutesMoved);
        }
        return { start: start, end: end };
    };
    CalendarWeekViewComponent.prototype.restoreOriginalEvents = function (tempEvents, adjustedEvents) {
        var previousView = this.view;
        this.view = this.getWeekView(tempEvents);
        var adjustedEventsArray = tempEvents.filter(function (event) {
            return adjustedEvents.has(event);
        });
        this.view.hourColumns.forEach(function (column, columnIndex) {
            previousView.hourColumns[columnIndex].hours.forEach(function (hour, hourIndex) {
                hour.segments.forEach(function (segment, segmentIndex) {
                    column.hours[hourIndex].segments[segmentIndex].cssClass =
                        segment.cssClass;
                });
            });
            adjustedEventsArray.forEach(function (adjustedEvent) {
                var originalEvent = adjustedEvents.get(adjustedEvent);
                var existingColumnEvent = column.events.find(function (columnEvent) { return columnEvent.event === adjustedEvent; });
                if (existingColumnEvent) {
                    // restore the original event so trackBy kicks in and the dom isn't changed
                    existingColumnEvent.event = originalEvent;
                }
                else {
                    // add a dummy event to the drop so if the event was removed from the original column the drag doesn't end early
                    column.events.push({
                        event: originalEvent,
                        left: 0,
                        top: 0,
                        height: 0,
                        width: 0,
                        startsBeforeDay: false,
                        endsAfterDay: false
                    });
                }
            });
        });
        adjustedEvents.clear();
    };
    CalendarWeekViewComponent.prototype.getTimeEventResizedDates = function (calendarEvent, resizeEvent) {
        var minimumEventHeight = getMinimumEventHeightInMinutes(this.hourSegments, this.hourSegmentHeight);
        var newEventDates = {
            start: calendarEvent.start,
            end: getDefaultEventEnd(this.dateAdapter, calendarEvent, minimumEventHeight)
        };
        var end = calendarEvent.end, eventWithoutEnd = tslib_1.__rest(calendarEvent, ["end"]);
        var smallestResizes = {
            start: this.dateAdapter.addMinutes(newEventDates.end, minimumEventHeight * -1),
            end: getDefaultEventEnd(this.dateAdapter, eventWithoutEnd, minimumEventHeight)
        };
        if (typeof resizeEvent.edges.left !== 'undefined') {
            var daysDiff = Math.round(+resizeEvent.edges.left / this.dayColumnWidth);
            var newStart = addDaysWithExclusions(this.dateAdapter, newEventDates.start, daysDiff, this.excludeDays);
            if (newStart < smallestResizes.start) {
                newEventDates.start = newStart;
            }
            else {
                newEventDates.start = smallestResizes.start;
            }
        }
        else if (typeof resizeEvent.edges.right !== 'undefined') {
            var daysDiff = Math.round(+resizeEvent.edges.right / this.dayColumnWidth);
            var newEnd = addDaysWithExclusions(this.dateAdapter, newEventDates.end, daysDiff, this.excludeDays);
            if (newEnd > smallestResizes.end) {
                newEventDates.end = newEnd;
            }
            else {
                newEventDates.end = smallestResizes.end;
            }
        }
        if (typeof resizeEvent.edges.top !== 'undefined') {
            var minutesMoved = getMinutesMoved(resizeEvent.edges.top, this.hourSegments, this.hourSegmentHeight, this.eventSnapSize);
            var newStart = this.dateAdapter.addMinutes(newEventDates.start, minutesMoved);
            if (newStart < smallestResizes.start) {
                newEventDates.start = newStart;
            }
            else {
                newEventDates.start = smallestResizes.start;
            }
        }
        else if (typeof resizeEvent.edges.bottom !== 'undefined') {
            var minutesMoved = getMinutesMoved(resizeEvent.edges.bottom, this.hourSegments, this.hourSegmentHeight, this.eventSnapSize);
            var newEnd = this.dateAdapter.addMinutes(newEventDates.end, minutesMoved);
            if (newEnd > smallestResizes.end) {
                newEventDates.end = newEnd;
            }
            else {
                newEventDates.end = smallestResizes.end;
            }
        }
        return newEventDates;
    };
    CalendarWeekViewComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef },
        { type: CalendarUtils },
        { type: String, decorators: [{ type: Inject, args: [LOCALE_ID,] }] },
        { type: DateAdapter }
    ]; };
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Date)
    ], CalendarWeekViewComponent.prototype, "viewDate", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Array)
    ], CalendarWeekViewComponent.prototype, "events", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Array)
    ], CalendarWeekViewComponent.prototype, "excludeDays", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Subject)
    ], CalendarWeekViewComponent.prototype, "refresh", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], CalendarWeekViewComponent.prototype, "locale", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], CalendarWeekViewComponent.prototype, "tooltipPlacement", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", TemplateRef)
    ], CalendarWeekViewComponent.prototype, "tooltipTemplate", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Boolean)
    ], CalendarWeekViewComponent.prototype, "tooltipAppendToBody", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Number)
    ], CalendarWeekViewComponent.prototype, "tooltipDelay", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Number)
    ], CalendarWeekViewComponent.prototype, "weekStartsOn", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", TemplateRef)
    ], CalendarWeekViewComponent.prototype, "headerTemplate", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", TemplateRef)
    ], CalendarWeekViewComponent.prototype, "eventTemplate", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", TemplateRef)
    ], CalendarWeekViewComponent.prototype, "eventTitleTemplate", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", TemplateRef)
    ], CalendarWeekViewComponent.prototype, "eventActionsTemplate", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], CalendarWeekViewComponent.prototype, "precision", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Array)
    ], CalendarWeekViewComponent.prototype, "weekendDays", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Boolean)
    ], CalendarWeekViewComponent.prototype, "snapDraggedEvents", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Number)
    ], CalendarWeekViewComponent.prototype, "hourSegments", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Number)
    ], CalendarWeekViewComponent.prototype, "hourSegmentHeight", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Number)
    ], CalendarWeekViewComponent.prototype, "dayStartHour", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Number)
    ], CalendarWeekViewComponent.prototype, "dayStartMinute", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Number)
    ], CalendarWeekViewComponent.prototype, "dayEndHour", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Number)
    ], CalendarWeekViewComponent.prototype, "dayEndMinute", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", TemplateRef)
    ], CalendarWeekViewComponent.prototype, "hourSegmentTemplate", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Number)
    ], CalendarWeekViewComponent.prototype, "eventSnapSize", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", TemplateRef)
    ], CalendarWeekViewComponent.prototype, "allDayEventsLabelTemplate", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Number)
    ], CalendarWeekViewComponent.prototype, "daysInWeek", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", TemplateRef)
    ], CalendarWeekViewComponent.prototype, "currentTimeMarkerTemplate", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], CalendarWeekViewComponent.prototype, "dayHeaderClicked", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], CalendarWeekViewComponent.prototype, "eventClicked", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], CalendarWeekViewComponent.prototype, "eventTimesChanged", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], CalendarWeekViewComponent.prototype, "beforeViewRender", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], CalendarWeekViewComponent.prototype, "hourSegmentClicked", void 0);
    CalendarWeekViewComponent = tslib_1.__decorate([ tslib_1.__param(2, Inject(LOCALE_ID)),
        tslib_1.__metadata("design:paramtypes", [ChangeDetectorRef,
            CalendarUtils, String, DateAdapter])
    ], CalendarWeekViewComponent);
CalendarWeekViewComponent.ɵfac = function CalendarWeekViewComponent_Factory(t) { return new (t || CalendarWeekViewComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(CalendarUtils), ɵngcc0.ɵɵdirectiveInject(LOCALE_ID), ɵngcc0.ɵɵdirectiveInject(DateAdapter)); };
CalendarWeekViewComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: CalendarWeekViewComponent, selectors: [["mwl-calendar-week-view"]], inputs: { events: "events", excludeDays: "excludeDays", tooltipPlacement: "tooltipPlacement", tooltipAppendToBody: "tooltipAppendToBody", tooltipDelay: "tooltipDelay", precision: "precision", snapDraggedEvents: "snapDraggedEvents", hourSegments: "hourSegments", hourSegmentHeight: "hourSegmentHeight", dayStartHour: "dayStartHour", dayStartMinute: "dayStartMinute", dayEndHour: "dayEndHour", dayEndMinute: "dayEndMinute", locale: "locale", viewDate: "viewDate", refresh: "refresh", tooltipTemplate: "tooltipTemplate", weekStartsOn: "weekStartsOn", headerTemplate: "headerTemplate", eventTemplate: "eventTemplate", eventTitleTemplate: "eventTitleTemplate", eventActionsTemplate: "eventActionsTemplate", weekendDays: "weekendDays", hourSegmentTemplate: "hourSegmentTemplate", eventSnapSize: "eventSnapSize", allDayEventsLabelTemplate: "allDayEventsLabelTemplate", daysInWeek: "daysInWeek", currentTimeMarkerTemplate: "currentTimeMarkerTemplate" }, outputs: { dayHeaderClicked: "dayHeaderClicked", eventClicked: "eventClicked", eventTimesChanged: "eventTimesChanged", beforeViewRender: "beforeViewRender", hourSegmentClicked: "hourSegmentClicked" }, features: [ɵngcc0.ɵɵNgOnChangesFeature()], decls: 8, vars: 9, consts: [["role", "grid", 1, "cal-week-view"], [3, "days", "locale", "customTemplate", "dayHeaderClicked", "eventDropped", "dragEnter"], ["class", "cal-all-day-events", "mwlDroppable", "", 3, "dragEnter", "dragLeave", 4, "ngIf"], ["mwlDroppable", "", 1, "cal-time-events", 3, "dragEnter", "dragLeave"], ["class", "cal-time-label-column", 4, "ngIf"], [1, "cal-day-columns"], ["dayColumns", ""], ["class", "cal-day-column", 4, "ngFor", "ngForOf", "ngForTrackBy"], ["mwlDroppable", "", 1, "cal-all-day-events", 3, "dragEnter", "dragLeave"], ["allDayEventsContainer", ""], [1, "cal-time-label-column", 3, "ngTemplateOutlet"], ["class", "cal-day-column", "mwlDroppable", "", "dragOverClass", "cal-drag-over", 3, "drop", "dragEnter", 4, "ngFor", "ngForOf", "ngForTrackBy"], ["class", "cal-events-row", 4, "ngFor", "ngForOf", "ngForTrackBy"], ["mwlDroppable", "", "dragOverClass", "cal-drag-over", 1, "cal-day-column", 3, "drop", "dragEnter"], [1, "cal-events-row"], ["eventRowContainer", ""], ["class", "cal-event-container", "mwlResizable", "", "mwlDraggable", "", "dragActiveClass", "cal-drag-active", 3, "cal-draggable", "cal-starts-within-week", "cal-ends-within-week", "ngClass", "width", "marginLeft", "resizeSnapGrid", "validateResize", "dropData", "dragAxis", "dragSnapGrid", "validateDrag", "resizeStart", "resizing", "resizeEnd", "dragStart", "dragging", "dragEnd", 4, "ngFor", "ngForOf", "ngForTrackBy"], ["mwlResizable", "", "mwlDraggable", "", "dragActiveClass", "cal-drag-active", 1, "cal-event-container", 3, "ngClass", "resizeSnapGrid", "validateResize", "dropData", "dragAxis", "dragSnapGrid", "validateDrag", "resizeStart", "resizing", "resizeEnd", "dragStart", "dragging", "dragEnd"], ["event", ""], ["class", "cal-resize-handle cal-resize-handle-before-start", "mwlResizeHandle", "", 3, "resizeEdges", 4, "ngIf"], [3, "locale", "weekEvent", "tooltipPlacement", "tooltipTemplate", "tooltipAppendToBody", "tooltipDelay", "customTemplate", "eventTitleTemplate", "eventActionsTemplate", "daysInWeek", "eventClicked"], ["class", "cal-resize-handle cal-resize-handle-after-end", "mwlResizeHandle", "", 3, "resizeEdges", 4, "ngIf"], ["mwlResizeHandle", "", 1, "cal-resize-handle", "cal-resize-handle-before-start", 3, "resizeEdges"], ["mwlResizeHandle", "", 1, "cal-resize-handle", "cal-resize-handle-after-end", 3, "resizeEdges"], [1, "cal-time-label-column"], ["class", "cal-hour", 3, "cal-hour-odd", 4, "ngFor", "ngForOf", "ngForTrackBy"], [1, "cal-hour"], [3, "height", "segment", "segmentHeight", "locale", "customTemplate", "isTimeLabel", "daysInWeek", 4, "ngFor", "ngForOf", "ngForTrackBy"], [3, "segment", "segmentHeight", "locale", "customTemplate", "isTimeLabel", "daysInWeek"], [1, "cal-day-column"], [3, "columnDate", "dayStartHour", "dayStartMinute", "dayEndHour", "dayEndMinute", "hourSegments", "hourSegmentHeight", "customTemplate"], [1, "cal-events-container"], ["class", "cal-event-container", "mwlResizable", "", "mwlDraggable", "", "dragActiveClass", "cal-drag-active", 3, "cal-draggable", "cal-starts-within-day", "cal-ends-within-day", "ngClass", "hidden", "top", "height", "left", "width", "resizeSnapGrid", "validateResize", "allowNegativeResizes", "dropData", "dragAxis", "dragSnapGrid", "ghostDragEnabled", "validateDrag", "resizeStart", "resizing", "resizeEnd", "dragStart", "dragging", "dragEnd", 4, "ngFor", "ngForOf", "ngForTrackBy"], ["mwlResizable", "", "mwlDraggable", "", "dragActiveClass", "cal-drag-active", 1, "cal-event-container", 3, "ngClass", "hidden", "resizeSnapGrid", "validateResize", "allowNegativeResizes", "dropData", "dragAxis", "dragSnapGrid", "ghostDragEnabled", "validateDrag", "resizeStart", "resizing", "resizeEnd", "dragStart", "dragging", "dragEnd"], [3, "locale", "weekEvent", "tooltipPlacement", "tooltipTemplate", "tooltipAppendToBody", "tooltipDisabled", "tooltipDelay", "customTemplate", "eventTitleTemplate", "eventActionsTemplate", "column", "daysInWeek", "eventClicked"], ["mwlDroppable", "", "dragActiveClass", "cal-drag-active", 3, "height", "segment", "segmentHeight", "locale", "customTemplate", "daysInWeek", "clickListenerDisabled", "dragOverClass", "isTimeLabel", "mwlClick", "drop", "dragEnter", 4, "ngFor", "ngForOf", "ngForTrackBy"], ["mwlDroppable", "", "dragActiveClass", "cal-drag-active", 3, "segment", "segmentHeight", "locale", "customTemplate", "daysInWeek", "clickListenerDisabled", "dragOverClass", "isTimeLabel", "mwlClick", "drop", "dragEnter"]], template: function CalendarWeekViewComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "mwl-calendar-week-view-header", 1);
        ɵngcc0.ɵɵlistener("dayHeaderClicked", function CalendarWeekViewComponent_Template_mwl_calendar_week_view_header_dayHeaderClicked_1_listener($event) { return ctx.dayHeaderClicked.emit($event); })("eventDropped", function CalendarWeekViewComponent_Template_mwl_calendar_week_view_header_eventDropped_1_listener($event) { return ctx.eventDropped({ dropData: $event }, $event.newStart, true); })("dragEnter", function CalendarWeekViewComponent_Template_mwl_calendar_week_view_header_dragEnter_1_listener($event) { return ctx.dateDragEnter($event.date); });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(2, CalendarWeekViewComponent_div_2_Template, 6, 5, "div", 2);
        ɵngcc0.ɵɵelementStart(3, "div", 3);
        ɵngcc0.ɵɵlistener("dragEnter", function CalendarWeekViewComponent_Template_div_dragEnter_3_listener($event) { return ctx.dragEnter("time"); })("dragLeave", function CalendarWeekViewComponent_Template_div_dragLeave_3_listener($event) { return ctx.dragLeave("time"); });
        ɵngcc0.ɵɵtemplate(4, CalendarWeekViewComponent_div_4_Template, 2, 2, "div", 4);
        ɵngcc0.ɵɵelementStart(5, "div", 5, 6);
        ɵngcc0.ɵɵtemplate(7, CalendarWeekViewComponent_div_7_Template, 5, 12, "div", 7);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("days", ctx.days)("locale", ctx.locale)("customTemplate", ctx.headerTemplate);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.view.allDayEventRows.length > 0);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.view.hourColumns.length > 0 && ctx.daysInWeek !== 1);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵclassProp("cal-resize-active", ctx.timeEventResizes.size > 0);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.view.hourColumns)("ngForTrackBy", ctx.trackByHourColumn);
    } }, directives: [ɵngcc1.CalendarWeekViewHeaderComponent, ɵngcc2.NgIf, ɵngcc3.ɵa, ɵngcc2.NgForOf, ɵngcc2.NgTemplateOutlet, ɵngcc4.ResizableDirective, ɵngcc3.ɵb, ɵngcc2.NgClass, ɵngcc5.CalendarWeekViewEventComponent, ɵngcc4.ResizeHandleDirective, ɵngcc6.CalendarWeekViewHourSegmentComponent, ɵngcc7.CalendarWeekViewCurrentTimeMarkerComponent, ɵngcc8.ClickDirective], encapsulation: 2 });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(CalendarWeekViewComponent, [{
        type: Component,
        args: [{
                selector: 'mwl-calendar-week-view',
                template: "\n    <div class=\"cal-week-view\" role=\"grid\">\n      <mwl-calendar-week-view-header\n        [days]=\"days\"\n        [locale]=\"locale\"\n        [customTemplate]=\"headerTemplate\"\n        (dayHeaderClicked)=\"dayHeaderClicked.emit($event)\"\n        (eventDropped)=\"\n          eventDropped({ dropData: $event }, $event.newStart, true)\n        \"\n        (dragEnter)=\"dateDragEnter($event.date)\"\n      >\n      </mwl-calendar-week-view-header>\n      <div\n        class=\"cal-all-day-events\"\n        #allDayEventsContainer\n        *ngIf=\"view.allDayEventRows.length > 0\"\n        mwlDroppable\n        (dragEnter)=\"dragEnter('allDay')\"\n        (dragLeave)=\"dragLeave('allDay')\"\n      >\n        <div class=\"cal-day-columns\">\n          <div\n            class=\"cal-time-label-column\"\n            [ngTemplateOutlet]=\"allDayEventsLabelTemplate\"\n          ></div>\n          <div\n            class=\"cal-day-column\"\n            *ngFor=\"let day of days; trackBy: trackByWeekDayHeaderDate\"\n            mwlDroppable\n            dragOverClass=\"cal-drag-over\"\n            (drop)=\"eventDropped($event, day.date, true)\"\n            (dragEnter)=\"dateDragEnter(day.date)\"\n          ></div>\n        </div>\n        <div\n          *ngFor=\"let eventRow of view.allDayEventRows; trackBy: trackById\"\n          #eventRowContainer\n          class=\"cal-events-row\"\n        >\n          <div\n            *ngFor=\"\n              let allDayEvent of eventRow.row;\n              trackBy: trackByWeekAllDayEvent\n            \"\n            #event\n            class=\"cal-event-container\"\n            [class.cal-draggable]=\"\n              allDayEvent.event.draggable && allDayEventResizes.size === 0\n            \"\n            [class.cal-starts-within-week]=\"!allDayEvent.startsBeforeWeek\"\n            [class.cal-ends-within-week]=\"!allDayEvent.endsAfterWeek\"\n            [ngClass]=\"allDayEvent.event?.cssClass\"\n            [style.width.%]=\"(100 / days.length) * allDayEvent.span\"\n            [style.marginLeft.%]=\"(100 / days.length) * allDayEvent.offset\"\n            mwlResizable\n            [resizeSnapGrid]=\"{ left: dayColumnWidth, right: dayColumnWidth }\"\n            [validateResize]=\"validateResize\"\n            (resizeStart)=\"\n              allDayEventResizeStarted(eventRowContainer, allDayEvent, $event)\n            \"\n            (resizing)=\"\n              allDayEventResizing(allDayEvent, $event, dayColumnWidth)\n            \"\n            (resizeEnd)=\"allDayEventResizeEnded(allDayEvent)\"\n            mwlDraggable\n            dragActiveClass=\"cal-drag-active\"\n            [dropData]=\"{ event: allDayEvent.event, calendarId: calendarId }\"\n            [dragAxis]=\"{\n              x: allDayEvent.event.draggable && allDayEventResizes.size === 0,\n              y:\n                !snapDraggedEvents &&\n                allDayEvent.event.draggable &&\n                allDayEventResizes.size === 0\n            }\"\n            [dragSnapGrid]=\"snapDraggedEvents ? { x: dayColumnWidth } : {}\"\n            [validateDrag]=\"validateDrag\"\n            (dragStart)=\"dragStarted(eventRowContainer, event)\"\n            (dragging)=\"allDayEventDragMove()\"\n            (dragEnd)=\"dragEnded(allDayEvent, $event, dayColumnWidth)\"\n          >\n            <div\n              class=\"cal-resize-handle cal-resize-handle-before-start\"\n              *ngIf=\"\n                allDayEvent.event?.resizable?.beforeStart &&\n                !allDayEvent.startsBeforeWeek\n              \"\n              mwlResizeHandle\n              [resizeEdges]=\"{ left: true }\"\n            ></div>\n            <mwl-calendar-week-view-event\n              [locale]=\"locale\"\n              [weekEvent]=\"allDayEvent\"\n              [tooltipPlacement]=\"tooltipPlacement\"\n              [tooltipTemplate]=\"tooltipTemplate\"\n              [tooltipAppendToBody]=\"tooltipAppendToBody\"\n              [tooltipDelay]=\"tooltipDelay\"\n              [customTemplate]=\"eventTemplate\"\n              [eventTitleTemplate]=\"eventTitleTemplate\"\n              [eventActionsTemplate]=\"eventActionsTemplate\"\n              [daysInWeek]=\"daysInWeek\"\n              (eventClicked)=\"\n                eventClicked.emit({\n                  event: allDayEvent.event,\n                  sourceEvent: $event.sourceEvent\n                })\n              \"\n            >\n            </mwl-calendar-week-view-event>\n            <div\n              class=\"cal-resize-handle cal-resize-handle-after-end\"\n              *ngIf=\"\n                allDayEvent.event?.resizable?.afterEnd &&\n                !allDayEvent.endsAfterWeek\n              \"\n              mwlResizeHandle\n              [resizeEdges]=\"{ right: true }\"\n            ></div>\n          </div>\n        </div>\n      </div>\n      <div\n        class=\"cal-time-events\"\n        mwlDroppable\n        (dragEnter)=\"dragEnter('time')\"\n        (dragLeave)=\"dragLeave('time')\"\n      >\n        <div\n          class=\"cal-time-label-column\"\n          *ngIf=\"view.hourColumns.length > 0 && daysInWeek !== 1\"\n        >\n          <div\n            *ngFor=\"\n              let hour of view.hourColumns[0].hours;\n              trackBy: trackByHour;\n              let odd = odd\n            \"\n            class=\"cal-hour\"\n            [class.cal-hour-odd]=\"odd\"\n          >\n            <mwl-calendar-week-view-hour-segment\n              *ngFor=\"let segment of hour.segments; trackBy: trackByHourSegment\"\n              [style.height.px]=\"hourSegmentHeight\"\n              [segment]=\"segment\"\n              [segmentHeight]=\"hourSegmentHeight\"\n              [locale]=\"locale\"\n              [customTemplate]=\"hourSegmentTemplate\"\n              [isTimeLabel]=\"true\"\n              [daysInWeek]=\"daysInWeek\"\n            >\n            </mwl-calendar-week-view-hour-segment>\n          </div>\n        </div>\n        <div\n          class=\"cal-day-columns\"\n          [class.cal-resize-active]=\"timeEventResizes.size > 0\"\n          #dayColumns\n        >\n          <div\n            class=\"cal-day-column\"\n            *ngFor=\"let column of view.hourColumns; trackBy: trackByHourColumn\"\n          >\n            <mwl-calendar-week-view-current-time-marker\n              [columnDate]=\"column.date\"\n              [dayStartHour]=\"dayStartHour\"\n              [dayStartMinute]=\"dayStartMinute\"\n              [dayEndHour]=\"dayEndHour\"\n              [dayEndMinute]=\"dayEndMinute\"\n              [hourSegments]=\"hourSegments\"\n              [hourSegmentHeight]=\"hourSegmentHeight\"\n              [customTemplate]=\"currentTimeMarkerTemplate\"\n            ></mwl-calendar-week-view-current-time-marker>\n            <div class=\"cal-events-container\">\n              <div\n                *ngFor=\"\n                  let timeEvent of column.events;\n                  trackBy: trackByWeekTimeEvent\n                \"\n                #event\n                class=\"cal-event-container\"\n                [class.cal-draggable]=\"\n                  timeEvent.event.draggable && timeEventResizes.size === 0\n                \"\n                [class.cal-starts-within-day]=\"!timeEvent.startsBeforeDay\"\n                [class.cal-ends-within-day]=\"!timeEvent.endsAfterDay\"\n                [ngClass]=\"timeEvent.event.cssClass\"\n                [hidden]=\"timeEvent.height === 0 && timeEvent.width === 0\"\n                [style.top.px]=\"timeEvent.top\"\n                [style.height.px]=\"timeEvent.height\"\n                [style.left.%]=\"timeEvent.left\"\n                [style.width.%]=\"timeEvent.width\"\n                mwlResizable\n                [resizeSnapGrid]=\"{\n                  left: dayColumnWidth,\n                  right: dayColumnWidth,\n                  top: eventSnapSize || hourSegmentHeight,\n                  bottom: eventSnapSize || hourSegmentHeight\n                }\"\n                [validateResize]=\"validateResize\"\n                [allowNegativeResizes]=\"true\"\n                (resizeStart)=\"\n                  timeEventResizeStarted(dayColumns, timeEvent, $event)\n                \"\n                (resizing)=\"timeEventResizing(timeEvent, $event)\"\n                (resizeEnd)=\"timeEventResizeEnded(timeEvent)\"\n                mwlDraggable\n                dragActiveClass=\"cal-drag-active\"\n                [dropData]=\"{ event: timeEvent.event, calendarId: calendarId }\"\n                [dragAxis]=\"{\n                  x: timeEvent.event.draggable && timeEventResizes.size === 0,\n                  y: timeEvent.event.draggable && timeEventResizes.size === 0\n                }\"\n                [dragSnapGrid]=\"\n                  snapDraggedEvents\n                    ? {\n                        x: dayColumnWidth,\n                        y: eventSnapSize || hourSegmentHeight\n                      }\n                    : {}\n                \"\n                [ghostDragEnabled]=\"!snapDraggedEvents\"\n                [validateDrag]=\"validateDrag\"\n                (dragStart)=\"dragStarted(dayColumns, event, timeEvent)\"\n                (dragging)=\"dragMove(timeEvent, $event)\"\n                (dragEnd)=\"dragEnded(timeEvent, $event, dayColumnWidth, true)\"\n              >\n                <div\n                  class=\"cal-resize-handle cal-resize-handle-before-start\"\n                  *ngIf=\"\n                    timeEvent.event?.resizable?.beforeStart &&\n                    !timeEvent.startsBeforeDay\n                  \"\n                  mwlResizeHandle\n                  [resizeEdges]=\"{\n                    left: true,\n                    top: true\n                  }\"\n                ></div>\n                <mwl-calendar-week-view-event\n                  [locale]=\"locale\"\n                  [weekEvent]=\"timeEvent\"\n                  [tooltipPlacement]=\"tooltipPlacement\"\n                  [tooltipTemplate]=\"tooltipTemplate\"\n                  [tooltipAppendToBody]=\"tooltipAppendToBody\"\n                  [tooltipDisabled]=\"dragActive || timeEventResizes.size > 0\"\n                  [tooltipDelay]=\"tooltipDelay\"\n                  [customTemplate]=\"eventTemplate\"\n                  [eventTitleTemplate]=\"eventTitleTemplate\"\n                  [eventActionsTemplate]=\"eventActionsTemplate\"\n                  [column]=\"column\"\n                  [daysInWeek]=\"daysInWeek\"\n                  (eventClicked)=\"\n                    eventClicked.emit({\n                      event: timeEvent.event,\n                      sourceEvent: $event.sourceEvent\n                    })\n                  \"\n                >\n                </mwl-calendar-week-view-event>\n                <div\n                  class=\"cal-resize-handle cal-resize-handle-after-end\"\n                  *ngIf=\"\n                    timeEvent.event?.resizable?.afterEnd &&\n                    !timeEvent.endsAfterDay\n                  \"\n                  mwlResizeHandle\n                  [resizeEdges]=\"{\n                    right: true,\n                    bottom: true\n                  }\"\n                ></div>\n              </div>\n            </div>\n\n            <div\n              *ngFor=\"\n                let hour of column.hours;\n                trackBy: trackByHour;\n                let odd = odd\n              \"\n              class=\"cal-hour\"\n              [class.cal-hour-odd]=\"odd\"\n            >\n              <mwl-calendar-week-view-hour-segment\n                *ngFor=\"\n                  let segment of hour.segments;\n                  trackBy: trackByHourSegment\n                \"\n                [style.height.px]=\"hourSegmentHeight\"\n                [segment]=\"segment\"\n                [segmentHeight]=\"hourSegmentHeight\"\n                [locale]=\"locale\"\n                [customTemplate]=\"hourSegmentTemplate\"\n                [daysInWeek]=\"daysInWeek\"\n                (mwlClick)=\"\n                  hourSegmentClicked.emit({\n                    date: segment.date,\n                    sourceEvent: $event\n                  })\n                \"\n                [clickListenerDisabled]=\"\n                  hourSegmentClicked.observers.length === 0\n                \"\n                mwlDroppable\n                [dragOverClass]=\"\n                  !dragActive || !snapDraggedEvents ? 'cal-drag-over' : null\n                \"\n                dragActiveClass=\"cal-drag-active\"\n                (drop)=\"eventDropped($event, segment.date, false)\"\n                (dragEnter)=\"dateDragEnter(segment.date)\"\n                [isTimeLabel]=\"daysInWeek === 1\"\n              >\n              </mwl-calendar-week-view-hour-segment>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  "
            }]
    }], function () { return [{ type: ɵngcc0.ChangeDetectorRef }, { type: CalendarUtils }, { type: String, decorators: [{
                type: Inject,
                args: [LOCALE_ID]
            }] }, { type: DateAdapter }]; }, { events: [{
            type: Input
        }], excludeDays: [{
            type: Input
        }], tooltipPlacement: [{
            type: Input
        }], tooltipAppendToBody: [{
            type: Input
        }], tooltipDelay: [{
            type: Input
        }], precision: [{
            type: Input
        }], snapDraggedEvents: [{
            type: Input
        }], hourSegments: [{
            type: Input
        }], hourSegmentHeight: [{
            type: Input
        }], dayStartHour: [{
            type: Input
        }], dayStartMinute: [{
            type: Input
        }], dayEndHour: [{
            type: Input
        }], dayEndMinute: [{
            type: Input
        }], dayHeaderClicked: [{
            type: Output
        }], eventClicked: [{
            type: Output
        }], eventTimesChanged: [{
            type: Output
        }], beforeViewRender: [{
            type: Output
        }], hourSegmentClicked: [{
            type: Output
        }], locale: [{
            type: Input
        }], viewDate: [{
            type: Input
        }], refresh: [{
            type: Input
        }], tooltipTemplate: [{
            type: Input
        }], weekStartsOn: [{
            type: Input
        }], headerTemplate: [{
            type: Input
        }], eventTemplate: [{
            type: Input
        }], eventTitleTemplate: [{
            type: Input
        }], eventActionsTemplate: [{
            type: Input
        }], weekendDays: [{
            type: Input
        }], hourSegmentTemplate: [{
            type: Input
        }], eventSnapSize: [{
            type: Input
        }], allDayEventsLabelTemplate: [{
            type: Input
        }], daysInWeek: [{
            type: Input
        }], currentTimeMarkerTemplate: [{
            type: Input
        }] }); })();
    return CalendarWeekViewComponent;
}());
export { CalendarWeekViewComponent };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYWNwcm8va3JpdHNhZGVlL1NWTi9DeWJlcnNvZnQvYXBleC9ub2RlX21vZHVsZXMvYW5ndWxhci1jYWxlbmRhci9lc201L21vZHVsZXMvd2Vlay9jYWxlbmRhci13ZWVrLXZpZXcuY29tcG9uZW50LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBbUJBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0RBa3JCb0QsQUFLN0M7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBRzJCIiwiZmlsZSI6ImNhbGVuZGFyLXdlZWstdmlldy5jb21wb25lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyB0c2xpYl8xIGZyb20gXCJ0c2xpYlwiO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIENoYW5nZURldGVjdG9yUmVmLCBPbkNoYW5nZXMsIE9uSW5pdCwgT25EZXN0cm95LCBMT0NBTEVfSUQsIEluamVjdCwgVGVtcGxhdGVSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IENhbGVuZGFyRHJhZ0hlbHBlciB9IGZyb20gJy4uL2NvbW1vbi9jYWxlbmRhci1kcmFnLWhlbHBlci5wcm92aWRlcic7XG5pbXBvcnQgeyBDYWxlbmRhclJlc2l6ZUhlbHBlciB9IGZyb20gJy4uL2NvbW1vbi9jYWxlbmRhci1yZXNpemUtaGVscGVyLnByb3ZpZGVyJztcbmltcG9ydCB7IENhbGVuZGFyRXZlbnRUaW1lc0NoYW5nZWRFdmVudFR5cGUgfSBmcm9tICcuLi9jb21tb24vY2FsZW5kYXItZXZlbnQtdGltZXMtY2hhbmdlZC1ldmVudC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgQ2FsZW5kYXJVdGlscyB9IGZyb20gJy4uL2NvbW1vbi9jYWxlbmRhci11dGlscy5wcm92aWRlcic7XG5pbXBvcnQgeyB2YWxpZGF0ZUV2ZW50cywgcm91bmRUb05lYXJlc3QsIHRyYWNrQnlXZWVrRGF5SGVhZGVyRGF0ZSwgdHJhY2tCeUhvdXJTZWdtZW50LCB0cmFja0J5SG91ciwgZ2V0TWludXRlc01vdmVkLCBnZXREZWZhdWx0RXZlbnRFbmQsIGdldE1pbmltdW1FdmVudEhlaWdodEluTWludXRlcywgYWRkRGF5c1dpdGhFeGNsdXNpb25zLCBpc0RyYWdnZWRXaXRoaW5QZXJpb2QsIHNob3VsZEZpcmVEcm9wcGVkRXZlbnQsIGdldFdlZWtWaWV3UGVyaW9kLCB0cmFja0J5V2Vla0FsbERheUV2ZW50LCB0cmFja0J5V2Vla1RpbWVFdmVudCB9IGZyb20gJy4uL2NvbW1vbi91dGlsJztcbmltcG9ydCB7IERhdGVBZGFwdGVyIH0gZnJvbSAnLi4vLi4vZGF0ZS1hZGFwdGVycy9kYXRlLWFkYXB0ZXInO1xuLyoqXG4gKiBTaG93cyBhbGwgZXZlbnRzIG9uIGEgZ2l2ZW4gd2Vlay4gRXhhbXBsZSB1c2FnZTpcbiAqXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiA8bXdsLWNhbGVuZGFyLXdlZWstdmlld1xuICogIFt2aWV3RGF0ZV09XCJ2aWV3RGF0ZVwiXG4gKiAgW2V2ZW50c109XCJldmVudHNcIj5cbiAqIDwvbXdsLWNhbGVuZGFyLXdlZWstdmlldz5cbiAqIGBgYFxuICovXG52YXIgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgZnVuY3Rpb24gQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudChjZHIsIHV0aWxzLCBsb2NhbGUsIGRhdGVBZGFwdGVyKSB7XG4gICAgICAgIHRoaXMuY2RyID0gY2RyO1xuICAgICAgICB0aGlzLnV0aWxzID0gdXRpbHM7XG4gICAgICAgIHRoaXMuZGF0ZUFkYXB0ZXIgPSBkYXRlQWRhcHRlcjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFuIGFycmF5IG9mIGV2ZW50cyB0byBkaXNwbGF5IG9uIHZpZXdcbiAgICAgICAgICogVGhlIHNjaGVtYSBpcyBhdmFpbGFibGUgaGVyZTogaHR0cHM6Ly9naXRodWIuY29tL21hdHRsZXdpczkyL2NhbGVuZGFyLXV0aWxzL2Jsb2IvYzUxNjg5OTg1ZjU5YTI3MTk0MGUzMGJjNGUyYzRlMWZlZTNmY2I1Yy9zcmMvY2FsZW5kYXJVdGlscy50cyNMNDktTDYzXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmV2ZW50cyA9IFtdO1xuICAgICAgICAvKipcbiAgICAgICAgICogQW4gYXJyYXkgb2YgZGF5IGluZGV4ZXMgKDAgPSBzdW5kYXksIDEgPSBtb25kYXkgZXRjKSB0aGF0IHdpbGwgYmUgaGlkZGVuIG9uIHRoZSB2aWV3XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmV4Y2x1ZGVEYXlzID0gW107XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcGxhY2VtZW50IG9mIHRoZSBldmVudCB0b29sdGlwXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRvb2x0aXBQbGFjZW1lbnQgPSAnYXV0byc7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRvIGFwcGVuZCB0b29sdGlwcyB0byB0aGUgYm9keSBvciBuZXh0IHRvIHRoZSB0cmlnZ2VyIGVsZW1lbnRcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudG9vbHRpcEFwcGVuZFRvQm9keSA9IHRydWU7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgZGVsYXkgaW4gbWlsbGlzZWNvbmRzIGJlZm9yZSB0aGUgdG9vbHRpcCBzaG91bGQgYmUgZGlzcGxheWVkLiBJZiBub3QgcHJvdmlkZWQgdGhlIHRvb2x0aXBcbiAgICAgICAgICogd2lsbCBiZSBkaXNwbGF5ZWQgaW1tZWRpYXRlbHkuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRvb2x0aXBEZWxheSA9IG51bGw7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcHJlY2lzaW9uIHRvIGRpc3BsYXkgZXZlbnRzLlxuICAgICAgICAgKiBgZGF5c2Agd2lsbCByb3VuZCBldmVudCBzdGFydCBhbmQgZW5kIGRhdGVzIHRvIHRoZSBuZWFyZXN0IGRheSBhbmQgYG1pbnV0ZXNgIHdpbGwgbm90IGRvIHRoaXMgcm91bmRpbmdcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucHJlY2lzaW9uID0gJ2RheXMnO1xuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0byBzbmFwIGV2ZW50cyB0byBhIGdyaWQgd2hlbiBkcmFnZ2luZ1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zbmFwRHJhZ2dlZEV2ZW50cyA9IHRydWU7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIGluIGFuIGhvdXIuIE11c3QgYmUgPD0gNlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5ob3VyU2VnbWVudHMgPSAyO1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGhlaWdodCBpbiBwaXhlbHMgb2YgZWFjaCBob3VyIHNlZ21lbnRcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuaG91clNlZ21lbnRIZWlnaHQgPSAzMDtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBkYXkgc3RhcnQgaG91cnMgaW4gMjQgaG91ciB0aW1lLiBNdXN0IGJlIDAtMjNcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZGF5U3RhcnRIb3VyID0gMDtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBkYXkgc3RhcnQgbWludXRlcy4gTXVzdCBiZSAwLTU5XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRheVN0YXJ0TWludXRlID0gMDtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBkYXkgZW5kIGhvdXJzIGluIDI0IGhvdXIgdGltZS4gTXVzdCBiZSAwLTIzXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRheUVuZEhvdXIgPSAyMztcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBkYXkgZW5kIG1pbnV0ZXMuIE11c3QgYmUgMC01OVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5kYXlFbmRNaW51dGUgPSA1OTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhbGxlZCB3aGVuIGEgaGVhZGVyIHdlZWsgZGF5IGlzIGNsaWNrZWQuIEFkZGluZyBhIGBjc3NDbGFzc2AgcHJvcGVydHkgb24gYCRldmVudC5kYXlgIHdpbGwgYWRkIHRoYXQgY2xhc3MgdG8gdGhlIGhlYWRlciBlbGVtZW50XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRheUhlYWRlckNsaWNrZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDYWxsZWQgd2hlbiB0aGUgZXZlbnQgdGl0bGUgaXMgY2xpY2tlZFxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5ldmVudENsaWNrZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDYWxsZWQgd2hlbiBhbiBldmVudCBpcyByZXNpemVkIG9yIGRyYWdnZWQgYW5kIGRyb3BwZWRcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZXZlbnRUaW1lc0NoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBbiBvdXRwdXQgdGhhdCB3aWxsIGJlIGNhbGxlZCBiZWZvcmUgdGhlIHZpZXcgaXMgcmVuZGVyZWQgZm9yIHRoZSBjdXJyZW50IHdlZWsuXG4gICAgICAgICAqIElmIHlvdSBhZGQgdGhlIGBjc3NDbGFzc2AgcHJvcGVydHkgdG8gYSBkYXkgaW4gdGhlIGhlYWRlciBpdCB3aWxsIGFkZCB0aGF0IGNsYXNzIHRvIHRoZSBjZWxsIGVsZW1lbnQgaW4gdGhlIHRlbXBsYXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmJlZm9yZVZpZXdSZW5kZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDYWxsZWQgd2hlbiBhbiBob3VyIHNlZ21lbnQgaXMgY2xpY2tlZFxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5ob3VyU2VnbWVudENsaWNrZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAaGlkZGVuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFsbERheUV2ZW50UmVzaXplcyA9IG5ldyBNYXAoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBoaWRkZW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudGltZUV2ZW50UmVzaXplcyA9IG5ldyBNYXAoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBoaWRkZW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZXZlbnREcmFnRW50ZXJCeVR5cGUgPSB7XG4gICAgICAgICAgICBhbGxEYXk6IDAsXG4gICAgICAgICAgICB0aW1lOiAwXG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAaGlkZGVuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRyYWdBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBoaWRkZW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZHJhZ0FscmVhZHlNb3ZlZCA9IGZhbHNlO1xuICAgICAgICAvKipcbiAgICAgICAgICogQGhpZGRlblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jYWxlbmRhcklkID0gU3ltYm9sKCdhbmd1bGFyIGNhbGVuZGFyIHdlZWsgdmlldyBpZCcpO1xuICAgICAgICAvKipcbiAgICAgICAgICogQGhpZGRlblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50cmFja0J5V2Vla0RheUhlYWRlckRhdGUgPSB0cmFja0J5V2Vla0RheUhlYWRlckRhdGU7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAaGlkZGVuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRyYWNrQnlIb3VyU2VnbWVudCA9IHRyYWNrQnlIb3VyU2VnbWVudDtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBoaWRkZW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudHJhY2tCeUhvdXIgPSB0cmFja0J5SG91cjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBoaWRkZW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudHJhY2tCeVdlZWtBbGxEYXlFdmVudCA9IHRyYWNrQnlXZWVrQWxsRGF5RXZlbnQ7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAaGlkZGVuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRyYWNrQnlXZWVrVGltZUV2ZW50ID0gdHJhY2tCeVdlZWtUaW1lRXZlbnQ7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAaGlkZGVuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRyYWNrQnlIb3VyQ29sdW1uID0gZnVuY3Rpb24gKGluZGV4LCBjb2x1bW4pIHtcbiAgICAgICAgICAgIHJldHVybiBjb2x1bW4uaG91cnNbMF0gPyBjb2x1bW4uaG91cnNbMF0uc2VnbWVudHNbMF0uZGF0ZS50b0lTT1N0cmluZygpIDogY29sdW1uO1xuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogQGhpZGRlblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50cmFja0J5SWQgPSBmdW5jdGlvbiAoaW5kZXgsIHJvdykgeyByZXR1cm4gcm93LmlkOyB9O1xuICAgICAgICB0aGlzLmxvY2FsZSA9IGxvY2FsZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQucHJvdG90eXBlLm5nT25Jbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5yZWZyZXNoKSB7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2hTdWJzY3JpcHRpb24gPSB0aGlzLnJlZnJlc2guc3Vic2NyaWJlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfdGhpcy5yZWZyZXNoQWxsKCk7XG4gICAgICAgICAgICAgICAgX3RoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZS5uZ09uQ2hhbmdlcyA9IGZ1bmN0aW9uIChjaGFuZ2VzKSB7XG4gICAgICAgIHZhciByZWZyZXNoSGVhZGVyID0gY2hhbmdlcy52aWV3RGF0ZSB8fFxuICAgICAgICAgICAgY2hhbmdlcy5leGNsdWRlRGF5cyB8fFxuICAgICAgICAgICAgY2hhbmdlcy53ZWVrZW5kRGF5cyB8fFxuICAgICAgICAgICAgY2hhbmdlcy5kYXlzSW5XZWVrIHx8XG4gICAgICAgICAgICBjaGFuZ2VzLndlZWtTdGFydHNPbjtcbiAgICAgICAgdmFyIHJlZnJlc2hCb2R5ID0gY2hhbmdlcy52aWV3RGF0ZSB8fFxuICAgICAgICAgICAgY2hhbmdlcy5kYXlTdGFydEhvdXIgfHxcbiAgICAgICAgICAgIGNoYW5nZXMuZGF5U3RhcnRNaW51dGUgfHxcbiAgICAgICAgICAgIGNoYW5nZXMuZGF5RW5kSG91ciB8fFxuICAgICAgICAgICAgY2hhbmdlcy5kYXlFbmRNaW51dGUgfHxcbiAgICAgICAgICAgIGNoYW5nZXMuaG91clNlZ21lbnRzIHx8XG4gICAgICAgICAgICBjaGFuZ2VzLndlZWtTdGFydHNPbiB8fFxuICAgICAgICAgICAgY2hhbmdlcy53ZWVrZW5kRGF5cyB8fFxuICAgICAgICAgICAgY2hhbmdlcy5leGNsdWRlRGF5cyB8fFxuICAgICAgICAgICAgY2hhbmdlcy5ob3VyU2VnbWVudEhlaWdodCB8fFxuICAgICAgICAgICAgY2hhbmdlcy5ldmVudHMgfHxcbiAgICAgICAgICAgIGNoYW5nZXMuZGF5c0luV2VlaztcbiAgICAgICAgaWYgKHJlZnJlc2hIZWFkZXIpIHtcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaEhlYWRlcigpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjaGFuZ2VzLmV2ZW50cykge1xuICAgICAgICAgICAgdmFsaWRhdGVFdmVudHModGhpcy5ldmVudHMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZWZyZXNoQm9keSkge1xuICAgICAgICAgICAgdGhpcy5yZWZyZXNoQm9keSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZWZyZXNoSGVhZGVyIHx8IHJlZnJlc2hCb2R5KSB7XG4gICAgICAgICAgICB0aGlzLmVtaXRCZWZvcmVWaWV3UmVuZGVyKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZS5uZ09uRGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMucmVmcmVzaFN1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgdGhpcy5yZWZyZXNoU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQucHJvdG90eXBlLnJlc2l6ZVN0YXJ0ZWQgPSBmdW5jdGlvbiAoZXZlbnRzQ29udGFpbmVyLCBtaW5XaWR0aCkge1xuICAgICAgICB0aGlzLmRheUNvbHVtbldpZHRoID0gdGhpcy5nZXREYXlDb2x1bW5XaWR0aChldmVudHNDb250YWluZXIpO1xuICAgICAgICB2YXIgcmVzaXplSGVscGVyID0gbmV3IENhbGVuZGFyUmVzaXplSGVscGVyKGV2ZW50c0NvbnRhaW5lciwgbWluV2lkdGgpO1xuICAgICAgICB0aGlzLnZhbGlkYXRlUmVzaXplID0gZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICB2YXIgcmVjdGFuZ2xlID0gX2EucmVjdGFuZ2xlO1xuICAgICAgICAgICAgcmV0dXJuIHJlc2l6ZUhlbHBlci52YWxpZGF0ZVJlc2l6ZSh7IHJlY3RhbmdsZTogcmVjdGFuZ2xlIH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZS50aW1lRXZlbnRSZXNpemVTdGFydGVkID0gZnVuY3Rpb24gKGV2ZW50c0NvbnRhaW5lciwgdGltZUV2ZW50LCByZXNpemVFdmVudCkge1xuICAgICAgICB0aGlzLnRpbWVFdmVudFJlc2l6ZXMuc2V0KHRpbWVFdmVudC5ldmVudCwgcmVzaXplRXZlbnQpO1xuICAgICAgICB0aGlzLnJlc2l6ZVN0YXJ0ZWQoZXZlbnRzQ29udGFpbmVyKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZS50aW1lRXZlbnRSZXNpemluZyA9IGZ1bmN0aW9uICh0aW1lRXZlbnQsIHJlc2l6ZUV2ZW50KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMudGltZUV2ZW50UmVzaXplcy5zZXQodGltZUV2ZW50LmV2ZW50LCByZXNpemVFdmVudCk7XG4gICAgICAgIHZhciBhZGp1c3RlZEV2ZW50cyA9IG5ldyBNYXAoKTtcbiAgICAgICAgdmFyIHRlbXBFdmVudHMgPSB0c2xpYl8xLl9fc3ByZWFkKHRoaXMuZXZlbnRzKTtcbiAgICAgICAgdGhpcy50aW1lRXZlbnRSZXNpemVzLmZvckVhY2goZnVuY3Rpb24gKGxhc3RSZXNpemVFdmVudCwgZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciBuZXdFdmVudERhdGVzID0gX3RoaXMuZ2V0VGltZUV2ZW50UmVzaXplZERhdGVzKGV2ZW50LCBsYXN0UmVzaXplRXZlbnQpO1xuICAgICAgICAgICAgdmFyIGFkanVzdGVkRXZlbnQgPSB0c2xpYl8xLl9fYXNzaWduKHt9LCBldmVudCwgbmV3RXZlbnREYXRlcyk7XG4gICAgICAgICAgICBhZGp1c3RlZEV2ZW50cy5zZXQoYWRqdXN0ZWRFdmVudCwgZXZlbnQpO1xuICAgICAgICAgICAgdmFyIGV2ZW50SW5kZXggPSB0ZW1wRXZlbnRzLmluZGV4T2YoZXZlbnQpO1xuICAgICAgICAgICAgdGVtcEV2ZW50c1tldmVudEluZGV4XSA9IGFkanVzdGVkRXZlbnQ7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlc3RvcmVPcmlnaW5hbEV2ZW50cyh0ZW1wRXZlbnRzLCBhZGp1c3RlZEV2ZW50cyk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudC5wcm90b3R5cGUudGltZUV2ZW50UmVzaXplRW5kZWQgPSBmdW5jdGlvbiAodGltZUV2ZW50KSB7XG4gICAgICAgIHRoaXMudmlldyA9IHRoaXMuZ2V0V2Vla1ZpZXcodGhpcy5ldmVudHMpO1xuICAgICAgICB2YXIgbGFzdFJlc2l6ZUV2ZW50ID0gdGhpcy50aW1lRXZlbnRSZXNpemVzLmdldCh0aW1lRXZlbnQuZXZlbnQpO1xuICAgICAgICBpZiAobGFzdFJlc2l6ZUV2ZW50KSB7XG4gICAgICAgICAgICB0aGlzLnRpbWVFdmVudFJlc2l6ZXMuZGVsZXRlKHRpbWVFdmVudC5ldmVudCk7XG4gICAgICAgICAgICB2YXIgbmV3RXZlbnREYXRlcyA9IHRoaXMuZ2V0VGltZUV2ZW50UmVzaXplZERhdGVzKHRpbWVFdmVudC5ldmVudCwgbGFzdFJlc2l6ZUV2ZW50KTtcbiAgICAgICAgICAgIHRoaXMuZXZlbnRUaW1lc0NoYW5nZWQuZW1pdCh7XG4gICAgICAgICAgICAgICAgbmV3U3RhcnQ6IG5ld0V2ZW50RGF0ZXMuc3RhcnQsXG4gICAgICAgICAgICAgICAgbmV3RW5kOiBuZXdFdmVudERhdGVzLmVuZCxcbiAgICAgICAgICAgICAgICBldmVudDogdGltZUV2ZW50LmV2ZW50LFxuICAgICAgICAgICAgICAgIHR5cGU6IENhbGVuZGFyRXZlbnRUaW1lc0NoYW5nZWRFdmVudFR5cGUuUmVzaXplXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQucHJvdG90eXBlLmFsbERheUV2ZW50UmVzaXplU3RhcnRlZCA9IGZ1bmN0aW9uIChhbGxEYXlFdmVudHNDb250YWluZXIsIGFsbERheUV2ZW50LCByZXNpemVFdmVudCkge1xuICAgICAgICB0aGlzLmFsbERheUV2ZW50UmVzaXplcy5zZXQoYWxsRGF5RXZlbnQsIHtcbiAgICAgICAgICAgIG9yaWdpbmFsT2Zmc2V0OiBhbGxEYXlFdmVudC5vZmZzZXQsXG4gICAgICAgICAgICBvcmlnaW5hbFNwYW46IGFsbERheUV2ZW50LnNwYW4sXG4gICAgICAgICAgICBlZGdlOiB0eXBlb2YgcmVzaXplRXZlbnQuZWRnZXMubGVmdCAhPT0gJ3VuZGVmaW5lZCcgPyAnbGVmdCcgOiAncmlnaHQnXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJlc2l6ZVN0YXJ0ZWQoYWxsRGF5RXZlbnRzQ29udGFpbmVyLCB0aGlzLmdldERheUNvbHVtbldpZHRoKGFsbERheUV2ZW50c0NvbnRhaW5lcikpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQucHJvdG90eXBlLmFsbERheUV2ZW50UmVzaXppbmcgPSBmdW5jdGlvbiAoYWxsRGF5RXZlbnQsIHJlc2l6ZUV2ZW50LCBkYXlXaWR0aCkge1xuICAgICAgICB2YXIgY3VycmVudFJlc2l6ZSA9IHRoaXMuYWxsRGF5RXZlbnRSZXNpemVzLmdldChhbGxEYXlFdmVudCk7XG4gICAgICAgIGlmICh0eXBlb2YgcmVzaXplRXZlbnQuZWRnZXMubGVmdCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHZhciBkaWZmID0gTWF0aC5yb3VuZCgrcmVzaXplRXZlbnQuZWRnZXMubGVmdCAvIGRheVdpZHRoKTtcbiAgICAgICAgICAgIGFsbERheUV2ZW50Lm9mZnNldCA9IGN1cnJlbnRSZXNpemUub3JpZ2luYWxPZmZzZXQgKyBkaWZmO1xuICAgICAgICAgICAgYWxsRGF5RXZlbnQuc3BhbiA9IGN1cnJlbnRSZXNpemUub3JpZ2luYWxTcGFuIC0gZGlmZjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlb2YgcmVzaXplRXZlbnQuZWRnZXMucmlnaHQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB2YXIgZGlmZiA9IE1hdGgucm91bmQoK3Jlc2l6ZUV2ZW50LmVkZ2VzLnJpZ2h0IC8gZGF5V2lkdGgpO1xuICAgICAgICAgICAgYWxsRGF5RXZlbnQuc3BhbiA9IGN1cnJlbnRSZXNpemUub3JpZ2luYWxTcGFuICsgZGlmZjtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQucHJvdG90eXBlLmFsbERheUV2ZW50UmVzaXplRW5kZWQgPSBmdW5jdGlvbiAoYWxsRGF5RXZlbnQpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRSZXNpemUgPSB0aGlzLmFsbERheUV2ZW50UmVzaXplcy5nZXQoYWxsRGF5RXZlbnQpO1xuICAgICAgICBpZiAoY3VycmVudFJlc2l6ZSkge1xuICAgICAgICAgICAgdmFyIGFsbERheUV2ZW50UmVzaXppbmdCZWZvcmVTdGFydCA9IGN1cnJlbnRSZXNpemUuZWRnZSA9PT0gJ2xlZnQnO1xuICAgICAgICAgICAgdmFyIGRheXNEaWZmID0gdm9pZCAwO1xuICAgICAgICAgICAgaWYgKGFsbERheUV2ZW50UmVzaXppbmdCZWZvcmVTdGFydCkge1xuICAgICAgICAgICAgICAgIGRheXNEaWZmID0gYWxsRGF5RXZlbnQub2Zmc2V0IC0gY3VycmVudFJlc2l6ZS5vcmlnaW5hbE9mZnNldDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGRheXNEaWZmID0gYWxsRGF5RXZlbnQuc3BhbiAtIGN1cnJlbnRSZXNpemUub3JpZ2luYWxTcGFuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYWxsRGF5RXZlbnQub2Zmc2V0ID0gY3VycmVudFJlc2l6ZS5vcmlnaW5hbE9mZnNldDtcbiAgICAgICAgICAgIGFsbERheUV2ZW50LnNwYW4gPSBjdXJyZW50UmVzaXplLm9yaWdpbmFsU3BhbjtcbiAgICAgICAgICAgIHZhciBuZXdTdGFydCA9IGFsbERheUV2ZW50LmV2ZW50LnN0YXJ0O1xuICAgICAgICAgICAgdmFyIG5ld0VuZCA9IGFsbERheUV2ZW50LmV2ZW50LmVuZCB8fCBhbGxEYXlFdmVudC5ldmVudC5zdGFydDtcbiAgICAgICAgICAgIGlmIChhbGxEYXlFdmVudFJlc2l6aW5nQmVmb3JlU3RhcnQpIHtcbiAgICAgICAgICAgICAgICBuZXdTdGFydCA9IGFkZERheXNXaXRoRXhjbHVzaW9ucyh0aGlzLmRhdGVBZGFwdGVyLCBuZXdTdGFydCwgZGF5c0RpZmYsIHRoaXMuZXhjbHVkZURheXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV3RW5kID0gYWRkRGF5c1dpdGhFeGNsdXNpb25zKHRoaXMuZGF0ZUFkYXB0ZXIsIG5ld0VuZCwgZGF5c0RpZmYsIHRoaXMuZXhjbHVkZURheXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5ldmVudFRpbWVzQ2hhbmdlZC5lbWl0KHtcbiAgICAgICAgICAgICAgICBuZXdTdGFydDogbmV3U3RhcnQsXG4gICAgICAgICAgICAgICAgbmV3RW5kOiBuZXdFbmQsXG4gICAgICAgICAgICAgICAgZXZlbnQ6IGFsbERheUV2ZW50LmV2ZW50LFxuICAgICAgICAgICAgICAgIHR5cGU6IENhbGVuZGFyRXZlbnRUaW1lc0NoYW5nZWRFdmVudFR5cGUuUmVzaXplXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuYWxsRGF5RXZlbnRSZXNpemVzLmRlbGV0ZShhbGxEYXlFdmVudCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZS5nZXREYXlDb2x1bW5XaWR0aCA9IGZ1bmN0aW9uIChldmVudFJvd0NvbnRhaW5lcikge1xuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihldmVudFJvd0NvbnRhaW5lci5vZmZzZXRXaWR0aCAvIHRoaXMuZGF5cy5sZW5ndGgpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQucHJvdG90eXBlLmRhdGVEcmFnRW50ZXIgPSBmdW5jdGlvbiAoZGF0ZSkge1xuICAgICAgICB0aGlzLmxhc3REcmFnRW50ZXJEYXRlID0gZGF0ZTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZS5ldmVudERyb3BwZWQgPSBmdW5jdGlvbiAoZHJvcEV2ZW50LCBkYXRlLCBhbGxEYXkpIHtcbiAgICAgICAgaWYgKHNob3VsZEZpcmVEcm9wcGVkRXZlbnQoZHJvcEV2ZW50LCBkYXRlLCBhbGxEYXksIHRoaXMuY2FsZW5kYXJJZCkgJiZcbiAgICAgICAgICAgIHRoaXMubGFzdERyYWdFbnRlckRhdGUuZ2V0VGltZSgpID09PSBkYXRlLmdldFRpbWUoKSkge1xuICAgICAgICAgICAgdGhpcy5ldmVudFRpbWVzQ2hhbmdlZC5lbWl0KHtcbiAgICAgICAgICAgICAgICB0eXBlOiBDYWxlbmRhckV2ZW50VGltZXNDaGFuZ2VkRXZlbnRUeXBlLkRyb3AsXG4gICAgICAgICAgICAgICAgZXZlbnQ6IGRyb3BFdmVudC5kcm9wRGF0YS5ldmVudCxcbiAgICAgICAgICAgICAgICBuZXdTdGFydDogZGF0ZSxcbiAgICAgICAgICAgICAgICBhbGxEYXk6IGFsbERheVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZS5kcmFnRW50ZXIgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICB0aGlzLmV2ZW50RHJhZ0VudGVyQnlUeXBlW3R5cGVdKys7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudC5wcm90b3R5cGUuZHJhZ0xlYXZlID0gZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgdGhpcy5ldmVudERyYWdFbnRlckJ5VHlwZVt0eXBlXS0tO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQucHJvdG90eXBlLmRyYWdTdGFydGVkID0gZnVuY3Rpb24gKGV2ZW50c0NvbnRhaW5lciwgZXZlbnQsIGRheUV2ZW50KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuZGF5Q29sdW1uV2lkdGggPSB0aGlzLmdldERheUNvbHVtbldpZHRoKGV2ZW50c0NvbnRhaW5lcik7XG4gICAgICAgIHZhciBkcmFnSGVscGVyID0gbmV3IENhbGVuZGFyRHJhZ0hlbHBlcihldmVudHNDb250YWluZXIsIGV2ZW50KTtcbiAgICAgICAgdGhpcy52YWxpZGF0ZURyYWcgPSBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgIHZhciB4ID0gX2EueCwgeSA9IF9hLnksIHRyYW5zZm9ybSA9IF9hLnRyYW5zZm9ybTtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5hbGxEYXlFdmVudFJlc2l6ZXMuc2l6ZSA9PT0gMCAmJlxuICAgICAgICAgICAgICAgIF90aGlzLnRpbWVFdmVudFJlc2l6ZXMuc2l6ZSA9PT0gMCAmJlxuICAgICAgICAgICAgICAgIGRyYWdIZWxwZXIudmFsaWRhdGVEcmFnKHtcbiAgICAgICAgICAgICAgICAgICAgeDogeCxcbiAgICAgICAgICAgICAgICAgICAgeTogeSxcbiAgICAgICAgICAgICAgICAgICAgc25hcERyYWdnZWRFdmVudHM6IF90aGlzLnNuYXBEcmFnZ2VkRXZlbnRzLFxuICAgICAgICAgICAgICAgICAgICBkcmFnQWxyZWFkeU1vdmVkOiBfdGhpcy5kcmFnQWxyZWFkeU1vdmVkLFxuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zZm9ybVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmRyYWdBY3RpdmUgPSB0cnVlO1xuICAgICAgICB0aGlzLmRyYWdBbHJlYWR5TW92ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5ldmVudERyYWdFbnRlckJ5VHlwZSA9IHtcbiAgICAgICAgICAgIGFsbERheTogMCxcbiAgICAgICAgICAgIHRpbWU6IDBcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKCF0aGlzLnNuYXBEcmFnZ2VkRXZlbnRzICYmIGRheUV2ZW50KSB7XG4gICAgICAgICAgICB0aGlzLnZpZXcuaG91ckNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxpbmtlZEV2ZW50ID0gY29sdW1uLmV2ZW50cy5maW5kKGZ1bmN0aW9uIChjb2x1bW5FdmVudCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29sdW1uRXZlbnQuZXZlbnQgPT09IGRheUV2ZW50LmV2ZW50ICYmIGNvbHVtbkV2ZW50ICE9PSBkYXlFdmVudDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvLyBoaWRlIGFueSBsaW5rZWQgZXZlbnRzIHdoaWxlIGRyYWdnaW5nXG4gICAgICAgICAgICAgICAgaWYgKGxpbmtlZEV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGxpbmtlZEV2ZW50LndpZHRoID0gMDtcbiAgICAgICAgICAgICAgICAgICAgbGlua2VkRXZlbnQuaGVpZ2h0ID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZS5kcmFnTW92ZSA9IGZ1bmN0aW9uIChkYXlFdmVudCwgZHJhZ0V2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLnNuYXBEcmFnZ2VkRXZlbnRzKSB7XG4gICAgICAgICAgICB2YXIgbmV3RXZlbnRUaW1lcyA9IHRoaXMuZ2V0RHJhZ01vdmVkRXZlbnRUaW1lcyhkYXlFdmVudCwgZHJhZ0V2ZW50LCB0aGlzLmRheUNvbHVtbldpZHRoLCB0cnVlKTtcbiAgICAgICAgICAgIHZhciBvcmlnaW5hbEV2ZW50XzEgPSBkYXlFdmVudC5ldmVudDtcbiAgICAgICAgICAgIHZhciBhZGp1c3RlZEV2ZW50XzEgPSB0c2xpYl8xLl9fYXNzaWduKHt9LCBvcmlnaW5hbEV2ZW50XzEsIG5ld0V2ZW50VGltZXMpO1xuICAgICAgICAgICAgdmFyIHRlbXBFdmVudHMgPSB0aGlzLmV2ZW50cy5tYXAoZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50ID09PSBvcmlnaW5hbEV2ZW50XzEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFkanVzdGVkRXZlbnRfMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGV2ZW50O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnJlc3RvcmVPcmlnaW5hbEV2ZW50cyh0ZW1wRXZlbnRzLCBuZXcgTWFwKFtbYWRqdXN0ZWRFdmVudF8xLCBvcmlnaW5hbEV2ZW50XzFdXSkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZHJhZ0FscmVhZHlNb3ZlZCA9IHRydWU7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudC5wcm90b3R5cGUuYWxsRGF5RXZlbnREcmFnTW92ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5kcmFnQWxyZWFkeU1vdmVkID0gdHJ1ZTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZS5kcmFnRW5kZWQgPSBmdW5jdGlvbiAod2Vla0V2ZW50LCBkcmFnRW5kRXZlbnQsIGRheVdpZHRoLCB1c2VZKSB7XG4gICAgICAgIGlmICh1c2VZID09PSB2b2lkIDApIHsgdXNlWSA9IGZhbHNlOyB9XG4gICAgICAgIHRoaXMudmlldyA9IHRoaXMuZ2V0V2Vla1ZpZXcodGhpcy5ldmVudHMpO1xuICAgICAgICB0aGlzLmRyYWdBY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgdmFyIF9hID0gdGhpcy5nZXREcmFnTW92ZWRFdmVudFRpbWVzKHdlZWtFdmVudCwgZHJhZ0VuZEV2ZW50LCBkYXlXaWR0aCwgdXNlWSksIHN0YXJ0ID0gX2Euc3RhcnQsIGVuZCA9IF9hLmVuZDtcbiAgICAgICAgaWYgKHRoaXMuZXZlbnREcmFnRW50ZXJCeVR5cGVbdXNlWSA/ICd0aW1lJyA6ICdhbGxEYXknXSA+IDAgJiZcbiAgICAgICAgICAgIGlzRHJhZ2dlZFdpdGhpblBlcmlvZChzdGFydCwgZW5kLCB0aGlzLnZpZXcucGVyaW9kKSkge1xuICAgICAgICAgICAgdGhpcy5ldmVudFRpbWVzQ2hhbmdlZC5lbWl0KHtcbiAgICAgICAgICAgICAgICBuZXdTdGFydDogc3RhcnQsXG4gICAgICAgICAgICAgICAgbmV3RW5kOiBlbmQsXG4gICAgICAgICAgICAgICAgZXZlbnQ6IHdlZWtFdmVudC5ldmVudCxcbiAgICAgICAgICAgICAgICB0eXBlOiBDYWxlbmRhckV2ZW50VGltZXNDaGFuZ2VkRXZlbnRUeXBlLkRyYWcsXG4gICAgICAgICAgICAgICAgYWxsRGF5OiAhdXNlWVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQucHJvdG90eXBlLnJlZnJlc2hIZWFkZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuZGF5cyA9IHRoaXMudXRpbHMuZ2V0V2Vla1ZpZXdIZWFkZXIodHNsaWJfMS5fX2Fzc2lnbih7IHZpZXdEYXRlOiB0aGlzLnZpZXdEYXRlLCB3ZWVrU3RhcnRzT246IHRoaXMud2Vla1N0YXJ0c09uLCBleGNsdWRlZDogdGhpcy5leGNsdWRlRGF5cywgd2Vla2VuZERheXM6IHRoaXMud2Vla2VuZERheXMgfSwgZ2V0V2Vla1ZpZXdQZXJpb2QodGhpcy5kYXRlQWRhcHRlciwgdGhpcy52aWV3RGF0ZSwgdGhpcy53ZWVrU3RhcnRzT24sIHRoaXMuZXhjbHVkZURheXMsIHRoaXMuZGF5c0luV2VlaykpKTtcbiAgICB9O1xuICAgIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQucHJvdG90eXBlLnJlZnJlc2hCb2R5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnZpZXcgPSB0aGlzLmdldFdlZWtWaWV3KHRoaXMuZXZlbnRzKTtcbiAgICB9O1xuICAgIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQucHJvdG90eXBlLnJlZnJlc2hBbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucmVmcmVzaEhlYWRlcigpO1xuICAgICAgICB0aGlzLnJlZnJlc2hCb2R5KCk7XG4gICAgICAgIHRoaXMuZW1pdEJlZm9yZVZpZXdSZW5kZXIoKTtcbiAgICB9O1xuICAgIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQucHJvdG90eXBlLmVtaXRCZWZvcmVWaWV3UmVuZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5kYXlzICYmIHRoaXMudmlldykge1xuICAgICAgICAgICAgdGhpcy5iZWZvcmVWaWV3UmVuZGVyLmVtaXQodHNsaWJfMS5fX2Fzc2lnbih7IGhlYWRlcjogdGhpcy5kYXlzIH0sIHRoaXMudmlldykpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZS5nZXRXZWVrVmlldyA9IGZ1bmN0aW9uIChldmVudHMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudXRpbHMuZ2V0V2Vla1ZpZXcodHNsaWJfMS5fX2Fzc2lnbih7IGV2ZW50czogZXZlbnRzLCB2aWV3RGF0ZTogdGhpcy52aWV3RGF0ZSwgd2Vla1N0YXJ0c09uOiB0aGlzLndlZWtTdGFydHNPbiwgZXhjbHVkZWQ6IHRoaXMuZXhjbHVkZURheXMsIHByZWNpc2lvbjogdGhpcy5wcmVjaXNpb24sIGFic29sdXRlUG9zaXRpb25lZEV2ZW50czogdHJ1ZSwgaG91clNlZ21lbnRzOiB0aGlzLmhvdXJTZWdtZW50cywgZGF5U3RhcnQ6IHtcbiAgICAgICAgICAgICAgICBob3VyOiB0aGlzLmRheVN0YXJ0SG91cixcbiAgICAgICAgICAgICAgICBtaW51dGU6IHRoaXMuZGF5U3RhcnRNaW51dGVcbiAgICAgICAgICAgIH0sIGRheUVuZDoge1xuICAgICAgICAgICAgICAgIGhvdXI6IHRoaXMuZGF5RW5kSG91cixcbiAgICAgICAgICAgICAgICBtaW51dGU6IHRoaXMuZGF5RW5kTWludXRlXG4gICAgICAgICAgICB9LCBzZWdtZW50SGVpZ2h0OiB0aGlzLmhvdXJTZWdtZW50SGVpZ2h0LCB3ZWVrZW5kRGF5czogdGhpcy53ZWVrZW5kRGF5cyB9LCBnZXRXZWVrVmlld1BlcmlvZCh0aGlzLmRhdGVBZGFwdGVyLCB0aGlzLnZpZXdEYXRlLCB0aGlzLndlZWtTdGFydHNPbiwgdGhpcy5leGNsdWRlRGF5cywgdGhpcy5kYXlzSW5XZWVrKSkpO1xuICAgIH07XG4gICAgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudC5wcm90b3R5cGUuZ2V0RHJhZ01vdmVkRXZlbnRUaW1lcyA9IGZ1bmN0aW9uICh3ZWVrRXZlbnQsIGRyYWdFbmRFdmVudCwgZGF5V2lkdGgsIHVzZVkpIHtcbiAgICAgICAgdmFyIGRheXNEcmFnZ2VkID0gcm91bmRUb05lYXJlc3QoZHJhZ0VuZEV2ZW50LngsIGRheVdpZHRoKSAvIGRheVdpZHRoO1xuICAgICAgICB2YXIgbWludXRlc01vdmVkID0gdXNlWVxuICAgICAgICAgICAgPyBnZXRNaW51dGVzTW92ZWQoZHJhZ0VuZEV2ZW50LnksIHRoaXMuaG91clNlZ21lbnRzLCB0aGlzLmhvdXJTZWdtZW50SGVpZ2h0LCB0aGlzLmV2ZW50U25hcFNpemUpXG4gICAgICAgICAgICA6IDA7XG4gICAgICAgIHZhciBzdGFydCA9IHRoaXMuZGF0ZUFkYXB0ZXIuYWRkTWludXRlcyhhZGREYXlzV2l0aEV4Y2x1c2lvbnModGhpcy5kYXRlQWRhcHRlciwgd2Vla0V2ZW50LmV2ZW50LnN0YXJ0LCBkYXlzRHJhZ2dlZCwgdGhpcy5leGNsdWRlRGF5cyksIG1pbnV0ZXNNb3ZlZCk7XG4gICAgICAgIHZhciBlbmQ7XG4gICAgICAgIGlmICh3ZWVrRXZlbnQuZXZlbnQuZW5kKSB7XG4gICAgICAgICAgICBlbmQgPSB0aGlzLmRhdGVBZGFwdGVyLmFkZE1pbnV0ZXMoYWRkRGF5c1dpdGhFeGNsdXNpb25zKHRoaXMuZGF0ZUFkYXB0ZXIsIHdlZWtFdmVudC5ldmVudC5lbmQsIGRheXNEcmFnZ2VkLCB0aGlzLmV4Y2x1ZGVEYXlzKSwgbWludXRlc01vdmVkKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdGFydDogc3RhcnQsIGVuZDogZW5kIH07XG4gICAgfTtcbiAgICBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZS5yZXN0b3JlT3JpZ2luYWxFdmVudHMgPSBmdW5jdGlvbiAodGVtcEV2ZW50cywgYWRqdXN0ZWRFdmVudHMpIHtcbiAgICAgICAgdmFyIHByZXZpb3VzVmlldyA9IHRoaXMudmlldztcbiAgICAgICAgdGhpcy52aWV3ID0gdGhpcy5nZXRXZWVrVmlldyh0ZW1wRXZlbnRzKTtcbiAgICAgICAgdmFyIGFkanVzdGVkRXZlbnRzQXJyYXkgPSB0ZW1wRXZlbnRzLmZpbHRlcihmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBhZGp1c3RlZEV2ZW50cy5oYXMoZXZlbnQpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy52aWV3LmhvdXJDb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbiwgY29sdW1uSW5kZXgpIHtcbiAgICAgICAgICAgIHByZXZpb3VzVmlldy5ob3VyQ29sdW1uc1tjb2x1bW5JbmRleF0uaG91cnMuZm9yRWFjaChmdW5jdGlvbiAoaG91ciwgaG91ckluZGV4KSB7XG4gICAgICAgICAgICAgICAgaG91ci5zZWdtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChzZWdtZW50LCBzZWdtZW50SW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uLmhvdXJzW2hvdXJJbmRleF0uc2VnbWVudHNbc2VnbWVudEluZGV4XS5jc3NDbGFzcyA9XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWdtZW50LmNzc0NsYXNzO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBhZGp1c3RlZEV2ZW50c0FycmF5LmZvckVhY2goZnVuY3Rpb24gKGFkanVzdGVkRXZlbnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgb3JpZ2luYWxFdmVudCA9IGFkanVzdGVkRXZlbnRzLmdldChhZGp1c3RlZEV2ZW50KTtcbiAgICAgICAgICAgICAgICB2YXIgZXhpc3RpbmdDb2x1bW5FdmVudCA9IGNvbHVtbi5ldmVudHMuZmluZChmdW5jdGlvbiAoY29sdW1uRXZlbnQpIHsgcmV0dXJuIGNvbHVtbkV2ZW50LmV2ZW50ID09PSBhZGp1c3RlZEV2ZW50OyB9KTtcbiAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdDb2x1bW5FdmVudCkge1xuICAgICAgICAgICAgICAgICAgICAvLyByZXN0b3JlIHRoZSBvcmlnaW5hbCBldmVudCBzbyB0cmFja0J5IGtpY2tzIGluIGFuZCB0aGUgZG9tIGlzbid0IGNoYW5nZWRcbiAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdDb2x1bW5FdmVudC5ldmVudCA9IG9yaWdpbmFsRXZlbnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBhZGQgYSBkdW1teSBldmVudCB0byB0aGUgZHJvcCBzbyBpZiB0aGUgZXZlbnQgd2FzIHJlbW92ZWQgZnJvbSB0aGUgb3JpZ2luYWwgY29sdW1uIHRoZSBkcmFnIGRvZXNuJ3QgZW5kIGVhcmx5XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbi5ldmVudHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudDogb3JpZ2luYWxFdmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0c0JlZm9yZURheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmRzQWZ0ZXJEYXk6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgYWRqdXN0ZWRFdmVudHMuY2xlYXIoKTtcbiAgICB9O1xuICAgIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQucHJvdG90eXBlLmdldFRpbWVFdmVudFJlc2l6ZWREYXRlcyA9IGZ1bmN0aW9uIChjYWxlbmRhckV2ZW50LCByZXNpemVFdmVudCkge1xuICAgICAgICB2YXIgbWluaW11bUV2ZW50SGVpZ2h0ID0gZ2V0TWluaW11bUV2ZW50SGVpZ2h0SW5NaW51dGVzKHRoaXMuaG91clNlZ21lbnRzLCB0aGlzLmhvdXJTZWdtZW50SGVpZ2h0KTtcbiAgICAgICAgdmFyIG5ld0V2ZW50RGF0ZXMgPSB7XG4gICAgICAgICAgICBzdGFydDogY2FsZW5kYXJFdmVudC5zdGFydCxcbiAgICAgICAgICAgIGVuZDogZ2V0RGVmYXVsdEV2ZW50RW5kKHRoaXMuZGF0ZUFkYXB0ZXIsIGNhbGVuZGFyRXZlbnQsIG1pbmltdW1FdmVudEhlaWdodClcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGVuZCA9IGNhbGVuZGFyRXZlbnQuZW5kLCBldmVudFdpdGhvdXRFbmQgPSB0c2xpYl8xLl9fcmVzdChjYWxlbmRhckV2ZW50LCBbXCJlbmRcIl0pO1xuICAgICAgICB2YXIgc21hbGxlc3RSZXNpemVzID0ge1xuICAgICAgICAgICAgc3RhcnQ6IHRoaXMuZGF0ZUFkYXB0ZXIuYWRkTWludXRlcyhuZXdFdmVudERhdGVzLmVuZCwgbWluaW11bUV2ZW50SGVpZ2h0ICogLTEpLFxuICAgICAgICAgICAgZW5kOiBnZXREZWZhdWx0RXZlbnRFbmQodGhpcy5kYXRlQWRhcHRlciwgZXZlbnRXaXRob3V0RW5kLCBtaW5pbXVtRXZlbnRIZWlnaHQpXG4gICAgICAgIH07XG4gICAgICAgIGlmICh0eXBlb2YgcmVzaXplRXZlbnQuZWRnZXMubGVmdCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHZhciBkYXlzRGlmZiA9IE1hdGgucm91bmQoK3Jlc2l6ZUV2ZW50LmVkZ2VzLmxlZnQgLyB0aGlzLmRheUNvbHVtbldpZHRoKTtcbiAgICAgICAgICAgIHZhciBuZXdTdGFydCA9IGFkZERheXNXaXRoRXhjbHVzaW9ucyh0aGlzLmRhdGVBZGFwdGVyLCBuZXdFdmVudERhdGVzLnN0YXJ0LCBkYXlzRGlmZiwgdGhpcy5leGNsdWRlRGF5cyk7XG4gICAgICAgICAgICBpZiAobmV3U3RhcnQgPCBzbWFsbGVzdFJlc2l6ZXMuc3RhcnQpIHtcbiAgICAgICAgICAgICAgICBuZXdFdmVudERhdGVzLnN0YXJ0ID0gbmV3U3RhcnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBuZXdFdmVudERhdGVzLnN0YXJ0ID0gc21hbGxlc3RSZXNpemVzLnN0YXJ0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiByZXNpemVFdmVudC5lZGdlcy5yaWdodCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHZhciBkYXlzRGlmZiA9IE1hdGgucm91bmQoK3Jlc2l6ZUV2ZW50LmVkZ2VzLnJpZ2h0IC8gdGhpcy5kYXlDb2x1bW5XaWR0aCk7XG4gICAgICAgICAgICB2YXIgbmV3RW5kID0gYWRkRGF5c1dpdGhFeGNsdXNpb25zKHRoaXMuZGF0ZUFkYXB0ZXIsIG5ld0V2ZW50RGF0ZXMuZW5kLCBkYXlzRGlmZiwgdGhpcy5leGNsdWRlRGF5cyk7XG4gICAgICAgICAgICBpZiAobmV3RW5kID4gc21hbGxlc3RSZXNpemVzLmVuZCkge1xuICAgICAgICAgICAgICAgIG5ld0V2ZW50RGF0ZXMuZW5kID0gbmV3RW5kO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV3RXZlbnREYXRlcy5lbmQgPSBzbWFsbGVzdFJlc2l6ZXMuZW5kO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgcmVzaXplRXZlbnQuZWRnZXMudG9wICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgdmFyIG1pbnV0ZXNNb3ZlZCA9IGdldE1pbnV0ZXNNb3ZlZChyZXNpemVFdmVudC5lZGdlcy50b3AsIHRoaXMuaG91clNlZ21lbnRzLCB0aGlzLmhvdXJTZWdtZW50SGVpZ2h0LCB0aGlzLmV2ZW50U25hcFNpemUpO1xuICAgICAgICAgICAgdmFyIG5ld1N0YXJ0ID0gdGhpcy5kYXRlQWRhcHRlci5hZGRNaW51dGVzKG5ld0V2ZW50RGF0ZXMuc3RhcnQsIG1pbnV0ZXNNb3ZlZCk7XG4gICAgICAgICAgICBpZiAobmV3U3RhcnQgPCBzbWFsbGVzdFJlc2l6ZXMuc3RhcnQpIHtcbiAgICAgICAgICAgICAgICBuZXdFdmVudERhdGVzLnN0YXJ0ID0gbmV3U3RhcnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBuZXdFdmVudERhdGVzLnN0YXJ0ID0gc21hbGxlc3RSZXNpemVzLnN0YXJ0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiByZXNpemVFdmVudC5lZGdlcy5ib3R0b20gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB2YXIgbWludXRlc01vdmVkID0gZ2V0TWludXRlc01vdmVkKHJlc2l6ZUV2ZW50LmVkZ2VzLmJvdHRvbSwgdGhpcy5ob3VyU2VnbWVudHMsIHRoaXMuaG91clNlZ21lbnRIZWlnaHQsIHRoaXMuZXZlbnRTbmFwU2l6ZSk7XG4gICAgICAgICAgICB2YXIgbmV3RW5kID0gdGhpcy5kYXRlQWRhcHRlci5hZGRNaW51dGVzKG5ld0V2ZW50RGF0ZXMuZW5kLCBtaW51dGVzTW92ZWQpO1xuICAgICAgICAgICAgaWYgKG5ld0VuZCA+IHNtYWxsZXN0UmVzaXplcy5lbmQpIHtcbiAgICAgICAgICAgICAgICBuZXdFdmVudERhdGVzLmVuZCA9IG5ld0VuZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG5ld0V2ZW50RGF0ZXMuZW5kID0gc21hbGxlc3RSZXNpemVzLmVuZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3RXZlbnREYXRlcztcbiAgICB9O1xuICAgIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQuY3RvclBhcmFtZXRlcnMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBbXG4gICAgICAgIHsgdHlwZTogQ2hhbmdlRGV0ZWN0b3JSZWYgfSxcbiAgICAgICAgeyB0eXBlOiBDYWxlbmRhclV0aWxzIH0sXG4gICAgICAgIHsgdHlwZTogU3RyaW5nLCBkZWNvcmF0b3JzOiBbeyB0eXBlOiBJbmplY3QsIGFyZ3M6IFtMT0NBTEVfSUQsXSB9XSB9LFxuICAgICAgICB7IHR5cGU6IERhdGVBZGFwdGVyIH1cbiAgICBdOyB9O1xuICAgIHRzbGliXzEuX19kZWNvcmF0ZShbXG4gICAgICAgIElucHV0KCksXG4gICAgICAgIHRzbGliXzEuX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIERhdGUpXG4gICAgXSwgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwidmlld0RhdGVcIiwgdm9pZCAwKTtcbiAgICB0c2xpYl8xLl9fZGVjb3JhdGUoW1xuICAgICAgICBJbnB1dCgpLFxuICAgICAgICB0c2xpYl8xLl9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBBcnJheSlcbiAgICBdLCBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJldmVudHNcIiwgdm9pZCAwKTtcbiAgICB0c2xpYl8xLl9fZGVjb3JhdGUoW1xuICAgICAgICBJbnB1dCgpLFxuICAgICAgICB0c2xpYl8xLl9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBBcnJheSlcbiAgICBdLCBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJleGNsdWRlRGF5c1wiLCB2b2lkIDApO1xuICAgIHRzbGliXzEuX19kZWNvcmF0ZShbXG4gICAgICAgIElucHV0KCksXG4gICAgICAgIHRzbGliXzEuX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN1YmplY3QpXG4gICAgXSwgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwicmVmcmVzaFwiLCB2b2lkIDApO1xuICAgIHRzbGliXzEuX19kZWNvcmF0ZShbXG4gICAgICAgIElucHV0KCksXG4gICAgICAgIHRzbGliXzEuX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFN0cmluZylcbiAgICBdLCBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJsb2NhbGVcIiwgdm9pZCAwKTtcbiAgICB0c2xpYl8xLl9fZGVjb3JhdGUoW1xuICAgICAgICBJbnB1dCgpLFxuICAgICAgICB0c2xpYl8xLl9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBPYmplY3QpXG4gICAgXSwgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwidG9vbHRpcFBsYWNlbWVudFwiLCB2b2lkIDApO1xuICAgIHRzbGliXzEuX19kZWNvcmF0ZShbXG4gICAgICAgIElucHV0KCksXG4gICAgICAgIHRzbGliXzEuX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIFRlbXBsYXRlUmVmKVxuICAgIF0sIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQucHJvdG90eXBlLCBcInRvb2x0aXBUZW1wbGF0ZVwiLCB2b2lkIDApO1xuICAgIHRzbGliXzEuX19kZWNvcmF0ZShbXG4gICAgICAgIElucHV0KCksXG4gICAgICAgIHRzbGliXzEuX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIEJvb2xlYW4pXG4gICAgXSwgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwidG9vbHRpcEFwcGVuZFRvQm9keVwiLCB2b2lkIDApO1xuICAgIHRzbGliXzEuX19kZWNvcmF0ZShbXG4gICAgICAgIElucHV0KCksXG4gICAgICAgIHRzbGliXzEuX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE51bWJlcilcbiAgICBdLCBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJ0b29sdGlwRGVsYXlcIiwgdm9pZCAwKTtcbiAgICB0c2xpYl8xLl9fZGVjb3JhdGUoW1xuICAgICAgICBJbnB1dCgpLFxuICAgICAgICB0c2xpYl8xLl9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBOdW1iZXIpXG4gICAgXSwgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwid2Vla1N0YXJ0c09uXCIsIHZvaWQgMCk7XG4gICAgdHNsaWJfMS5fX2RlY29yYXRlKFtcbiAgICAgICAgSW5wdXQoKSxcbiAgICAgICAgdHNsaWJfMS5fX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgVGVtcGxhdGVSZWYpXG4gICAgXSwgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwiaGVhZGVyVGVtcGxhdGVcIiwgdm9pZCAwKTtcbiAgICB0c2xpYl8xLl9fZGVjb3JhdGUoW1xuICAgICAgICBJbnB1dCgpLFxuICAgICAgICB0c2xpYl8xLl9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBUZW1wbGF0ZVJlZilcbiAgICBdLCBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJldmVudFRlbXBsYXRlXCIsIHZvaWQgMCk7XG4gICAgdHNsaWJfMS5fX2RlY29yYXRlKFtcbiAgICAgICAgSW5wdXQoKSxcbiAgICAgICAgdHNsaWJfMS5fX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgVGVtcGxhdGVSZWYpXG4gICAgXSwgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwiZXZlbnRUaXRsZVRlbXBsYXRlXCIsIHZvaWQgMCk7XG4gICAgdHNsaWJfMS5fX2RlY29yYXRlKFtcbiAgICAgICAgSW5wdXQoKSxcbiAgICAgICAgdHNsaWJfMS5fX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgVGVtcGxhdGVSZWYpXG4gICAgXSwgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwiZXZlbnRBY3Rpb25zVGVtcGxhdGVcIiwgdm9pZCAwKTtcbiAgICB0c2xpYl8xLl9fZGVjb3JhdGUoW1xuICAgICAgICBJbnB1dCgpLFxuICAgICAgICB0c2xpYl8xLl9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBTdHJpbmcpXG4gICAgXSwgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwicHJlY2lzaW9uXCIsIHZvaWQgMCk7XG4gICAgdHNsaWJfMS5fX2RlY29yYXRlKFtcbiAgICAgICAgSW5wdXQoKSxcbiAgICAgICAgdHNsaWJfMS5fX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgQXJyYXkpXG4gICAgXSwgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwid2Vla2VuZERheXNcIiwgdm9pZCAwKTtcbiAgICB0c2xpYl8xLl9fZGVjb3JhdGUoW1xuICAgICAgICBJbnB1dCgpLFxuICAgICAgICB0c2xpYl8xLl9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBCb29sZWFuKVxuICAgIF0sIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQucHJvdG90eXBlLCBcInNuYXBEcmFnZ2VkRXZlbnRzXCIsIHZvaWQgMCk7XG4gICAgdHNsaWJfMS5fX2RlY29yYXRlKFtcbiAgICAgICAgSW5wdXQoKSxcbiAgICAgICAgdHNsaWJfMS5fX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgTnVtYmVyKVxuICAgIF0sIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQucHJvdG90eXBlLCBcImhvdXJTZWdtZW50c1wiLCB2b2lkIDApO1xuICAgIHRzbGliXzEuX19kZWNvcmF0ZShbXG4gICAgICAgIElucHV0KCksXG4gICAgICAgIHRzbGliXzEuX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE51bWJlcilcbiAgICBdLCBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJob3VyU2VnbWVudEhlaWdodFwiLCB2b2lkIDApO1xuICAgIHRzbGliXzEuX19kZWNvcmF0ZShbXG4gICAgICAgIElucHV0KCksXG4gICAgICAgIHRzbGliXzEuX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE51bWJlcilcbiAgICBdLCBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJkYXlTdGFydEhvdXJcIiwgdm9pZCAwKTtcbiAgICB0c2xpYl8xLl9fZGVjb3JhdGUoW1xuICAgICAgICBJbnB1dCgpLFxuICAgICAgICB0c2xpYl8xLl9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBOdW1iZXIpXG4gICAgXSwgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwiZGF5U3RhcnRNaW51dGVcIiwgdm9pZCAwKTtcbiAgICB0c2xpYl8xLl9fZGVjb3JhdGUoW1xuICAgICAgICBJbnB1dCgpLFxuICAgICAgICB0c2xpYl8xLl9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBOdW1iZXIpXG4gICAgXSwgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudC5wcm90b3R5cGUsIFwiZGF5RW5kSG91clwiLCB2b2lkIDApO1xuICAgIHRzbGliXzEuX19kZWNvcmF0ZShbXG4gICAgICAgIElucHV0KCksXG4gICAgICAgIHRzbGliXzEuX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE51bWJlcilcbiAgICBdLCBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJkYXlFbmRNaW51dGVcIiwgdm9pZCAwKTtcbiAgICB0c2xpYl8xLl9fZGVjb3JhdGUoW1xuICAgICAgICBJbnB1dCgpLFxuICAgICAgICB0c2xpYl8xLl9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBUZW1wbGF0ZVJlZilcbiAgICBdLCBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJob3VyU2VnbWVudFRlbXBsYXRlXCIsIHZvaWQgMCk7XG4gICAgdHNsaWJfMS5fX2RlY29yYXRlKFtcbiAgICAgICAgSW5wdXQoKSxcbiAgICAgICAgdHNsaWJfMS5fX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgTnVtYmVyKVxuICAgIF0sIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQucHJvdG90eXBlLCBcImV2ZW50U25hcFNpemVcIiwgdm9pZCAwKTtcbiAgICB0c2xpYl8xLl9fZGVjb3JhdGUoW1xuICAgICAgICBJbnB1dCgpLFxuICAgICAgICB0c2xpYl8xLl9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBUZW1wbGF0ZVJlZilcbiAgICBdLCBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJhbGxEYXlFdmVudHNMYWJlbFRlbXBsYXRlXCIsIHZvaWQgMCk7XG4gICAgdHNsaWJfMS5fX2RlY29yYXRlKFtcbiAgICAgICAgSW5wdXQoKSxcbiAgICAgICAgdHNsaWJfMS5fX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgTnVtYmVyKVxuICAgIF0sIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQucHJvdG90eXBlLCBcImRheXNJbldlZWtcIiwgdm9pZCAwKTtcbiAgICB0c2xpYl8xLl9fZGVjb3JhdGUoW1xuICAgICAgICBJbnB1dCgpLFxuICAgICAgICB0c2xpYl8xLl9fbWV0YWRhdGEoXCJkZXNpZ246dHlwZVwiLCBUZW1wbGF0ZVJlZilcbiAgICBdLCBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJjdXJyZW50VGltZU1hcmtlclRlbXBsYXRlXCIsIHZvaWQgMCk7XG4gICAgdHNsaWJfMS5fX2RlY29yYXRlKFtcbiAgICAgICAgT3V0cHV0KCksXG4gICAgICAgIHRzbGliXzEuX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE9iamVjdClcbiAgICBdLCBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJkYXlIZWFkZXJDbGlja2VkXCIsIHZvaWQgMCk7XG4gICAgdHNsaWJfMS5fX2RlY29yYXRlKFtcbiAgICAgICAgT3V0cHV0KCksXG4gICAgICAgIHRzbGliXzEuX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE9iamVjdClcbiAgICBdLCBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJldmVudENsaWNrZWRcIiwgdm9pZCAwKTtcbiAgICB0c2xpYl8xLl9fZGVjb3JhdGUoW1xuICAgICAgICBPdXRwdXQoKSxcbiAgICAgICAgdHNsaWJfMS5fX21ldGFkYXRhKFwiZGVzaWduOnR5cGVcIiwgT2JqZWN0KVxuICAgIF0sIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQucHJvdG90eXBlLCBcImV2ZW50VGltZXNDaGFuZ2VkXCIsIHZvaWQgMCk7XG4gICAgdHNsaWJfMS5fX2RlY29yYXRlKFtcbiAgICAgICAgT3V0cHV0KCksXG4gICAgICAgIHRzbGliXzEuX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE9iamVjdClcbiAgICBdLCBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJiZWZvcmVWaWV3UmVuZGVyXCIsIHZvaWQgMCk7XG4gICAgdHNsaWJfMS5fX2RlY29yYXRlKFtcbiAgICAgICAgT3V0cHV0KCksXG4gICAgICAgIHRzbGliXzEuX19tZXRhZGF0YShcImRlc2lnbjp0eXBlXCIsIE9iamVjdClcbiAgICBdLCBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50LnByb3RvdHlwZSwgXCJob3VyU2VnbWVudENsaWNrZWRcIiwgdm9pZCAwKTtcbiAgICBDYWxlbmRhcldlZWtWaWV3Q29tcG9uZW50ID0gdHNsaWJfMS5fX2RlY29yYXRlKFtcbiAgICAgICAgQ29tcG9uZW50KHtcbiAgICAgICAgICAgIHNlbGVjdG9yOiAnbXdsLWNhbGVuZGFyLXdlZWstdmlldycsXG4gICAgICAgICAgICB0ZW1wbGF0ZTogXCJcXG4gICAgPGRpdiBjbGFzcz1cXFwiY2FsLXdlZWstdmlld1xcXCIgcm9sZT1cXFwiZ3JpZFxcXCI+XFxuICAgICAgPG13bC1jYWxlbmRhci13ZWVrLXZpZXctaGVhZGVyXFxuICAgICAgICBbZGF5c109XFxcImRheXNcXFwiXFxuICAgICAgICBbbG9jYWxlXT1cXFwibG9jYWxlXFxcIlxcbiAgICAgICAgW2N1c3RvbVRlbXBsYXRlXT1cXFwiaGVhZGVyVGVtcGxhdGVcXFwiXFxuICAgICAgICAoZGF5SGVhZGVyQ2xpY2tlZCk9XFxcImRheUhlYWRlckNsaWNrZWQuZW1pdCgkZXZlbnQpXFxcIlxcbiAgICAgICAgKGV2ZW50RHJvcHBlZCk9XFxcIlxcbiAgICAgICAgICBldmVudERyb3BwZWQoeyBkcm9wRGF0YTogJGV2ZW50IH0sICRldmVudC5uZXdTdGFydCwgdHJ1ZSlcXG4gICAgICAgIFxcXCJcXG4gICAgICAgIChkcmFnRW50ZXIpPVxcXCJkYXRlRHJhZ0VudGVyKCRldmVudC5kYXRlKVxcXCJcXG4gICAgICA+XFxuICAgICAgPC9td2wtY2FsZW5kYXItd2Vlay12aWV3LWhlYWRlcj5cXG4gICAgICA8ZGl2XFxuICAgICAgICBjbGFzcz1cXFwiY2FsLWFsbC1kYXktZXZlbnRzXFxcIlxcbiAgICAgICAgI2FsbERheUV2ZW50c0NvbnRhaW5lclxcbiAgICAgICAgKm5nSWY9XFxcInZpZXcuYWxsRGF5RXZlbnRSb3dzLmxlbmd0aCA+IDBcXFwiXFxuICAgICAgICBtd2xEcm9wcGFibGVcXG4gICAgICAgIChkcmFnRW50ZXIpPVxcXCJkcmFnRW50ZXIoJ2FsbERheScpXFxcIlxcbiAgICAgICAgKGRyYWdMZWF2ZSk9XFxcImRyYWdMZWF2ZSgnYWxsRGF5JylcXFwiXFxuICAgICAgPlxcbiAgICAgICAgPGRpdiBjbGFzcz1cXFwiY2FsLWRheS1jb2x1bW5zXFxcIj5cXG4gICAgICAgICAgPGRpdlxcbiAgICAgICAgICAgIGNsYXNzPVxcXCJjYWwtdGltZS1sYWJlbC1jb2x1bW5cXFwiXFxuICAgICAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRdPVxcXCJhbGxEYXlFdmVudHNMYWJlbFRlbXBsYXRlXFxcIlxcbiAgICAgICAgICA+PC9kaXY+XFxuICAgICAgICAgIDxkaXZcXG4gICAgICAgICAgICBjbGFzcz1cXFwiY2FsLWRheS1jb2x1bW5cXFwiXFxuICAgICAgICAgICAgKm5nRm9yPVxcXCJsZXQgZGF5IG9mIGRheXM7IHRyYWNrQnk6IHRyYWNrQnlXZWVrRGF5SGVhZGVyRGF0ZVxcXCJcXG4gICAgICAgICAgICBtd2xEcm9wcGFibGVcXG4gICAgICAgICAgICBkcmFnT3ZlckNsYXNzPVxcXCJjYWwtZHJhZy1vdmVyXFxcIlxcbiAgICAgICAgICAgIChkcm9wKT1cXFwiZXZlbnREcm9wcGVkKCRldmVudCwgZGF5LmRhdGUsIHRydWUpXFxcIlxcbiAgICAgICAgICAgIChkcmFnRW50ZXIpPVxcXCJkYXRlRHJhZ0VudGVyKGRheS5kYXRlKVxcXCJcXG4gICAgICAgICAgPjwvZGl2PlxcbiAgICAgICAgPC9kaXY+XFxuICAgICAgICA8ZGl2XFxuICAgICAgICAgICpuZ0Zvcj1cXFwibGV0IGV2ZW50Um93IG9mIHZpZXcuYWxsRGF5RXZlbnRSb3dzOyB0cmFja0J5OiB0cmFja0J5SWRcXFwiXFxuICAgICAgICAgICNldmVudFJvd0NvbnRhaW5lclxcbiAgICAgICAgICBjbGFzcz1cXFwiY2FsLWV2ZW50cy1yb3dcXFwiXFxuICAgICAgICA+XFxuICAgICAgICAgIDxkaXZcXG4gICAgICAgICAgICAqbmdGb3I9XFxcIlxcbiAgICAgICAgICAgICAgbGV0IGFsbERheUV2ZW50IG9mIGV2ZW50Um93LnJvdztcXG4gICAgICAgICAgICAgIHRyYWNrQnk6IHRyYWNrQnlXZWVrQWxsRGF5RXZlbnRcXG4gICAgICAgICAgICBcXFwiXFxuICAgICAgICAgICAgI2V2ZW50XFxuICAgICAgICAgICAgY2xhc3M9XFxcImNhbC1ldmVudC1jb250YWluZXJcXFwiXFxuICAgICAgICAgICAgW2NsYXNzLmNhbC1kcmFnZ2FibGVdPVxcXCJcXG4gICAgICAgICAgICAgIGFsbERheUV2ZW50LmV2ZW50LmRyYWdnYWJsZSAmJiBhbGxEYXlFdmVudFJlc2l6ZXMuc2l6ZSA9PT0gMFxcbiAgICAgICAgICAgIFxcXCJcXG4gICAgICAgICAgICBbY2xhc3MuY2FsLXN0YXJ0cy13aXRoaW4td2Vla109XFxcIiFhbGxEYXlFdmVudC5zdGFydHNCZWZvcmVXZWVrXFxcIlxcbiAgICAgICAgICAgIFtjbGFzcy5jYWwtZW5kcy13aXRoaW4td2Vla109XFxcIiFhbGxEYXlFdmVudC5lbmRzQWZ0ZXJXZWVrXFxcIlxcbiAgICAgICAgICAgIFtuZ0NsYXNzXT1cXFwiYWxsRGF5RXZlbnQuZXZlbnQ/LmNzc0NsYXNzXFxcIlxcbiAgICAgICAgICAgIFtzdHlsZS53aWR0aC4lXT1cXFwiKDEwMCAvIGRheXMubGVuZ3RoKSAqIGFsbERheUV2ZW50LnNwYW5cXFwiXFxuICAgICAgICAgICAgW3N0eWxlLm1hcmdpbkxlZnQuJV09XFxcIigxMDAgLyBkYXlzLmxlbmd0aCkgKiBhbGxEYXlFdmVudC5vZmZzZXRcXFwiXFxuICAgICAgICAgICAgbXdsUmVzaXphYmxlXFxuICAgICAgICAgICAgW3Jlc2l6ZVNuYXBHcmlkXT1cXFwieyBsZWZ0OiBkYXlDb2x1bW5XaWR0aCwgcmlnaHQ6IGRheUNvbHVtbldpZHRoIH1cXFwiXFxuICAgICAgICAgICAgW3ZhbGlkYXRlUmVzaXplXT1cXFwidmFsaWRhdGVSZXNpemVcXFwiXFxuICAgICAgICAgICAgKHJlc2l6ZVN0YXJ0KT1cXFwiXFxuICAgICAgICAgICAgICBhbGxEYXlFdmVudFJlc2l6ZVN0YXJ0ZWQoZXZlbnRSb3dDb250YWluZXIsIGFsbERheUV2ZW50LCAkZXZlbnQpXFxuICAgICAgICAgICAgXFxcIlxcbiAgICAgICAgICAgIChyZXNpemluZyk9XFxcIlxcbiAgICAgICAgICAgICAgYWxsRGF5RXZlbnRSZXNpemluZyhhbGxEYXlFdmVudCwgJGV2ZW50LCBkYXlDb2x1bW5XaWR0aClcXG4gICAgICAgICAgICBcXFwiXFxuICAgICAgICAgICAgKHJlc2l6ZUVuZCk9XFxcImFsbERheUV2ZW50UmVzaXplRW5kZWQoYWxsRGF5RXZlbnQpXFxcIlxcbiAgICAgICAgICAgIG13bERyYWdnYWJsZVxcbiAgICAgICAgICAgIGRyYWdBY3RpdmVDbGFzcz1cXFwiY2FsLWRyYWctYWN0aXZlXFxcIlxcbiAgICAgICAgICAgIFtkcm9wRGF0YV09XFxcInsgZXZlbnQ6IGFsbERheUV2ZW50LmV2ZW50LCBjYWxlbmRhcklkOiBjYWxlbmRhcklkIH1cXFwiXFxuICAgICAgICAgICAgW2RyYWdBeGlzXT1cXFwie1xcbiAgICAgICAgICAgICAgeDogYWxsRGF5RXZlbnQuZXZlbnQuZHJhZ2dhYmxlICYmIGFsbERheUV2ZW50UmVzaXplcy5zaXplID09PSAwLFxcbiAgICAgICAgICAgICAgeTpcXG4gICAgICAgICAgICAgICAgIXNuYXBEcmFnZ2VkRXZlbnRzICYmXFxuICAgICAgICAgICAgICAgIGFsbERheUV2ZW50LmV2ZW50LmRyYWdnYWJsZSAmJlxcbiAgICAgICAgICAgICAgICBhbGxEYXlFdmVudFJlc2l6ZXMuc2l6ZSA9PT0gMFxcbiAgICAgICAgICAgIH1cXFwiXFxuICAgICAgICAgICAgW2RyYWdTbmFwR3JpZF09XFxcInNuYXBEcmFnZ2VkRXZlbnRzID8geyB4OiBkYXlDb2x1bW5XaWR0aCB9IDoge31cXFwiXFxuICAgICAgICAgICAgW3ZhbGlkYXRlRHJhZ109XFxcInZhbGlkYXRlRHJhZ1xcXCJcXG4gICAgICAgICAgICAoZHJhZ1N0YXJ0KT1cXFwiZHJhZ1N0YXJ0ZWQoZXZlbnRSb3dDb250YWluZXIsIGV2ZW50KVxcXCJcXG4gICAgICAgICAgICAoZHJhZ2dpbmcpPVxcXCJhbGxEYXlFdmVudERyYWdNb3ZlKClcXFwiXFxuICAgICAgICAgICAgKGRyYWdFbmQpPVxcXCJkcmFnRW5kZWQoYWxsRGF5RXZlbnQsICRldmVudCwgZGF5Q29sdW1uV2lkdGgpXFxcIlxcbiAgICAgICAgICA+XFxuICAgICAgICAgICAgPGRpdlxcbiAgICAgICAgICAgICAgY2xhc3M9XFxcImNhbC1yZXNpemUtaGFuZGxlIGNhbC1yZXNpemUtaGFuZGxlLWJlZm9yZS1zdGFydFxcXCJcXG4gICAgICAgICAgICAgICpuZ0lmPVxcXCJcXG4gICAgICAgICAgICAgICAgYWxsRGF5RXZlbnQuZXZlbnQ/LnJlc2l6YWJsZT8uYmVmb3JlU3RhcnQgJiZcXG4gICAgICAgICAgICAgICAgIWFsbERheUV2ZW50LnN0YXJ0c0JlZm9yZVdlZWtcXG4gICAgICAgICAgICAgIFxcXCJcXG4gICAgICAgICAgICAgIG13bFJlc2l6ZUhhbmRsZVxcbiAgICAgICAgICAgICAgW3Jlc2l6ZUVkZ2VzXT1cXFwieyBsZWZ0OiB0cnVlIH1cXFwiXFxuICAgICAgICAgICAgPjwvZGl2PlxcbiAgICAgICAgICAgIDxtd2wtY2FsZW5kYXItd2Vlay12aWV3LWV2ZW50XFxuICAgICAgICAgICAgICBbbG9jYWxlXT1cXFwibG9jYWxlXFxcIlxcbiAgICAgICAgICAgICAgW3dlZWtFdmVudF09XFxcImFsbERheUV2ZW50XFxcIlxcbiAgICAgICAgICAgICAgW3Rvb2x0aXBQbGFjZW1lbnRdPVxcXCJ0b29sdGlwUGxhY2VtZW50XFxcIlxcbiAgICAgICAgICAgICAgW3Rvb2x0aXBUZW1wbGF0ZV09XFxcInRvb2x0aXBUZW1wbGF0ZVxcXCJcXG4gICAgICAgICAgICAgIFt0b29sdGlwQXBwZW5kVG9Cb2R5XT1cXFwidG9vbHRpcEFwcGVuZFRvQm9keVxcXCJcXG4gICAgICAgICAgICAgIFt0b29sdGlwRGVsYXldPVxcXCJ0b29sdGlwRGVsYXlcXFwiXFxuICAgICAgICAgICAgICBbY3VzdG9tVGVtcGxhdGVdPVxcXCJldmVudFRlbXBsYXRlXFxcIlxcbiAgICAgICAgICAgICAgW2V2ZW50VGl0bGVUZW1wbGF0ZV09XFxcImV2ZW50VGl0bGVUZW1wbGF0ZVxcXCJcXG4gICAgICAgICAgICAgIFtldmVudEFjdGlvbnNUZW1wbGF0ZV09XFxcImV2ZW50QWN0aW9uc1RlbXBsYXRlXFxcIlxcbiAgICAgICAgICAgICAgW2RheXNJbldlZWtdPVxcXCJkYXlzSW5XZWVrXFxcIlxcbiAgICAgICAgICAgICAgKGV2ZW50Q2xpY2tlZCk9XFxcIlxcbiAgICAgICAgICAgICAgICBldmVudENsaWNrZWQuZW1pdCh7XFxuICAgICAgICAgICAgICAgICAgZXZlbnQ6IGFsbERheUV2ZW50LmV2ZW50LFxcbiAgICAgICAgICAgICAgICAgIHNvdXJjZUV2ZW50OiAkZXZlbnQuc291cmNlRXZlbnRcXG4gICAgICAgICAgICAgICAgfSlcXG4gICAgICAgICAgICAgIFxcXCJcXG4gICAgICAgICAgICA+XFxuICAgICAgICAgICAgPC9td2wtY2FsZW5kYXItd2Vlay12aWV3LWV2ZW50PlxcbiAgICAgICAgICAgIDxkaXZcXG4gICAgICAgICAgICAgIGNsYXNzPVxcXCJjYWwtcmVzaXplLWhhbmRsZSBjYWwtcmVzaXplLWhhbmRsZS1hZnRlci1lbmRcXFwiXFxuICAgICAgICAgICAgICAqbmdJZj1cXFwiXFxuICAgICAgICAgICAgICAgIGFsbERheUV2ZW50LmV2ZW50Py5yZXNpemFibGU/LmFmdGVyRW5kICYmXFxuICAgICAgICAgICAgICAgICFhbGxEYXlFdmVudC5lbmRzQWZ0ZXJXZWVrXFxuICAgICAgICAgICAgICBcXFwiXFxuICAgICAgICAgICAgICBtd2xSZXNpemVIYW5kbGVcXG4gICAgICAgICAgICAgIFtyZXNpemVFZGdlc109XFxcInsgcmlnaHQ6IHRydWUgfVxcXCJcXG4gICAgICAgICAgICA+PC9kaXY+XFxuICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgPC9kaXY+XFxuICAgICAgPC9kaXY+XFxuICAgICAgPGRpdlxcbiAgICAgICAgY2xhc3M9XFxcImNhbC10aW1lLWV2ZW50c1xcXCJcXG4gICAgICAgIG13bERyb3BwYWJsZVxcbiAgICAgICAgKGRyYWdFbnRlcik9XFxcImRyYWdFbnRlcigndGltZScpXFxcIlxcbiAgICAgICAgKGRyYWdMZWF2ZSk9XFxcImRyYWdMZWF2ZSgndGltZScpXFxcIlxcbiAgICAgID5cXG4gICAgICAgIDxkaXZcXG4gICAgICAgICAgY2xhc3M9XFxcImNhbC10aW1lLWxhYmVsLWNvbHVtblxcXCJcXG4gICAgICAgICAgKm5nSWY9XFxcInZpZXcuaG91ckNvbHVtbnMubGVuZ3RoID4gMCAmJiBkYXlzSW5XZWVrICE9PSAxXFxcIlxcbiAgICAgICAgPlxcbiAgICAgICAgICA8ZGl2XFxuICAgICAgICAgICAgKm5nRm9yPVxcXCJcXG4gICAgICAgICAgICAgIGxldCBob3VyIG9mIHZpZXcuaG91ckNvbHVtbnNbMF0uaG91cnM7XFxuICAgICAgICAgICAgICB0cmFja0J5OiB0cmFja0J5SG91cjtcXG4gICAgICAgICAgICAgIGxldCBvZGQgPSBvZGRcXG4gICAgICAgICAgICBcXFwiXFxuICAgICAgICAgICAgY2xhc3M9XFxcImNhbC1ob3VyXFxcIlxcbiAgICAgICAgICAgIFtjbGFzcy5jYWwtaG91ci1vZGRdPVxcXCJvZGRcXFwiXFxuICAgICAgICAgID5cXG4gICAgICAgICAgICA8bXdsLWNhbGVuZGFyLXdlZWstdmlldy1ob3VyLXNlZ21lbnRcXG4gICAgICAgICAgICAgICpuZ0Zvcj1cXFwibGV0IHNlZ21lbnQgb2YgaG91ci5zZWdtZW50czsgdHJhY2tCeTogdHJhY2tCeUhvdXJTZWdtZW50XFxcIlxcbiAgICAgICAgICAgICAgW3N0eWxlLmhlaWdodC5weF09XFxcImhvdXJTZWdtZW50SGVpZ2h0XFxcIlxcbiAgICAgICAgICAgICAgW3NlZ21lbnRdPVxcXCJzZWdtZW50XFxcIlxcbiAgICAgICAgICAgICAgW3NlZ21lbnRIZWlnaHRdPVxcXCJob3VyU2VnbWVudEhlaWdodFxcXCJcXG4gICAgICAgICAgICAgIFtsb2NhbGVdPVxcXCJsb2NhbGVcXFwiXFxuICAgICAgICAgICAgICBbY3VzdG9tVGVtcGxhdGVdPVxcXCJob3VyU2VnbWVudFRlbXBsYXRlXFxcIlxcbiAgICAgICAgICAgICAgW2lzVGltZUxhYmVsXT1cXFwidHJ1ZVxcXCJcXG4gICAgICAgICAgICAgIFtkYXlzSW5XZWVrXT1cXFwiZGF5c0luV2Vla1xcXCJcXG4gICAgICAgICAgICA+XFxuICAgICAgICAgICAgPC9td2wtY2FsZW5kYXItd2Vlay12aWV3LWhvdXItc2VnbWVudD5cXG4gICAgICAgICAgPC9kaXY+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICAgIDxkaXZcXG4gICAgICAgICAgY2xhc3M9XFxcImNhbC1kYXktY29sdW1uc1xcXCJcXG4gICAgICAgICAgW2NsYXNzLmNhbC1yZXNpemUtYWN0aXZlXT1cXFwidGltZUV2ZW50UmVzaXplcy5zaXplID4gMFxcXCJcXG4gICAgICAgICAgI2RheUNvbHVtbnNcXG4gICAgICAgID5cXG4gICAgICAgICAgPGRpdlxcbiAgICAgICAgICAgIGNsYXNzPVxcXCJjYWwtZGF5LWNvbHVtblxcXCJcXG4gICAgICAgICAgICAqbmdGb3I9XFxcImxldCBjb2x1bW4gb2Ygdmlldy5ob3VyQ29sdW1uczsgdHJhY2tCeTogdHJhY2tCeUhvdXJDb2x1bW5cXFwiXFxuICAgICAgICAgID5cXG4gICAgICAgICAgICA8bXdsLWNhbGVuZGFyLXdlZWstdmlldy1jdXJyZW50LXRpbWUtbWFya2VyXFxuICAgICAgICAgICAgICBbY29sdW1uRGF0ZV09XFxcImNvbHVtbi5kYXRlXFxcIlxcbiAgICAgICAgICAgICAgW2RheVN0YXJ0SG91cl09XFxcImRheVN0YXJ0SG91clxcXCJcXG4gICAgICAgICAgICAgIFtkYXlTdGFydE1pbnV0ZV09XFxcImRheVN0YXJ0TWludXRlXFxcIlxcbiAgICAgICAgICAgICAgW2RheUVuZEhvdXJdPVxcXCJkYXlFbmRIb3VyXFxcIlxcbiAgICAgICAgICAgICAgW2RheUVuZE1pbnV0ZV09XFxcImRheUVuZE1pbnV0ZVxcXCJcXG4gICAgICAgICAgICAgIFtob3VyU2VnbWVudHNdPVxcXCJob3VyU2VnbWVudHNcXFwiXFxuICAgICAgICAgICAgICBbaG91clNlZ21lbnRIZWlnaHRdPVxcXCJob3VyU2VnbWVudEhlaWdodFxcXCJcXG4gICAgICAgICAgICAgIFtjdXN0b21UZW1wbGF0ZV09XFxcImN1cnJlbnRUaW1lTWFya2VyVGVtcGxhdGVcXFwiXFxuICAgICAgICAgICAgPjwvbXdsLWNhbGVuZGFyLXdlZWstdmlldy1jdXJyZW50LXRpbWUtbWFya2VyPlxcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XFxcImNhbC1ldmVudHMtY29udGFpbmVyXFxcIj5cXG4gICAgICAgICAgICAgIDxkaXZcXG4gICAgICAgICAgICAgICAgKm5nRm9yPVxcXCJcXG4gICAgICAgICAgICAgICAgICBsZXQgdGltZUV2ZW50IG9mIGNvbHVtbi5ldmVudHM7XFxuICAgICAgICAgICAgICAgICAgdHJhY2tCeTogdHJhY2tCeVdlZWtUaW1lRXZlbnRcXG4gICAgICAgICAgICAgICAgXFxcIlxcbiAgICAgICAgICAgICAgICAjZXZlbnRcXG4gICAgICAgICAgICAgICAgY2xhc3M9XFxcImNhbC1ldmVudC1jb250YWluZXJcXFwiXFxuICAgICAgICAgICAgICAgIFtjbGFzcy5jYWwtZHJhZ2dhYmxlXT1cXFwiXFxuICAgICAgICAgICAgICAgICAgdGltZUV2ZW50LmV2ZW50LmRyYWdnYWJsZSAmJiB0aW1lRXZlbnRSZXNpemVzLnNpemUgPT09IDBcXG4gICAgICAgICAgICAgICAgXFxcIlxcbiAgICAgICAgICAgICAgICBbY2xhc3MuY2FsLXN0YXJ0cy13aXRoaW4tZGF5XT1cXFwiIXRpbWVFdmVudC5zdGFydHNCZWZvcmVEYXlcXFwiXFxuICAgICAgICAgICAgICAgIFtjbGFzcy5jYWwtZW5kcy13aXRoaW4tZGF5XT1cXFwiIXRpbWVFdmVudC5lbmRzQWZ0ZXJEYXlcXFwiXFxuICAgICAgICAgICAgICAgIFtuZ0NsYXNzXT1cXFwidGltZUV2ZW50LmV2ZW50LmNzc0NsYXNzXFxcIlxcbiAgICAgICAgICAgICAgICBbaGlkZGVuXT1cXFwidGltZUV2ZW50LmhlaWdodCA9PT0gMCAmJiB0aW1lRXZlbnQud2lkdGggPT09IDBcXFwiXFxuICAgICAgICAgICAgICAgIFtzdHlsZS50b3AucHhdPVxcXCJ0aW1lRXZlbnQudG9wXFxcIlxcbiAgICAgICAgICAgICAgICBbc3R5bGUuaGVpZ2h0LnB4XT1cXFwidGltZUV2ZW50LmhlaWdodFxcXCJcXG4gICAgICAgICAgICAgICAgW3N0eWxlLmxlZnQuJV09XFxcInRpbWVFdmVudC5sZWZ0XFxcIlxcbiAgICAgICAgICAgICAgICBbc3R5bGUud2lkdGguJV09XFxcInRpbWVFdmVudC53aWR0aFxcXCJcXG4gICAgICAgICAgICAgICAgbXdsUmVzaXphYmxlXFxuICAgICAgICAgICAgICAgIFtyZXNpemVTbmFwR3JpZF09XFxcIntcXG4gICAgICAgICAgICAgICAgICBsZWZ0OiBkYXlDb2x1bW5XaWR0aCxcXG4gICAgICAgICAgICAgICAgICByaWdodDogZGF5Q29sdW1uV2lkdGgsXFxuICAgICAgICAgICAgICAgICAgdG9wOiBldmVudFNuYXBTaXplIHx8IGhvdXJTZWdtZW50SGVpZ2h0LFxcbiAgICAgICAgICAgICAgICAgIGJvdHRvbTogZXZlbnRTbmFwU2l6ZSB8fCBob3VyU2VnbWVudEhlaWdodFxcbiAgICAgICAgICAgICAgICB9XFxcIlxcbiAgICAgICAgICAgICAgICBbdmFsaWRhdGVSZXNpemVdPVxcXCJ2YWxpZGF0ZVJlc2l6ZVxcXCJcXG4gICAgICAgICAgICAgICAgW2FsbG93TmVnYXRpdmVSZXNpemVzXT1cXFwidHJ1ZVxcXCJcXG4gICAgICAgICAgICAgICAgKHJlc2l6ZVN0YXJ0KT1cXFwiXFxuICAgICAgICAgICAgICAgICAgdGltZUV2ZW50UmVzaXplU3RhcnRlZChkYXlDb2x1bW5zLCB0aW1lRXZlbnQsICRldmVudClcXG4gICAgICAgICAgICAgICAgXFxcIlxcbiAgICAgICAgICAgICAgICAocmVzaXppbmcpPVxcXCJ0aW1lRXZlbnRSZXNpemluZyh0aW1lRXZlbnQsICRldmVudClcXFwiXFxuICAgICAgICAgICAgICAgIChyZXNpemVFbmQpPVxcXCJ0aW1lRXZlbnRSZXNpemVFbmRlZCh0aW1lRXZlbnQpXFxcIlxcbiAgICAgICAgICAgICAgICBtd2xEcmFnZ2FibGVcXG4gICAgICAgICAgICAgICAgZHJhZ0FjdGl2ZUNsYXNzPVxcXCJjYWwtZHJhZy1hY3RpdmVcXFwiXFxuICAgICAgICAgICAgICAgIFtkcm9wRGF0YV09XFxcInsgZXZlbnQ6IHRpbWVFdmVudC5ldmVudCwgY2FsZW5kYXJJZDogY2FsZW5kYXJJZCB9XFxcIlxcbiAgICAgICAgICAgICAgICBbZHJhZ0F4aXNdPVxcXCJ7XFxuICAgICAgICAgICAgICAgICAgeDogdGltZUV2ZW50LmV2ZW50LmRyYWdnYWJsZSAmJiB0aW1lRXZlbnRSZXNpemVzLnNpemUgPT09IDAsXFxuICAgICAgICAgICAgICAgICAgeTogdGltZUV2ZW50LmV2ZW50LmRyYWdnYWJsZSAmJiB0aW1lRXZlbnRSZXNpemVzLnNpemUgPT09IDBcXG4gICAgICAgICAgICAgICAgfVxcXCJcXG4gICAgICAgICAgICAgICAgW2RyYWdTbmFwR3JpZF09XFxcIlxcbiAgICAgICAgICAgICAgICAgIHNuYXBEcmFnZ2VkRXZlbnRzXFxuICAgICAgICAgICAgICAgICAgICA/IHtcXG4gICAgICAgICAgICAgICAgICAgICAgICB4OiBkYXlDb2x1bW5XaWR0aCxcXG4gICAgICAgICAgICAgICAgICAgICAgICB5OiBldmVudFNuYXBTaXplIHx8IGhvdXJTZWdtZW50SGVpZ2h0XFxuICAgICAgICAgICAgICAgICAgICAgIH1cXG4gICAgICAgICAgICAgICAgICAgIDoge31cXG4gICAgICAgICAgICAgICAgXFxcIlxcbiAgICAgICAgICAgICAgICBbZ2hvc3REcmFnRW5hYmxlZF09XFxcIiFzbmFwRHJhZ2dlZEV2ZW50c1xcXCJcXG4gICAgICAgICAgICAgICAgW3ZhbGlkYXRlRHJhZ109XFxcInZhbGlkYXRlRHJhZ1xcXCJcXG4gICAgICAgICAgICAgICAgKGRyYWdTdGFydCk9XFxcImRyYWdTdGFydGVkKGRheUNvbHVtbnMsIGV2ZW50LCB0aW1lRXZlbnQpXFxcIlxcbiAgICAgICAgICAgICAgICAoZHJhZ2dpbmcpPVxcXCJkcmFnTW92ZSh0aW1lRXZlbnQsICRldmVudClcXFwiXFxuICAgICAgICAgICAgICAgIChkcmFnRW5kKT1cXFwiZHJhZ0VuZGVkKHRpbWVFdmVudCwgJGV2ZW50LCBkYXlDb2x1bW5XaWR0aCwgdHJ1ZSlcXFwiXFxuICAgICAgICAgICAgICA+XFxuICAgICAgICAgICAgICAgIDxkaXZcXG4gICAgICAgICAgICAgICAgICBjbGFzcz1cXFwiY2FsLXJlc2l6ZS1oYW5kbGUgY2FsLXJlc2l6ZS1oYW5kbGUtYmVmb3JlLXN0YXJ0XFxcIlxcbiAgICAgICAgICAgICAgICAgICpuZ0lmPVxcXCJcXG4gICAgICAgICAgICAgICAgICAgIHRpbWVFdmVudC5ldmVudD8ucmVzaXphYmxlPy5iZWZvcmVTdGFydCAmJlxcbiAgICAgICAgICAgICAgICAgICAgIXRpbWVFdmVudC5zdGFydHNCZWZvcmVEYXlcXG4gICAgICAgICAgICAgICAgICBcXFwiXFxuICAgICAgICAgICAgICAgICAgbXdsUmVzaXplSGFuZGxlXFxuICAgICAgICAgICAgICAgICAgW3Jlc2l6ZUVkZ2VzXT1cXFwie1xcbiAgICAgICAgICAgICAgICAgICAgbGVmdDogdHJ1ZSxcXG4gICAgICAgICAgICAgICAgICAgIHRvcDogdHJ1ZVxcbiAgICAgICAgICAgICAgICAgIH1cXFwiXFxuICAgICAgICAgICAgICAgID48L2Rpdj5cXG4gICAgICAgICAgICAgICAgPG13bC1jYWxlbmRhci13ZWVrLXZpZXctZXZlbnRcXG4gICAgICAgICAgICAgICAgICBbbG9jYWxlXT1cXFwibG9jYWxlXFxcIlxcbiAgICAgICAgICAgICAgICAgIFt3ZWVrRXZlbnRdPVxcXCJ0aW1lRXZlbnRcXFwiXFxuICAgICAgICAgICAgICAgICAgW3Rvb2x0aXBQbGFjZW1lbnRdPVxcXCJ0b29sdGlwUGxhY2VtZW50XFxcIlxcbiAgICAgICAgICAgICAgICAgIFt0b29sdGlwVGVtcGxhdGVdPVxcXCJ0b29sdGlwVGVtcGxhdGVcXFwiXFxuICAgICAgICAgICAgICAgICAgW3Rvb2x0aXBBcHBlbmRUb0JvZHldPVxcXCJ0b29sdGlwQXBwZW5kVG9Cb2R5XFxcIlxcbiAgICAgICAgICAgICAgICAgIFt0b29sdGlwRGlzYWJsZWRdPVxcXCJkcmFnQWN0aXZlIHx8IHRpbWVFdmVudFJlc2l6ZXMuc2l6ZSA+IDBcXFwiXFxuICAgICAgICAgICAgICAgICAgW3Rvb2x0aXBEZWxheV09XFxcInRvb2x0aXBEZWxheVxcXCJcXG4gICAgICAgICAgICAgICAgICBbY3VzdG9tVGVtcGxhdGVdPVxcXCJldmVudFRlbXBsYXRlXFxcIlxcbiAgICAgICAgICAgICAgICAgIFtldmVudFRpdGxlVGVtcGxhdGVdPVxcXCJldmVudFRpdGxlVGVtcGxhdGVcXFwiXFxuICAgICAgICAgICAgICAgICAgW2V2ZW50QWN0aW9uc1RlbXBsYXRlXT1cXFwiZXZlbnRBY3Rpb25zVGVtcGxhdGVcXFwiXFxuICAgICAgICAgICAgICAgICAgW2NvbHVtbl09XFxcImNvbHVtblxcXCJcXG4gICAgICAgICAgICAgICAgICBbZGF5c0luV2Vla109XFxcImRheXNJbldlZWtcXFwiXFxuICAgICAgICAgICAgICAgICAgKGV2ZW50Q2xpY2tlZCk9XFxcIlxcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRDbGlja2VkLmVtaXQoe1xcbiAgICAgICAgICAgICAgICAgICAgICBldmVudDogdGltZUV2ZW50LmV2ZW50LFxcbiAgICAgICAgICAgICAgICAgICAgICBzb3VyY2VFdmVudDogJGV2ZW50LnNvdXJjZUV2ZW50XFxuICAgICAgICAgICAgICAgICAgICB9KVxcbiAgICAgICAgICAgICAgICAgIFxcXCJcXG4gICAgICAgICAgICAgICAgPlxcbiAgICAgICAgICAgICAgICA8L213bC1jYWxlbmRhci13ZWVrLXZpZXctZXZlbnQ+XFxuICAgICAgICAgICAgICAgIDxkaXZcXG4gICAgICAgICAgICAgICAgICBjbGFzcz1cXFwiY2FsLXJlc2l6ZS1oYW5kbGUgY2FsLXJlc2l6ZS1oYW5kbGUtYWZ0ZXItZW5kXFxcIlxcbiAgICAgICAgICAgICAgICAgICpuZ0lmPVxcXCJcXG4gICAgICAgICAgICAgICAgICAgIHRpbWVFdmVudC5ldmVudD8ucmVzaXphYmxlPy5hZnRlckVuZCAmJlxcbiAgICAgICAgICAgICAgICAgICAgIXRpbWVFdmVudC5lbmRzQWZ0ZXJEYXlcXG4gICAgICAgICAgICAgICAgICBcXFwiXFxuICAgICAgICAgICAgICAgICAgbXdsUmVzaXplSGFuZGxlXFxuICAgICAgICAgICAgICAgICAgW3Jlc2l6ZUVkZ2VzXT1cXFwie1xcbiAgICAgICAgICAgICAgICAgICAgcmlnaHQ6IHRydWUsXFxuICAgICAgICAgICAgICAgICAgICBib3R0b206IHRydWVcXG4gICAgICAgICAgICAgICAgICB9XFxcIlxcbiAgICAgICAgICAgICAgICA+PC9kaXY+XFxuICAgICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgICA8L2Rpdj5cXG5cXG4gICAgICAgICAgICA8ZGl2XFxuICAgICAgICAgICAgICAqbmdGb3I9XFxcIlxcbiAgICAgICAgICAgICAgICBsZXQgaG91ciBvZiBjb2x1bW4uaG91cnM7XFxuICAgICAgICAgICAgICAgIHRyYWNrQnk6IHRyYWNrQnlIb3VyO1xcbiAgICAgICAgICAgICAgICBsZXQgb2RkID0gb2RkXFxuICAgICAgICAgICAgICBcXFwiXFxuICAgICAgICAgICAgICBjbGFzcz1cXFwiY2FsLWhvdXJcXFwiXFxuICAgICAgICAgICAgICBbY2xhc3MuY2FsLWhvdXItb2RkXT1cXFwib2RkXFxcIlxcbiAgICAgICAgICAgID5cXG4gICAgICAgICAgICAgIDxtd2wtY2FsZW5kYXItd2Vlay12aWV3LWhvdXItc2VnbWVudFxcbiAgICAgICAgICAgICAgICAqbmdGb3I9XFxcIlxcbiAgICAgICAgICAgICAgICAgIGxldCBzZWdtZW50IG9mIGhvdXIuc2VnbWVudHM7XFxuICAgICAgICAgICAgICAgICAgdHJhY2tCeTogdHJhY2tCeUhvdXJTZWdtZW50XFxuICAgICAgICAgICAgICAgIFxcXCJcXG4gICAgICAgICAgICAgICAgW3N0eWxlLmhlaWdodC5weF09XFxcImhvdXJTZWdtZW50SGVpZ2h0XFxcIlxcbiAgICAgICAgICAgICAgICBbc2VnbWVudF09XFxcInNlZ21lbnRcXFwiXFxuICAgICAgICAgICAgICAgIFtzZWdtZW50SGVpZ2h0XT1cXFwiaG91clNlZ21lbnRIZWlnaHRcXFwiXFxuICAgICAgICAgICAgICAgIFtsb2NhbGVdPVxcXCJsb2NhbGVcXFwiXFxuICAgICAgICAgICAgICAgIFtjdXN0b21UZW1wbGF0ZV09XFxcImhvdXJTZWdtZW50VGVtcGxhdGVcXFwiXFxuICAgICAgICAgICAgICAgIFtkYXlzSW5XZWVrXT1cXFwiZGF5c0luV2Vla1xcXCJcXG4gICAgICAgICAgICAgICAgKG13bENsaWNrKT1cXFwiXFxuICAgICAgICAgICAgICAgICAgaG91clNlZ21lbnRDbGlja2VkLmVtaXQoe1xcbiAgICAgICAgICAgICAgICAgICAgZGF0ZTogc2VnbWVudC5kYXRlLFxcbiAgICAgICAgICAgICAgICAgICAgc291cmNlRXZlbnQ6ICRldmVudFxcbiAgICAgICAgICAgICAgICAgIH0pXFxuICAgICAgICAgICAgICAgIFxcXCJcXG4gICAgICAgICAgICAgICAgW2NsaWNrTGlzdGVuZXJEaXNhYmxlZF09XFxcIlxcbiAgICAgICAgICAgICAgICAgIGhvdXJTZWdtZW50Q2xpY2tlZC5vYnNlcnZlcnMubGVuZ3RoID09PSAwXFxuICAgICAgICAgICAgICAgIFxcXCJcXG4gICAgICAgICAgICAgICAgbXdsRHJvcHBhYmxlXFxuICAgICAgICAgICAgICAgIFtkcmFnT3ZlckNsYXNzXT1cXFwiXFxuICAgICAgICAgICAgICAgICAgIWRyYWdBY3RpdmUgfHwgIXNuYXBEcmFnZ2VkRXZlbnRzID8gJ2NhbC1kcmFnLW92ZXInIDogbnVsbFxcbiAgICAgICAgICAgICAgICBcXFwiXFxuICAgICAgICAgICAgICAgIGRyYWdBY3RpdmVDbGFzcz1cXFwiY2FsLWRyYWctYWN0aXZlXFxcIlxcbiAgICAgICAgICAgICAgICAoZHJvcCk9XFxcImV2ZW50RHJvcHBlZCgkZXZlbnQsIHNlZ21lbnQuZGF0ZSwgZmFsc2UpXFxcIlxcbiAgICAgICAgICAgICAgICAoZHJhZ0VudGVyKT1cXFwiZGF0ZURyYWdFbnRlcihzZWdtZW50LmRhdGUpXFxcIlxcbiAgICAgICAgICAgICAgICBbaXNUaW1lTGFiZWxdPVxcXCJkYXlzSW5XZWVrID09PSAxXFxcIlxcbiAgICAgICAgICAgICAgPlxcbiAgICAgICAgICAgICAgPC9td2wtY2FsZW5kYXItd2Vlay12aWV3LWhvdXItc2VnbWVudD5cXG4gICAgICAgICAgICA8L2Rpdj5cXG4gICAgICAgICAgPC9kaXY+XFxuICAgICAgICA8L2Rpdj5cXG4gICAgICA8L2Rpdj5cXG4gICAgPC9kaXY+XFxuICBcIlxuICAgICAgICB9KSxcbiAgICAgICAgdHNsaWJfMS5fX3BhcmFtKDIsIEluamVjdChMT0NBTEVfSUQpKSxcbiAgICAgICAgdHNsaWJfMS5fX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW0NoYW5nZURldGVjdG9yUmVmLFxuICAgICAgICAgICAgQ2FsZW5kYXJVdGlscywgU3RyaW5nLCBEYXRlQWRhcHRlcl0pXG4gICAgXSwgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudCk7XG4gICAgcmV0dXJuIENhbGVuZGFyV2Vla1ZpZXdDb21wb25lbnQ7XG59KCkpO1xuZXhwb3J0IHsgQ2FsZW5kYXJXZWVrVmlld0NvbXBvbmVudCB9O1xuIl19