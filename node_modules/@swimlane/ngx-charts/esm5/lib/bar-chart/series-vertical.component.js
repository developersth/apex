import { __decorate } from "tslib";
import { Component, Input, Output, EventEmitter, ChangeDetectionStrategy } from '@angular/core';
import { trigger, style, animate, transition } from '@angular/animations';
import { formatLabel, escapeLabel } from '../common/label.helper';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common';
import * as ɵngcc2 from './bar.component';
import * as ɵngcc3 from '../common/tooltip/tooltip.directive';
import * as ɵngcc4 from './bar-label.component';

var _c0 = ["ngx-charts-series-vertical", ""];
function SeriesVerticalComponent__svg_g_0_Template(rf, ctx) { if (rf & 1) {
    var _r250 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵnamespaceSVG();
    ɵngcc0.ɵɵelementStart(0, "g", 2);
    ɵngcc0.ɵɵlistener("select", function SeriesVerticalComponent__svg_g_0_Template__svg_g_select_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r250); var ctx_r249 = ɵngcc0.ɵɵnextContext(); return ctx_r249.onClick($event); })("activate", function SeriesVerticalComponent__svg_g_0_Template__svg_g_activate_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r250); var ctx_r251 = ɵngcc0.ɵɵnextContext(); return ctx_r251.activate.emit($event); })("deactivate", function SeriesVerticalComponent__svg_g_0_Template__svg_g_deactivate_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r250); var ctx_r252 = ɵngcc0.ɵɵnextContext(); return ctx_r252.deactivate.emit($event); });
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var bar_r248 = ctx.$implicit;
    var ctx_r246 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("@animationState", "active")("@.disabled", !ctx_r246.animations)("width", bar_r248.width)("height", bar_r248.height)("x", bar_r248.x)("y", bar_r248.y)("fill", bar_r248.color)("stops", bar_r248.gradientStops)("data", bar_r248.data)("orientation", "vertical")("roundEdges", bar_r248.roundEdges)("gradient", ctx_r246.gradient)("ariaLabel", bar_r248.ariaLabel)("isActive", ctx_r246.isActive(bar_r248.data))("tooltipDisabled", ctx_r246.tooltipDisabled)("tooltipPlacement", ctx_r246.tooltipPlacement)("tooltipType", ctx_r246.tooltipType)("tooltipTitle", ctx_r246.tooltipTemplate ? undefined : bar_r248.tooltipText)("tooltipTemplate", ctx_r246.tooltipTemplate)("tooltipContext", bar_r248.data)("noBarWhenZero", ctx_r246.noBarWhenZero)("animations", ctx_r246.animations);
} }
function SeriesVerticalComponent__svg_g_1__svg_g_1_Template(rf, ctx) { if (rf & 1) {
    var _r257 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵnamespaceSVG();
    ɵngcc0.ɵɵelementStart(0, "g", 4);
    ɵngcc0.ɵɵlistener("dimensionsChanged", function SeriesVerticalComponent__svg_g_1__svg_g_1_Template__svg_g_dimensionsChanged_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r257); var i_r255 = ctx.index; var ctx_r256 = ɵngcc0.ɵɵnextContext(2); return ctx_r256.dataLabelHeightChanged.emit({ size: $event, index: i_r255 }); });
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var b_r254 = ctx.$implicit;
    var ctx_r253 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("barX", b_r254.x)("barY", b_r254.y)("barWidth", b_r254.width)("barHeight", b_r254.height)("value", b_r254.total)("valueFormatting", ctx_r253.dataLabelFormatting)("orientation", "vertical");
} }
function SeriesVerticalComponent__svg_g_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵnamespaceSVG();
    ɵngcc0.ɵɵelementStart(0, "g");
    ɵngcc0.ɵɵtemplate(1, SeriesVerticalComponent__svg_g_1__svg_g_1_Template, 1, 7, "g", 3);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    var ctx_r247 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r247.barsForDataLabels)("ngForTrackBy", ctx_r247.trackDataLabelBy);
} }
export var D0Types;
(function (D0Types) {
    D0Types["positive"] = "positive";
    D0Types["negative"] = "negative";
})(D0Types || (D0Types = {}));
var SeriesVerticalComponent = /** @class */ (function () {
    function SeriesVerticalComponent() {
        this.type = 'standard';
        this.tooltipDisabled = false;
        this.animations = true;
        this.showDataLabel = false;
        this.noBarWhenZero = true;
        this.select = new EventEmitter();
        this.activate = new EventEmitter();
        this.deactivate = new EventEmitter();
        this.dataLabelHeightChanged = new EventEmitter();
        this.barsForDataLabels = [];
    }
    SeriesVerticalComponent.prototype.ngOnChanges = function (changes) {
        this.update();
    };
    SeriesVerticalComponent.prototype.update = function () {
        var _a;
        var _this = this;
        this.updateTooltipSettings();
        var width;
        if (this.series.length) {
            width = this.xScale.bandwidth();
        }
        width = Math.round(width);
        var yScaleMin = Math.max(this.yScale.domain()[0], 0);
        var d0 = (_a = {},
            _a[D0Types.positive] = 0,
            _a[D0Types.negative] = 0,
            _a);
        var d0Type = D0Types.positive;
        var total;
        if (this.type === 'normalized') {
            total = this.series.map(function (d) { return d.value; }).reduce(function (sum, d) { return sum + d; }, 0);
        }
        this.bars = this.series.map(function (d, index) {
            var value = d.value;
            var label = _this.getLabel(d);
            var formattedLabel = formatLabel(label);
            var roundEdges = _this.roundEdges;
            d0Type = value > 0 ? D0Types.positive : D0Types.negative;
            var bar = {
                value: value,
                label: label,
                roundEdges: roundEdges,
                data: d,
                width: width,
                formattedLabel: formattedLabel,
                height: 0,
                x: 0,
                y: 0
            };
            if (_this.type === 'standard') {
                bar.height = Math.abs(_this.yScale(value) - _this.yScale(yScaleMin));
                bar.x = _this.xScale(label);
                if (value < 0) {
                    bar.y = _this.yScale(0);
                }
                else {
                    bar.y = _this.yScale(value);
                }
            }
            else if (_this.type === 'stacked') {
                var offset0 = d0[d0Type];
                var offset1 = offset0 + value;
                d0[d0Type] += value;
                bar.height = _this.yScale(offset0) - _this.yScale(offset1);
                bar.x = 0;
                bar.y = _this.yScale(offset1);
                bar.offset0 = offset0;
                bar.offset1 = offset1;
            }
            else if (_this.type === 'normalized') {
                var offset0 = d0[d0Type];
                var offset1 = offset0 + value;
                d0[d0Type] += value;
                if (total > 0) {
                    offset0 = (offset0 * 100) / total;
                    offset1 = (offset1 * 100) / total;
                }
                else {
                    offset0 = 0;
                    offset1 = 0;
                }
                bar.height = _this.yScale(offset0) - _this.yScale(offset1);
                bar.x = 0;
                bar.y = _this.yScale(offset1);
                bar.offset0 = offset0;
                bar.offset1 = offset1;
                value = (offset1 - offset0).toFixed(2) + '%';
            }
            if (_this.colors.scaleType === 'ordinal') {
                bar.color = _this.colors.getColor(label);
            }
            else {
                if (_this.type === 'standard') {
                    bar.color = _this.colors.getColor(value);
                    bar.gradientStops = _this.colors.getLinearGradientStops(value);
                }
                else {
                    bar.color = _this.colors.getColor(bar.offset1);
                    bar.gradientStops = _this.colors.getLinearGradientStops(bar.offset1, bar.offset0);
                }
            }
            var tooltipLabel = formattedLabel;
            bar.ariaLabel = formattedLabel + ' ' + value.toLocaleString();
            if (_this.seriesName) {
                tooltipLabel = _this.seriesName + " \u2022 " + formattedLabel;
                bar.data.series = _this.seriesName;
                bar.ariaLabel = _this.seriesName + ' ' + bar.ariaLabel;
            }
            bar.tooltipText = _this.tooltipDisabled
                ? undefined
                : "\n        <span class=\"tooltip-label\">" + escapeLabel(tooltipLabel) + "</span>\n        <span class=\"tooltip-val\">" + value.toLocaleString() + "</span>\n      ";
            return bar;
        });
        this.updateDataLabels();
    };
    SeriesVerticalComponent.prototype.updateDataLabels = function () {
        var _this = this;
        if (this.type === 'stacked') {
            this.barsForDataLabels = [];
            var section = {};
            section.series = this.seriesName;
            var totalPositive = this.series.map(function (d) { return d.value; }).reduce(function (sum, d) { return (d > 0 ? sum + d : sum); }, 0);
            var totalNegative = this.series.map(function (d) { return d.value; }).reduce(function (sum, d) { return (d < 0 ? sum + d : sum); }, 0);
            section.total = totalPositive + totalNegative;
            section.x = 0;
            section.y = 0;
            if (section.total > 0) {
                section.height = this.yScale(totalPositive);
            }
            else {
                section.height = this.yScale(totalNegative);
            }
            section.width = this.xScale.bandwidth();
            this.barsForDataLabels.push(section);
        }
        else {
            this.barsForDataLabels = this.series.map(function (d) {
                var section = {};
                section.series = _this.seriesName ? _this.seriesName : d.label;
                section.total = d.value;
                section.x = _this.xScale(d.label);
                section.y = _this.yScale(0);
                section.height = _this.yScale(section.total) - _this.yScale(0);
                section.width = _this.xScale.bandwidth();
                return section;
            });
        }
    };
    SeriesVerticalComponent.prototype.updateTooltipSettings = function () {
        this.tooltipPlacement = this.tooltipDisabled ? undefined : 'top';
        this.tooltipType = this.tooltipDisabled ? undefined : 'tooltip';
    };
    SeriesVerticalComponent.prototype.isActive = function (entry) {
        if (!this.activeEntries)
            return false;
        var item = this.activeEntries.find(function (d) {
            return entry.name === d.name && entry.series === d.series;
        });
        return item !== undefined;
    };
    SeriesVerticalComponent.prototype.onClick = function (data) {
        this.select.emit(data);
    };
    SeriesVerticalComponent.prototype.getLabel = function (dataItem) {
        if (dataItem.label) {
            return dataItem.label;
        }
        return dataItem.name;
    };
    SeriesVerticalComponent.prototype.trackBy = function (index, bar) {
        return bar.label;
    };
    SeriesVerticalComponent.prototype.trackDataLabelBy = function (index, barLabel) {
        return index + '#' + barLabel.series + '#' + barLabel.total;
    };
    __decorate([
        Input()
    ], SeriesVerticalComponent.prototype, "dims", void 0);
    __decorate([
        Input()
    ], SeriesVerticalComponent.prototype, "type", void 0);
    __decorate([
        Input()
    ], SeriesVerticalComponent.prototype, "series", void 0);
    __decorate([
        Input()
    ], SeriesVerticalComponent.prototype, "xScale", void 0);
    __decorate([
        Input()
    ], SeriesVerticalComponent.prototype, "yScale", void 0);
    __decorate([
        Input()
    ], SeriesVerticalComponent.prototype, "colors", void 0);
    __decorate([
        Input()
    ], SeriesVerticalComponent.prototype, "gradient", void 0);
    __decorate([
        Input()
    ], SeriesVerticalComponent.prototype, "activeEntries", void 0);
    __decorate([
        Input()
    ], SeriesVerticalComponent.prototype, "seriesName", void 0);
    __decorate([
        Input()
    ], SeriesVerticalComponent.prototype, "tooltipDisabled", void 0);
    __decorate([
        Input()
    ], SeriesVerticalComponent.prototype, "tooltipTemplate", void 0);
    __decorate([
        Input()
    ], SeriesVerticalComponent.prototype, "roundEdges", void 0);
    __decorate([
        Input()
    ], SeriesVerticalComponent.prototype, "animations", void 0);
    __decorate([
        Input()
    ], SeriesVerticalComponent.prototype, "showDataLabel", void 0);
    __decorate([
        Input()
    ], SeriesVerticalComponent.prototype, "dataLabelFormatting", void 0);
    __decorate([
        Input()
    ], SeriesVerticalComponent.prototype, "noBarWhenZero", void 0);
    __decorate([
        Output()
    ], SeriesVerticalComponent.prototype, "select", void 0);
    __decorate([
        Output()
    ], SeriesVerticalComponent.prototype, "activate", void 0);
    __decorate([
        Output()
    ], SeriesVerticalComponent.prototype, "deactivate", void 0);
    __decorate([
        Output()
    ], SeriesVerticalComponent.prototype, "dataLabelHeightChanged", void 0);
SeriesVerticalComponent.ɵfac = function SeriesVerticalComponent_Factory(t) { return new (t || SeriesVerticalComponent)(); };
SeriesVerticalComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: SeriesVerticalComponent, selectors: [["g", "ngx-charts-series-vertical", ""]], inputs: { type: "type", tooltipDisabled: "tooltipDisabled", animations: "animations", showDataLabel: "showDataLabel", noBarWhenZero: "noBarWhenZero", dims: "dims", series: "series", xScale: "xScale", yScale: "yScale", colors: "colors", gradient: "gradient", activeEntries: "activeEntries", seriesName: "seriesName", tooltipTemplate: "tooltipTemplate", roundEdges: "roundEdges", dataLabelFormatting: "dataLabelFormatting" }, outputs: { select: "select", activate: "activate", deactivate: "deactivate", dataLabelHeightChanged: "dataLabelHeightChanged" }, features: [ɵngcc0.ɵɵNgOnChangesFeature()], attrs: _c0, decls: 2, vars: 3, consts: [["ngx-charts-bar", "", "ngx-tooltip", "", 3, "width", "height", "x", "y", "fill", "stops", "data", "orientation", "roundEdges", "gradient", "ariaLabel", "isActive", "tooltipDisabled", "tooltipPlacement", "tooltipType", "tooltipTitle", "tooltipTemplate", "tooltipContext", "noBarWhenZero", "animations", "select", "activate", "deactivate", 4, "ngFor", "ngForOf", "ngForTrackBy"], [4, "ngIf"], ["ngx-charts-bar", "", "ngx-tooltip", "", 3, "width", "height", "x", "y", "fill", "stops", "data", "orientation", "roundEdges", "gradient", "ariaLabel", "isActive", "tooltipDisabled", "tooltipPlacement", "tooltipType", "tooltipTitle", "tooltipTemplate", "tooltipContext", "noBarWhenZero", "animations", "select", "activate", "deactivate"], ["ngx-charts-bar-label", "", 3, "barX", "barY", "barWidth", "barHeight", "value", "valueFormatting", "orientation", "dimensionsChanged", 4, "ngFor", "ngForOf", "ngForTrackBy"], ["ngx-charts-bar-label", "", 3, "barX", "barY", "barWidth", "barHeight", "value", "valueFormatting", "orientation", "dimensionsChanged"]], template: function SeriesVerticalComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, SeriesVerticalComponent__svg_g_0_Template, 1, 22, "g", 0);
        ɵngcc0.ɵɵtemplate(1, SeriesVerticalComponent__svg_g_1_Template, 2, 2, "g", 1);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngForOf", ctx.bars)("ngForTrackBy", ctx.trackBy);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showDataLabel);
    } }, directives: [ɵngcc1.NgForOf, ɵngcc1.NgIf, ɵngcc2.BarComponent, ɵngcc3.TooltipDirective, ɵngcc4.BarLabelComponent], encapsulation: 2, data: { animation: [
            trigger('animationState', [
                transition(':leave', [
                    style({
                        opacity: 1
                    }),
                    animate(500, style({ opacity: 0 }))
                ])
            ])
        ] }, changeDetection: 0 });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(SeriesVerticalComponent, [{
        type: Component,
        args: [{
                selector: 'g[ngx-charts-series-vertical]',
                template: "\n    <svg:g\n      ngx-charts-bar\n      *ngFor=\"let bar of bars; trackBy: trackBy\"\n      [@animationState]=\"'active'\"\n      [@.disabled]=\"!animations\"\n      [width]=\"bar.width\"\n      [height]=\"bar.height\"\n      [x]=\"bar.x\"\n      [y]=\"bar.y\"\n      [fill]=\"bar.color\"\n      [stops]=\"bar.gradientStops\"\n      [data]=\"bar.data\"\n      [orientation]=\"'vertical'\"\n      [roundEdges]=\"bar.roundEdges\"\n      [gradient]=\"gradient\"\n      [ariaLabel]=\"bar.ariaLabel\"\n      [isActive]=\"isActive(bar.data)\"\n      (select)=\"onClick($event)\"\n      (activate)=\"activate.emit($event)\"\n      (deactivate)=\"deactivate.emit($event)\"\n      ngx-tooltip\n      [tooltipDisabled]=\"tooltipDisabled\"\n      [tooltipPlacement]=\"tooltipPlacement\"\n      [tooltipType]=\"tooltipType\"\n      [tooltipTitle]=\"tooltipTemplate ? undefined : bar.tooltipText\"\n      [tooltipTemplate]=\"tooltipTemplate\"\n      [tooltipContext]=\"bar.data\"\n      [noBarWhenZero]=\"noBarWhenZero\"\n      [animations]=\"animations\"\n    ></svg:g>\n    <svg:g *ngIf=\"showDataLabel\">\n      <svg:g\n        ngx-charts-bar-label\n        *ngFor=\"let b of barsForDataLabels; let i = index; trackBy: trackDataLabelBy\"\n        [barX]=\"b.x\"\n        [barY]=\"b.y\"\n        [barWidth]=\"b.width\"\n        [barHeight]=\"b.height\"\n        [value]=\"b.total\"\n        [valueFormatting]=\"dataLabelFormatting\"\n        [orientation]=\"'vertical'\"\n        (dimensionsChanged)=\"dataLabelHeightChanged.emit({ size: $event, index: i })\"\n      />\n    </svg:g>\n  ",
                changeDetection: ChangeDetectionStrategy.OnPush,
                animations: [
                    trigger('animationState', [
                        transition(':leave', [
                            style({
                                opacity: 1
                            }),
                            animate(500, style({ opacity: 0 }))
                        ])
                    ])
                ]
            }]
    }], function () { return []; }, { type: [{
            type: Input
        }], tooltipDisabled: [{
            type: Input
        }], animations: [{
            type: Input
        }], showDataLabel: [{
            type: Input
        }], noBarWhenZero: [{
            type: Input
        }], select: [{
            type: Output
        }], activate: [{
            type: Output
        }], deactivate: [{
            type: Output
        }], dataLabelHeightChanged: [{
            type: Output
        }], dims: [{
            type: Input
        }], series: [{
            type: Input
        }], xScale: [{
            type: Input
        }], yScale: [{
            type: Input
        }], colors: [{
            type: Input
        }], gradient: [{
            type: Input
        }], activeEntries: [{
            type: Input
        }], seriesName: [{
            type: Input
        }], tooltipTemplate: [{
            type: Input
        }], roundEdges: [{
            type: Input
        }], dataLabelFormatting: [{
            type: Input
        }] }); })();
    return SeriesVerticalComponent;
}());
export { SeriesVerticalComponent };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYWNwcm8va3JpdHNhZGVlL1NWTi9DeWJlcnNvZnQvYXBleC9ub2RlX21vZHVsZXMvQHN3aW1sYW5lL25neC1jaGFydHMvZXNtNS9saWIvYmFyLWNoYXJ0L3Nlcmllcy12ZXJ0aWNhbC5jb21wb25lbnQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFJQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7NEVBa1A0RTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFpQjVDIiwiZmlsZSI6InNlcmllcy12ZXJ0aWNhbC5jb21wb25lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBfX2RlY29yYXRlIH0gZnJvbSBcInRzbGliXCI7XG5pbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IHRyaWdnZXIsIHN0eWxlLCBhbmltYXRlLCB0cmFuc2l0aW9uIH0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XG5pbXBvcnQgeyBmb3JtYXRMYWJlbCwgZXNjYXBlTGFiZWwgfSBmcm9tICcuLi9jb21tb24vbGFiZWwuaGVscGVyJztcbmV4cG9ydCB2YXIgRDBUeXBlcztcbihmdW5jdGlvbiAoRDBUeXBlcykge1xuICAgIEQwVHlwZXNbXCJwb3NpdGl2ZVwiXSA9IFwicG9zaXRpdmVcIjtcbiAgICBEMFR5cGVzW1wibmVnYXRpdmVcIl0gPSBcIm5lZ2F0aXZlXCI7XG59KShEMFR5cGVzIHx8IChEMFR5cGVzID0ge30pKTtcbnZhciBTZXJpZXNWZXJ0aWNhbENvbXBvbmVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBTZXJpZXNWZXJ0aWNhbENvbXBvbmVudCgpIHtcbiAgICAgICAgdGhpcy50eXBlID0gJ3N0YW5kYXJkJztcbiAgICAgICAgdGhpcy50b29sdGlwRGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25zID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zaG93RGF0YUxhYmVsID0gZmFsc2U7XG4gICAgICAgIHRoaXMubm9CYXJXaGVuWmVybyA9IHRydWU7XG4gICAgICAgIHRoaXMuc2VsZWN0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLmFjdGl2YXRlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLmRlYWN0aXZhdGUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMuZGF0YUxhYmVsSGVpZ2h0Q2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5iYXJzRm9yRGF0YUxhYmVscyA9IFtdO1xuICAgIH1cbiAgICBTZXJpZXNWZXJ0aWNhbENvbXBvbmVudC5wcm90b3R5cGUubmdPbkNoYW5nZXMgPSBmdW5jdGlvbiAoY2hhbmdlcykge1xuICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgIH07XG4gICAgU2VyaWVzVmVydGljYWxDb21wb25lbnQucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLnVwZGF0ZVRvb2x0aXBTZXR0aW5ncygpO1xuICAgICAgICB2YXIgd2lkdGg7XG4gICAgICAgIGlmICh0aGlzLnNlcmllcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHdpZHRoID0gdGhpcy54U2NhbGUuYmFuZHdpZHRoKCk7XG4gICAgICAgIH1cbiAgICAgICAgd2lkdGggPSBNYXRoLnJvdW5kKHdpZHRoKTtcbiAgICAgICAgdmFyIHlTY2FsZU1pbiA9IE1hdGgubWF4KHRoaXMueVNjYWxlLmRvbWFpbigpWzBdLCAwKTtcbiAgICAgICAgdmFyIGQwID0gKF9hID0ge30sXG4gICAgICAgICAgICBfYVtEMFR5cGVzLnBvc2l0aXZlXSA9IDAsXG4gICAgICAgICAgICBfYVtEMFR5cGVzLm5lZ2F0aXZlXSA9IDAsXG4gICAgICAgICAgICBfYSk7XG4gICAgICAgIHZhciBkMFR5cGUgPSBEMFR5cGVzLnBvc2l0aXZlO1xuICAgICAgICB2YXIgdG90YWw7XG4gICAgICAgIGlmICh0aGlzLnR5cGUgPT09ICdub3JtYWxpemVkJykge1xuICAgICAgICAgICAgdG90YWwgPSB0aGlzLnNlcmllcy5tYXAoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudmFsdWU7IH0pLnJlZHVjZShmdW5jdGlvbiAoc3VtLCBkKSB7IHJldHVybiBzdW0gKyBkOyB9LCAwKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmJhcnMgPSB0aGlzLnNlcmllcy5tYXAoZnVuY3Rpb24gKGQsIGluZGV4KSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBkLnZhbHVlO1xuICAgICAgICAgICAgdmFyIGxhYmVsID0gX3RoaXMuZ2V0TGFiZWwoZCk7XG4gICAgICAgICAgICB2YXIgZm9ybWF0dGVkTGFiZWwgPSBmb3JtYXRMYWJlbChsYWJlbCk7XG4gICAgICAgICAgICB2YXIgcm91bmRFZGdlcyA9IF90aGlzLnJvdW5kRWRnZXM7XG4gICAgICAgICAgICBkMFR5cGUgPSB2YWx1ZSA+IDAgPyBEMFR5cGVzLnBvc2l0aXZlIDogRDBUeXBlcy5uZWdhdGl2ZTtcbiAgICAgICAgICAgIHZhciBiYXIgPSB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgICAgIGxhYmVsOiBsYWJlbCxcbiAgICAgICAgICAgICAgICByb3VuZEVkZ2VzOiByb3VuZEVkZ2VzLFxuICAgICAgICAgICAgICAgIGRhdGE6IGQsXG4gICAgICAgICAgICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgICAgICAgICAgIGZvcm1hdHRlZExhYmVsOiBmb3JtYXR0ZWRMYWJlbCxcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IDAsXG4gICAgICAgICAgICAgICAgeDogMCxcbiAgICAgICAgICAgICAgICB5OiAwXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKF90aGlzLnR5cGUgPT09ICdzdGFuZGFyZCcpIHtcbiAgICAgICAgICAgICAgICBiYXIuaGVpZ2h0ID0gTWF0aC5hYnMoX3RoaXMueVNjYWxlKHZhbHVlKSAtIF90aGlzLnlTY2FsZSh5U2NhbGVNaW4pKTtcbiAgICAgICAgICAgICAgICBiYXIueCA9IF90aGlzLnhTY2FsZShsYWJlbCk7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICBiYXIueSA9IF90aGlzLnlTY2FsZSgwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGJhci55ID0gX3RoaXMueVNjYWxlKHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChfdGhpcy50eXBlID09PSAnc3RhY2tlZCcpIHtcbiAgICAgICAgICAgICAgICB2YXIgb2Zmc2V0MCA9IGQwW2QwVHlwZV07XG4gICAgICAgICAgICAgICAgdmFyIG9mZnNldDEgPSBvZmZzZXQwICsgdmFsdWU7XG4gICAgICAgICAgICAgICAgZDBbZDBUeXBlXSArPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBiYXIuaGVpZ2h0ID0gX3RoaXMueVNjYWxlKG9mZnNldDApIC0gX3RoaXMueVNjYWxlKG9mZnNldDEpO1xuICAgICAgICAgICAgICAgIGJhci54ID0gMDtcbiAgICAgICAgICAgICAgICBiYXIueSA9IF90aGlzLnlTY2FsZShvZmZzZXQxKTtcbiAgICAgICAgICAgICAgICBiYXIub2Zmc2V0MCA9IG9mZnNldDA7XG4gICAgICAgICAgICAgICAgYmFyLm9mZnNldDEgPSBvZmZzZXQxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoX3RoaXMudHlwZSA9PT0gJ25vcm1hbGl6ZWQnKSB7XG4gICAgICAgICAgICAgICAgdmFyIG9mZnNldDAgPSBkMFtkMFR5cGVdO1xuICAgICAgICAgICAgICAgIHZhciBvZmZzZXQxID0gb2Zmc2V0MCArIHZhbHVlO1xuICAgICAgICAgICAgICAgIGQwW2QwVHlwZV0gKz0gdmFsdWU7XG4gICAgICAgICAgICAgICAgaWYgKHRvdGFsID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBvZmZzZXQwID0gKG9mZnNldDAgKiAxMDApIC8gdG90YWw7XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldDEgPSAob2Zmc2V0MSAqIDEwMCkgLyB0b3RhbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldDAgPSAwO1xuICAgICAgICAgICAgICAgICAgICBvZmZzZXQxID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYmFyLmhlaWdodCA9IF90aGlzLnlTY2FsZShvZmZzZXQwKSAtIF90aGlzLnlTY2FsZShvZmZzZXQxKTtcbiAgICAgICAgICAgICAgICBiYXIueCA9IDA7XG4gICAgICAgICAgICAgICAgYmFyLnkgPSBfdGhpcy55U2NhbGUob2Zmc2V0MSk7XG4gICAgICAgICAgICAgICAgYmFyLm9mZnNldDAgPSBvZmZzZXQwO1xuICAgICAgICAgICAgICAgIGJhci5vZmZzZXQxID0gb2Zmc2V0MTtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IChvZmZzZXQxIC0gb2Zmc2V0MCkudG9GaXhlZCgyKSArICclJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChfdGhpcy5jb2xvcnMuc2NhbGVUeXBlID09PSAnb3JkaW5hbCcpIHtcbiAgICAgICAgICAgICAgICBiYXIuY29sb3IgPSBfdGhpcy5jb2xvcnMuZ2V0Q29sb3IobGFiZWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLnR5cGUgPT09ICdzdGFuZGFyZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgYmFyLmNvbG9yID0gX3RoaXMuY29sb3JzLmdldENvbG9yKHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgYmFyLmdyYWRpZW50U3RvcHMgPSBfdGhpcy5jb2xvcnMuZ2V0TGluZWFyR3JhZGllbnRTdG9wcyh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBiYXIuY29sb3IgPSBfdGhpcy5jb2xvcnMuZ2V0Q29sb3IoYmFyLm9mZnNldDEpO1xuICAgICAgICAgICAgICAgICAgICBiYXIuZ3JhZGllbnRTdG9wcyA9IF90aGlzLmNvbG9ycy5nZXRMaW5lYXJHcmFkaWVudFN0b3BzKGJhci5vZmZzZXQxLCBiYXIub2Zmc2V0MCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHRvb2x0aXBMYWJlbCA9IGZvcm1hdHRlZExhYmVsO1xuICAgICAgICAgICAgYmFyLmFyaWFMYWJlbCA9IGZvcm1hdHRlZExhYmVsICsgJyAnICsgdmFsdWUudG9Mb2NhbGVTdHJpbmcoKTtcbiAgICAgICAgICAgIGlmIChfdGhpcy5zZXJpZXNOYW1lKSB7XG4gICAgICAgICAgICAgICAgdG9vbHRpcExhYmVsID0gX3RoaXMuc2VyaWVzTmFtZSArIFwiIFxcdTIwMjIgXCIgKyBmb3JtYXR0ZWRMYWJlbDtcbiAgICAgICAgICAgICAgICBiYXIuZGF0YS5zZXJpZXMgPSBfdGhpcy5zZXJpZXNOYW1lO1xuICAgICAgICAgICAgICAgIGJhci5hcmlhTGFiZWwgPSBfdGhpcy5zZXJpZXNOYW1lICsgJyAnICsgYmFyLmFyaWFMYWJlbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJhci50b29sdGlwVGV4dCA9IF90aGlzLnRvb2x0aXBEaXNhYmxlZFxuICAgICAgICAgICAgICAgID8gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgOiBcIlxcbiAgICAgICAgPHNwYW4gY2xhc3M9XFxcInRvb2x0aXAtbGFiZWxcXFwiPlwiICsgZXNjYXBlTGFiZWwodG9vbHRpcExhYmVsKSArIFwiPC9zcGFuPlxcbiAgICAgICAgPHNwYW4gY2xhc3M9XFxcInRvb2x0aXAtdmFsXFxcIj5cIiArIHZhbHVlLnRvTG9jYWxlU3RyaW5nKCkgKyBcIjwvc3Bhbj5cXG4gICAgICBcIjtcbiAgICAgICAgICAgIHJldHVybiBiYXI7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnVwZGF0ZURhdGFMYWJlbHMoKTtcbiAgICB9O1xuICAgIFNlcmllc1ZlcnRpY2FsQ29tcG9uZW50LnByb3RvdHlwZS51cGRhdGVEYXRhTGFiZWxzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy50eXBlID09PSAnc3RhY2tlZCcpIHtcbiAgICAgICAgICAgIHRoaXMuYmFyc0ZvckRhdGFMYWJlbHMgPSBbXTtcbiAgICAgICAgICAgIHZhciBzZWN0aW9uID0ge307XG4gICAgICAgICAgICBzZWN0aW9uLnNlcmllcyA9IHRoaXMuc2VyaWVzTmFtZTtcbiAgICAgICAgICAgIHZhciB0b3RhbFBvc2l0aXZlID0gdGhpcy5zZXJpZXMubWFwKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLnZhbHVlOyB9KS5yZWR1Y2UoZnVuY3Rpb24gKHN1bSwgZCkgeyByZXR1cm4gKGQgPiAwID8gc3VtICsgZCA6IHN1bSk7IH0sIDApO1xuICAgICAgICAgICAgdmFyIHRvdGFsTmVnYXRpdmUgPSB0aGlzLnNlcmllcy5tYXAoZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQudmFsdWU7IH0pLnJlZHVjZShmdW5jdGlvbiAoc3VtLCBkKSB7IHJldHVybiAoZCA8IDAgPyBzdW0gKyBkIDogc3VtKTsgfSwgMCk7XG4gICAgICAgICAgICBzZWN0aW9uLnRvdGFsID0gdG90YWxQb3NpdGl2ZSArIHRvdGFsTmVnYXRpdmU7XG4gICAgICAgICAgICBzZWN0aW9uLnggPSAwO1xuICAgICAgICAgICAgc2VjdGlvbi55ID0gMDtcbiAgICAgICAgICAgIGlmIChzZWN0aW9uLnRvdGFsID4gMCkge1xuICAgICAgICAgICAgICAgIHNlY3Rpb24uaGVpZ2h0ID0gdGhpcy55U2NhbGUodG90YWxQb3NpdGl2ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZWN0aW9uLmhlaWdodCA9IHRoaXMueVNjYWxlKHRvdGFsTmVnYXRpdmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2VjdGlvbi53aWR0aCA9IHRoaXMueFNjYWxlLmJhbmR3aWR0aCgpO1xuICAgICAgICAgICAgdGhpcy5iYXJzRm9yRGF0YUxhYmVscy5wdXNoKHNlY3Rpb24pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5iYXJzRm9yRGF0YUxhYmVscyA9IHRoaXMuc2VyaWVzLm1hcChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIHZhciBzZWN0aW9uID0ge307XG4gICAgICAgICAgICAgICAgc2VjdGlvbi5zZXJpZXMgPSBfdGhpcy5zZXJpZXNOYW1lID8gX3RoaXMuc2VyaWVzTmFtZSA6IGQubGFiZWw7XG4gICAgICAgICAgICAgICAgc2VjdGlvbi50b3RhbCA9IGQudmFsdWU7XG4gICAgICAgICAgICAgICAgc2VjdGlvbi54ID0gX3RoaXMueFNjYWxlKGQubGFiZWwpO1xuICAgICAgICAgICAgICAgIHNlY3Rpb24ueSA9IF90aGlzLnlTY2FsZSgwKTtcbiAgICAgICAgICAgICAgICBzZWN0aW9uLmhlaWdodCA9IF90aGlzLnlTY2FsZShzZWN0aW9uLnRvdGFsKSAtIF90aGlzLnlTY2FsZSgwKTtcbiAgICAgICAgICAgICAgICBzZWN0aW9uLndpZHRoID0gX3RoaXMueFNjYWxlLmJhbmR3aWR0aCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBzZWN0aW9uO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNlcmllc1ZlcnRpY2FsQ29tcG9uZW50LnByb3RvdHlwZS51cGRhdGVUb29sdGlwU2V0dGluZ3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudG9vbHRpcFBsYWNlbWVudCA9IHRoaXMudG9vbHRpcERpc2FibGVkID8gdW5kZWZpbmVkIDogJ3RvcCc7XG4gICAgICAgIHRoaXMudG9vbHRpcFR5cGUgPSB0aGlzLnRvb2x0aXBEaXNhYmxlZCA/IHVuZGVmaW5lZCA6ICd0b29sdGlwJztcbiAgICB9O1xuICAgIFNlcmllc1ZlcnRpY2FsQ29tcG9uZW50LnByb3RvdHlwZS5pc0FjdGl2ZSA9IGZ1bmN0aW9uIChlbnRyeSkge1xuICAgICAgICBpZiAoIXRoaXMuYWN0aXZlRW50cmllcylcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgdmFyIGl0ZW0gPSB0aGlzLmFjdGl2ZUVudHJpZXMuZmluZChmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIGVudHJ5Lm5hbWUgPT09IGQubmFtZSAmJiBlbnRyeS5zZXJpZXMgPT09IGQuc2VyaWVzO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGl0ZW0gIT09IHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIFNlcmllc1ZlcnRpY2FsQ29tcG9uZW50LnByb3RvdHlwZS5vbkNsaWNrID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgdGhpcy5zZWxlY3QuZW1pdChkYXRhKTtcbiAgICB9O1xuICAgIFNlcmllc1ZlcnRpY2FsQ29tcG9uZW50LnByb3RvdHlwZS5nZXRMYWJlbCA9IGZ1bmN0aW9uIChkYXRhSXRlbSkge1xuICAgICAgICBpZiAoZGF0YUl0ZW0ubGFiZWwpIHtcbiAgICAgICAgICAgIHJldHVybiBkYXRhSXRlbS5sYWJlbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YUl0ZW0ubmFtZTtcbiAgICB9O1xuICAgIFNlcmllc1ZlcnRpY2FsQ29tcG9uZW50LnByb3RvdHlwZS50cmFja0J5ID0gZnVuY3Rpb24gKGluZGV4LCBiYXIpIHtcbiAgICAgICAgcmV0dXJuIGJhci5sYWJlbDtcbiAgICB9O1xuICAgIFNlcmllc1ZlcnRpY2FsQ29tcG9uZW50LnByb3RvdHlwZS50cmFja0RhdGFMYWJlbEJ5ID0gZnVuY3Rpb24gKGluZGV4LCBiYXJMYWJlbCkge1xuICAgICAgICByZXR1cm4gaW5kZXggKyAnIycgKyBiYXJMYWJlbC5zZXJpZXMgKyAnIycgKyBiYXJMYWJlbC50b3RhbDtcbiAgICB9O1xuICAgIF9fZGVjb3JhdGUoW1xuICAgICAgICBJbnB1dCgpXG4gICAgXSwgU2VyaWVzVmVydGljYWxDb21wb25lbnQucHJvdG90eXBlLCBcImRpbXNcIiwgdm9pZCAwKTtcbiAgICBfX2RlY29yYXRlKFtcbiAgICAgICAgSW5wdXQoKVxuICAgIF0sIFNlcmllc1ZlcnRpY2FsQ29tcG9uZW50LnByb3RvdHlwZSwgXCJ0eXBlXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbXG4gICAgICAgIElucHV0KClcbiAgICBdLCBTZXJpZXNWZXJ0aWNhbENvbXBvbmVudC5wcm90b3R5cGUsIFwic2VyaWVzXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbXG4gICAgICAgIElucHV0KClcbiAgICBdLCBTZXJpZXNWZXJ0aWNhbENvbXBvbmVudC5wcm90b3R5cGUsIFwieFNjYWxlXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbXG4gICAgICAgIElucHV0KClcbiAgICBdLCBTZXJpZXNWZXJ0aWNhbENvbXBvbmVudC5wcm90b3R5cGUsIFwieVNjYWxlXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbXG4gICAgICAgIElucHV0KClcbiAgICBdLCBTZXJpZXNWZXJ0aWNhbENvbXBvbmVudC5wcm90b3R5cGUsIFwiY29sb3JzXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbXG4gICAgICAgIElucHV0KClcbiAgICBdLCBTZXJpZXNWZXJ0aWNhbENvbXBvbmVudC5wcm90b3R5cGUsIFwiZ3JhZGllbnRcIiwgdm9pZCAwKTtcbiAgICBfX2RlY29yYXRlKFtcbiAgICAgICAgSW5wdXQoKVxuICAgIF0sIFNlcmllc1ZlcnRpY2FsQ29tcG9uZW50LnByb3RvdHlwZSwgXCJhY3RpdmVFbnRyaWVzXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbXG4gICAgICAgIElucHV0KClcbiAgICBdLCBTZXJpZXNWZXJ0aWNhbENvbXBvbmVudC5wcm90b3R5cGUsIFwic2VyaWVzTmFtZVwiLCB2b2lkIDApO1xuICAgIF9fZGVjb3JhdGUoW1xuICAgICAgICBJbnB1dCgpXG4gICAgXSwgU2VyaWVzVmVydGljYWxDb21wb25lbnQucHJvdG90eXBlLCBcInRvb2x0aXBEaXNhYmxlZFwiLCB2b2lkIDApO1xuICAgIF9fZGVjb3JhdGUoW1xuICAgICAgICBJbnB1dCgpXG4gICAgXSwgU2VyaWVzVmVydGljYWxDb21wb25lbnQucHJvdG90eXBlLCBcInRvb2x0aXBUZW1wbGF0ZVwiLCB2b2lkIDApO1xuICAgIF9fZGVjb3JhdGUoW1xuICAgICAgICBJbnB1dCgpXG4gICAgXSwgU2VyaWVzVmVydGljYWxDb21wb25lbnQucHJvdG90eXBlLCBcInJvdW5kRWRnZXNcIiwgdm9pZCAwKTtcbiAgICBfX2RlY29yYXRlKFtcbiAgICAgICAgSW5wdXQoKVxuICAgIF0sIFNlcmllc1ZlcnRpY2FsQ29tcG9uZW50LnByb3RvdHlwZSwgXCJhbmltYXRpb25zXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbXG4gICAgICAgIElucHV0KClcbiAgICBdLCBTZXJpZXNWZXJ0aWNhbENvbXBvbmVudC5wcm90b3R5cGUsIFwic2hvd0RhdGFMYWJlbFwiLCB2b2lkIDApO1xuICAgIF9fZGVjb3JhdGUoW1xuICAgICAgICBJbnB1dCgpXG4gICAgXSwgU2VyaWVzVmVydGljYWxDb21wb25lbnQucHJvdG90eXBlLCBcImRhdGFMYWJlbEZvcm1hdHRpbmdcIiwgdm9pZCAwKTtcbiAgICBfX2RlY29yYXRlKFtcbiAgICAgICAgSW5wdXQoKVxuICAgIF0sIFNlcmllc1ZlcnRpY2FsQ29tcG9uZW50LnByb3RvdHlwZSwgXCJub0JhcldoZW5aZXJvXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbXG4gICAgICAgIE91dHB1dCgpXG4gICAgXSwgU2VyaWVzVmVydGljYWxDb21wb25lbnQucHJvdG90eXBlLCBcInNlbGVjdFwiLCB2b2lkIDApO1xuICAgIF9fZGVjb3JhdGUoW1xuICAgICAgICBPdXRwdXQoKVxuICAgIF0sIFNlcmllc1ZlcnRpY2FsQ29tcG9uZW50LnByb3RvdHlwZSwgXCJhY3RpdmF0ZVwiLCB2b2lkIDApO1xuICAgIF9fZGVjb3JhdGUoW1xuICAgICAgICBPdXRwdXQoKVxuICAgIF0sIFNlcmllc1ZlcnRpY2FsQ29tcG9uZW50LnByb3RvdHlwZSwgXCJkZWFjdGl2YXRlXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbXG4gICAgICAgIE91dHB1dCgpXG4gICAgXSwgU2VyaWVzVmVydGljYWxDb21wb25lbnQucHJvdG90eXBlLCBcImRhdGFMYWJlbEhlaWdodENoYW5nZWRcIiwgdm9pZCAwKTtcbiAgICBTZXJpZXNWZXJ0aWNhbENvbXBvbmVudCA9IF9fZGVjb3JhdGUoW1xuICAgICAgICBDb21wb25lbnQoe1xuICAgICAgICAgICAgc2VsZWN0b3I6ICdnW25neC1jaGFydHMtc2VyaWVzLXZlcnRpY2FsXScsXG4gICAgICAgICAgICB0ZW1wbGF0ZTogXCJcXG4gICAgPHN2ZzpnXFxuICAgICAgbmd4LWNoYXJ0cy1iYXJcXG4gICAgICAqbmdGb3I9XFxcImxldCBiYXIgb2YgYmFyczsgdHJhY2tCeTogdHJhY2tCeVxcXCJcXG4gICAgICBbQGFuaW1hdGlvblN0YXRlXT1cXFwiJ2FjdGl2ZSdcXFwiXFxuICAgICAgW0AuZGlzYWJsZWRdPVxcXCIhYW5pbWF0aW9uc1xcXCJcXG4gICAgICBbd2lkdGhdPVxcXCJiYXIud2lkdGhcXFwiXFxuICAgICAgW2hlaWdodF09XFxcImJhci5oZWlnaHRcXFwiXFxuICAgICAgW3hdPVxcXCJiYXIueFxcXCJcXG4gICAgICBbeV09XFxcImJhci55XFxcIlxcbiAgICAgIFtmaWxsXT1cXFwiYmFyLmNvbG9yXFxcIlxcbiAgICAgIFtzdG9wc109XFxcImJhci5ncmFkaWVudFN0b3BzXFxcIlxcbiAgICAgIFtkYXRhXT1cXFwiYmFyLmRhdGFcXFwiXFxuICAgICAgW29yaWVudGF0aW9uXT1cXFwiJ3ZlcnRpY2FsJ1xcXCJcXG4gICAgICBbcm91bmRFZGdlc109XFxcImJhci5yb3VuZEVkZ2VzXFxcIlxcbiAgICAgIFtncmFkaWVudF09XFxcImdyYWRpZW50XFxcIlxcbiAgICAgIFthcmlhTGFiZWxdPVxcXCJiYXIuYXJpYUxhYmVsXFxcIlxcbiAgICAgIFtpc0FjdGl2ZV09XFxcImlzQWN0aXZlKGJhci5kYXRhKVxcXCJcXG4gICAgICAoc2VsZWN0KT1cXFwib25DbGljaygkZXZlbnQpXFxcIlxcbiAgICAgIChhY3RpdmF0ZSk9XFxcImFjdGl2YXRlLmVtaXQoJGV2ZW50KVxcXCJcXG4gICAgICAoZGVhY3RpdmF0ZSk9XFxcImRlYWN0aXZhdGUuZW1pdCgkZXZlbnQpXFxcIlxcbiAgICAgIG5neC10b29sdGlwXFxuICAgICAgW3Rvb2x0aXBEaXNhYmxlZF09XFxcInRvb2x0aXBEaXNhYmxlZFxcXCJcXG4gICAgICBbdG9vbHRpcFBsYWNlbWVudF09XFxcInRvb2x0aXBQbGFjZW1lbnRcXFwiXFxuICAgICAgW3Rvb2x0aXBUeXBlXT1cXFwidG9vbHRpcFR5cGVcXFwiXFxuICAgICAgW3Rvb2x0aXBUaXRsZV09XFxcInRvb2x0aXBUZW1wbGF0ZSA/IHVuZGVmaW5lZCA6IGJhci50b29sdGlwVGV4dFxcXCJcXG4gICAgICBbdG9vbHRpcFRlbXBsYXRlXT1cXFwidG9vbHRpcFRlbXBsYXRlXFxcIlxcbiAgICAgIFt0b29sdGlwQ29udGV4dF09XFxcImJhci5kYXRhXFxcIlxcbiAgICAgIFtub0JhcldoZW5aZXJvXT1cXFwibm9CYXJXaGVuWmVyb1xcXCJcXG4gICAgICBbYW5pbWF0aW9uc109XFxcImFuaW1hdGlvbnNcXFwiXFxuICAgID48L3N2ZzpnPlxcbiAgICA8c3ZnOmcgKm5nSWY9XFxcInNob3dEYXRhTGFiZWxcXFwiPlxcbiAgICAgIDxzdmc6Z1xcbiAgICAgICAgbmd4LWNoYXJ0cy1iYXItbGFiZWxcXG4gICAgICAgICpuZ0Zvcj1cXFwibGV0IGIgb2YgYmFyc0ZvckRhdGFMYWJlbHM7IGxldCBpID0gaW5kZXg7IHRyYWNrQnk6IHRyYWNrRGF0YUxhYmVsQnlcXFwiXFxuICAgICAgICBbYmFyWF09XFxcImIueFxcXCJcXG4gICAgICAgIFtiYXJZXT1cXFwiYi55XFxcIlxcbiAgICAgICAgW2JhcldpZHRoXT1cXFwiYi53aWR0aFxcXCJcXG4gICAgICAgIFtiYXJIZWlnaHRdPVxcXCJiLmhlaWdodFxcXCJcXG4gICAgICAgIFt2YWx1ZV09XFxcImIudG90YWxcXFwiXFxuICAgICAgICBbdmFsdWVGb3JtYXR0aW5nXT1cXFwiZGF0YUxhYmVsRm9ybWF0dGluZ1xcXCJcXG4gICAgICAgIFtvcmllbnRhdGlvbl09XFxcIid2ZXJ0aWNhbCdcXFwiXFxuICAgICAgICAoZGltZW5zaW9uc0NoYW5nZWQpPVxcXCJkYXRhTGFiZWxIZWlnaHRDaGFuZ2VkLmVtaXQoeyBzaXplOiAkZXZlbnQsIGluZGV4OiBpIH0pXFxcIlxcbiAgICAgIC8+XFxuICAgIDwvc3ZnOmc+XFxuICBcIixcbiAgICAgICAgICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICAgICAgICAgICAgYW5pbWF0aW9uczogW1xuICAgICAgICAgICAgICAgIHRyaWdnZXIoJ2FuaW1hdGlvblN0YXRlJywgW1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uKCc6bGVhdmUnLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMVxuICAgICAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRlKDUwMCwgc3R5bGUoeyBvcGFjaXR5OiAwIH0pKVxuICAgICAgICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICBdXG4gICAgICAgIH0pXG4gICAgXSwgU2VyaWVzVmVydGljYWxDb21wb25lbnQpO1xuICAgIHJldHVybiBTZXJpZXNWZXJ0aWNhbENvbXBvbmVudDtcbn0oKSk7XG5leHBvcnQgeyBTZXJpZXNWZXJ0aWNhbENvbXBvbmVudCB9O1xuIl19